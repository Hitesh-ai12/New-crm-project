import{_ as ge,r as w,bg as Ee,b as oe,R as fe,w as ke,o as l,l as n,j as e,k as b,aH as x,L as M,bo as W,n as D,$ as C,bq as ye,F as q,Z as H,Y as he,X as Me,P as I,h as J,g as Z,aZ as te,m as Q,M as _e,bp as ae,ct as $e,f as ue,bi as Ie,u as ze,br as Re}from"./main-D2SRXulC.js";import{a as F}from"./axios-CdtiCRuU.js";import"./bootstrap.min-KxrJAQL6.js";import{S as z}from"./sweetalert2.all-DyJFIm0t.js";import"./_commonjsHelpers-BosuxZz1.js";const qe={class:"modal-content-custom"},He={class:"modal-header-custom"},Ge={class:"modal-title-custom"},je={class:"modal-body-custom"},Ke={class:"form-group mb-3"},Ye={key:0,class:"error-text"},Qe={class:"form-check mb-4"},Xe={class:"d-flex justify-content-end"},Ze=["onClick","disabled"],We={class:"form-group row mb-3 align-items-center"},Je=["for"],et={class:"col-sm-5"},tt=["id","onUpdate:modelValue","onChange","onBlur"],st={key:0,class:"error-text"},lt={class:"col-sm-5 d-flex align-items-center"},at=["onUpdate:modelValue"],ot=["onUpdate:modelValue"],nt={key:0,class:"conditional-fields p-3 mt-3 border rounded"},it={class:"form-group mb-3"},rt=["for"],dt=["id","onUpdate:modelValue","onBlur"],ut={key:0,class:"error-text"},ct={class:"form-group mb-3"},pt=["for"],mt=["id","onUpdate:modelValue","onBlur"],ht={key:0,class:"error-text"},gt={key:1,class:"conditional-fields p-3 mt-3 border rounded"},ft={class:"form-group mb-3"},vt=["for"],bt=["id","onUpdate:modelValue","onBlur"],yt=["value"],_t={key:0,class:"error-text"},kt={key:2,class:"conditional-fields p-3 mt-3 border rounded"},$t={class:"form-group mb-3"},wt=["for"],St=["id","onUpdate:modelValue","onBlur"],At=["value"],Tt={key:0,class:"error-text"},Ct={key:3,class:"conditional-fields p-3 mt-3 border rounded"},Pt={class:"form-group mb-3"},Vt=["for"],Lt=["id","onUpdate:modelValue","onBlur"],Bt={key:0,class:"error-text"},Nt={key:4,class:"conditional-fields p-3 mt-3 border rounded"},Ot={class:"form-group mb-3"},xt=["id","value","onUpdate:modelValue","onChange"],Ft=["for"],Mt={key:0,class:"error-text"},Dt={key:5,class:"conditional-fields p-3 mt-3 border rounded"},Ut={class:"form-group mb-3"},Et=["id","value","onUpdate:modelValue","onChange"],It=["for"],zt={key:0,class:"error-text"},Rt={key:6,class:"conditional-fields p-3 mt-3 border rounded"},qt={class:"form-group mb-3"},Ht=["id","value","onUpdate:modelValue","onChange"],Gt=["for"],jt={key:0,class:"error-text"},Kt={key:7,class:"conditional-fields p-3 mt-3 border rounded"},Yt={class:"form-group mb-3"},Qt=["for"],Xt=["id","onUpdate:modelValue","onBlur"],Zt=["value"],Wt={key:0,class:"error-text"},Jt={key:8,class:"conditional-fields p-3 mt-3 border rounded"},es={class:"form-group mb-3"},ts=["for"],ss=["id","onUpdate:modelValue","onBlur"],ls=["value"],as={key:0,class:"error-text"},os=["disabled"],ns={class:"modal-footer-custom"},is={__name:"ActionPlanFormModal",props:{initialData:{type:Object,default:null}},emits:["close","submit"],setup(t,{emit:a}){const d=t,A=a,h=w(""),k=w(!1),o=w([]);let y=Date.now();const B=w(!1),c=Ee({}),U=w([]),K=w([]),G=w([]),V=w([]),P=w([]),u=localStorage.getItem("auth_token"),p=oe(()=>!!d.initialData),_=async()=>{try{const r=await F.get("/api/templates",{headers:{Authorization:`Bearer ${u}`}});U.value=r.data.data??r.data}catch(r){console.error("Failed to load email templates:",r)}},se=async()=>{try{const r=await F.get("/api/sms-templates",{headers:{Authorization:`Bearer ${u}`}});K.value=r.data.templates}catch(r){console.error("Failed to load SMS templates:",r)}},L=async()=>{try{const r=await F.get("/api/items?type=stage",{headers:{Authorization:`Bearer ${u}`}});G.value=r.data.stages||[]}catch(r){console.error("Failed to load stages:",r)}},g=async()=>{try{const r=await F.get("/api/items?type=tag",{headers:{Authorization:`Bearer ${u}`}});V.value=r.data.tags||[]}catch(r){console.error("Failed to load tags:",r)}},S=async()=>{try{const r=await F.get("/api/automation/action-plans",{headers:{Authorization:`Bearer ${u}`}});P.value=r.data.data??r.data}catch(r){console.error("Failed to load all action plans for dropdown:",r)}},j=()=>{p.value&&d.initialData?(h.value=d.initialData.name,k.value=d.initialData.pause_on_reply,o.value=(d.initialData.actions||[]).map(r=>{let m=r.delay_days,s="Days";return m>0&&m<1&&(m=parseFloat((m*24).toFixed(2)),s="Hours"),{id:Date.now()+Math.random(),backend_id:r.id,type:r.type,delayValue:m,delayUnit:s,taskName:r.task_name,taskType:r.task_type,emailTemplate:r.email_template_id,textTemplate:r.sms_template_id,newStage:r.new_stage||[],noteContent:r.note_content,addTags:r.add_tags||[],removeTags:r.remove_tags||[],pauseSpecificPlan:r.pause_specific_plan,assignActionPlan:r.assign_action_plan}}),y=o.value.length>0?Math.max(...o.value.map(r=>r.id)):Date.now()):(h.value="",k.value=!1,o.value=[{id:Date.now(),backend_id:null,type:"",delayValue:0,delayUnit:"Days",taskName:null,taskType:null,emailTemplate:null,textTemplate:null,newStage:[],noteContent:null,addTags:[],removeTags:[],pauseSpecificPlan:null,assignActionPlan:null}],y=Date.now())};function Y(r,m=null){m===null?c[r]&&delete c[r]:c[m]&&c[m][r]&&(delete c[m][r],Object.keys(c[m]).length===0&&delete c[m])}function N(r,m){const s=o.value.find(be=>be.id===r);if(!s)return!0;const E=s[m];let R="";switch(m){case"type":E||(R="Action Type is required");break;case"taskName":case"taskType":s.type==="Create Task"&&!E&&(R=m==="taskName"?"Task Name is required":"Task Type is required");break;case"emailTemplate":s.type==="Send Email"&&!E&&(R="Email Template is required");break;case"textTemplate":s.type==="Send Text"&&!E&&(R="Text Template is required");break;case"newStage":break;case"noteContent":s.type==="Add Note"&&!E&&(R="Note Content is required");break;case"addTags":break;case"removeTags":break;case"pauseSpecificPlan":s.type==="Pause Specific Action plan"&&!E&&(R="Please select an Action Plan to pause");break;case"assignActionPlan":s.type==="Assign Action Plan"&&!E&&(R="Please select an Action Plan to assign");break}return R?(c[r]||(c[r]={}),c[r][m]=R,!1):(c[r]&&(delete c[r][m],Object.keys(c[r]).length===0&&delete c[r]),!0)}function X(r){const m=["type"];switch(r.type){case"Create Task":m.push("taskName","taskType");break;case"Send Email":m.push("emailTemplate");break;case"Send Text":m.push("textTemplate");break;case"Add Note":m.push("noteContent");break;case"Pause Specific Action plan":m.push("pauseSpecificPlan");break;case"Assign Action Plan":m.push("assignActionPlan");break}let s=!0;for(const E of m)N(r.id,E)||(s=!1);return s}function le(r){return!r.type&&!r.taskName&&!r.taskType&&!r.emailTemplate&&!r.textTemplate&&r.newStage.length===0&&!r.noteContent&&r.addTags.length===0&&r.removeTags.length===0&&!r.pauseSpecificPlan&&!r.assignActionPlan}function ne(){let r=!0;return h.value.trim()?delete c.actionPlanName:(c.actionPlanName="Action Plan Name is required",r=!1),o.value.forEach(m=>{X(m)||(r=!1)}),r}const ie=()=>{if(!pe.value){B.value=!0,X(o.value[o.value.length-1]);return}y++,o.value.push({id:y,backend_id:null,type:"",delayValue:0,delayUnit:"Days",taskName:null,taskType:null,emailTemplate:null,textTemplate:null,newStage:[],noteContent:null,addTags:[],removeTags:[],pauseSpecificPlan:null,assignActionPlan:null})},ve=r=>{if(o.value.length>1){const m=o.value[r].id;c[m]&&delete c[m],o.value.splice(r,1)}},ce=r=>{r.taskName=null,r.taskType=null,r.emailTemplate=null,r.textTemplate=null,r.newStage=[],r.noteContent=null,r.addTags=[],r.removeTags=[],r.pauseSpecificPlan=null,r.assignActionPlan=null,c[r.id]&&delete c[r.id]},pe=oe(()=>{const r=h.value.trim()!=="";if(!o.value.length)return r;const m=o.value[o.value.length-1];return le(m)&&!B.value?!1:r&&X(m)}),me=async()=>{if(B.value=!0,!ne())return;const r=o.value.map((s,E)=>{let R=s.delayValue;return s.delayUnit==="Hours"&&(R=s.delayValue/24),{...s.backend_id&&{id:s.backend_id},type:s.type,delay_days:R,task_name:s.taskName,task_type:s.taskType,email_template_id:s.emailTemplate,sms_template_id:s.textTemplate,note_content:s.noteContent,new_stage:s.newStage,add_tags:s.addTags,remove_tags:s.removeTags,pause_specific_plan:s.pauseSpecificPlan,assign_action_plan:s.assignActionPlan,step_order:E+1}}),m={...p.value&&{id:d.initialData.id},title:h.value,pause_on_reply:k.value,actions:r};A("submit",m)},re=()=>{A("close")};return fe(()=>{_(),se(),L(),g(),S(),j()}),ke(()=>d.initialData,(r,m)=>{r!==m&&j()},{deep:!0}),ke(o,()=>{o.value.length===0?y=Date.now():y=Math.max(...o.value.map(r=>r.id),Date.now())},{deep:!0}),(r,m)=>(l(),n("div",{class:"modal-backdrop-custom",onClick:x(re,["self"])},[e("div",qe,[e("div",He,[e("h5",Ge,b(p.value?"Edit Action Plan":"Add Action Plan"),1),e("button",{type:"button",class:"close-button-custom",onClick:re}," × ")]),e("div",je,[e("form",{onSubmit:x(me,["prevent"]),novalidate:""},[e("div",Ke,[m[3]||(m[3]=e("label",{for:"actionPlanName",class:"form-label-custom"},"* Action plan name",-1)),M(e("input",{id:"actionPlanName",type:"text",class:D(["form-control-custom",{"input-error":c.actionPlanName}]),"onUpdate:modelValue":m[0]||(m[0]=s=>h.value=s),onInput:m[1]||(m[1]=s=>Y("actionPlanName")),autocomplete:"off"},null,34),[[W,h.value]]),B.value&&c.actionPlanName?(l(),n("div",Ye,b(c.actionPlanName),1)):C("",!0)]),e("div",Qe,[M(e("input",{type:"checkbox",class:"form-check-input-custom",id:"pauseOnReply","onUpdate:modelValue":m[2]||(m[2]=s=>k.value=s)},null,512),[[ye,k.value]]),m[4]||(m[4]=e("label",{class:"form-check-label-custom",for:"pauseOnReply"}," Pause the action plan when the lead replies to the mail ",-1))]),(l(!0),n(q,null,H(o.value,(s,E)=>{var R,be,T,i,v,$,O,ee,Ae,Te,Ce,Pe,Ve,Le,Be,Ne,Oe,xe,Fe;return l(),n("div",{key:s.id,class:"action-item-container mb-4 p-3 border rounded"},[e("div",Xe,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:f=>ve(E),disabled:o.value.length===1,title:"Remove Action"},m[5]||(m[5]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,Ze)]),e("div",We,[e("label",{for:"actionSelect-"+s.id,class:"col-sm-2 col-form-label-custom"},"* Action",8,Je),e("div",et,[M(e("select",{id:"actionSelect-"+s.id,class:D(["form-select-custom",{"input-error":(R=c[s.id])==null?void 0:R.type}]),"onUpdate:modelValue":f=>s.type=f,onChange:f=>ce(s),onBlur:f=>N(s.id,"type"),required:""},m[6]||(m[6]=[Me('<option value="" disabled data-v-3bf3ed52>Please select an action plan</option><option value="Create Task" data-v-3bf3ed52>Create Task</option><option value="Send Email" data-v-3bf3ed52>Send Email</option><option value="Send Text" data-v-3bf3ed52>Send Text</option><option value="Change Stage" data-v-3bf3ed52>Change Stage</option><option value="Add Note" data-v-3bf3ed52>Add Note</option><option value="Add Tag(s)" data-v-3bf3ed52>Add Tag(s)</option><option value="Remove Tag(s)" data-v-3bf3ed52>Remove Tag(s)</option><option value="Remove all Tags" data-v-3bf3ed52>Remove all Tags</option><option value="Pause all other Action plans" data-v-3bf3ed52>Pause all other Action plans</option><option value="Pause Specific Action plan" data-v-3bf3ed52>Pause Specific Action plan</option><option value="Repeat Action Plan" data-v-3bf3ed52>Repeat Action Plan</option><option value="Assign Action Plan" data-v-3bf3ed52>Assign Action Plan</option>',13)]),42,tt),[[he,s.type]]),(be=c[s.id])!=null&&be.type?(l(),n("div",st,b(c[s.id].type),1)):C("",!0)]),e("div",lt,[m[8]||(m[8]=e("span",{class:"me-2"},"Immediately run",-1)),M(e("input",{type:"number",min:"0",class:"form-control-custom w-auto me-2","onUpdate:modelValue":f=>s.delayValue=f},null,8,at),[[W,s.delayValue,void 0,{number:!0}]]),M(e("select",{class:"form-select-custom w-auto me-2","onUpdate:modelValue":f=>s.delayUnit=f},m[7]||(m[7]=[e("option",{value:"Days"},"Days",-1),e("option",{value:"Hours"},"Hours",-1)]),8,ot),[[he,s.delayUnit]]),m[9]||(m[9]=e("span",null,"after the previous step",-1))])]),s.type==="Create Task"?(l(),n("div",nt,[e("div",it,[e("label",{for:"taskName-"+s.id,class:"form-label-custom"},"* Task Name",8,rt),M(e("input",{type:"text",id:"taskName-"+s.id,class:D(["form-control-custom",{"input-error":(T=c[s.id])==null?void 0:T.taskName}]),"onUpdate:modelValue":f=>s.taskName=f,onBlur:f=>N(s.id,"taskName"),autocomplete:"off",required:""},null,42,dt),[[W,s.taskName]]),B.value&&((i=c[s.id])!=null&&i.taskName)?(l(),n("div",ut,b(c[s.id].taskName),1)):C("",!0)]),e("div",ct,[e("label",{for:"taskType-"+s.id,class:"form-label-custom"},"* Task Type",8,pt),M(e("select",{id:"taskType-"+s.id,class:D(["form-select-custom",{"input-error":(v=c[s.id])==null?void 0:v.taskType}]),"onUpdate:modelValue":f=>s.taskType=f,onBlur:f=>N(s.id,"taskType"),required:""},m[10]||(m[10]=[Me('<option value="" data-v-3bf3ed52>Select Type</option><option value="call" data-v-3bf3ed52>Call</option><option value="email" data-v-3bf3ed52>Email</option><option value="text" data-v-3bf3ed52>Text</option><option value="closing" data-v-3bf3ed52>Closing</option><option value="showing" data-v-3bf3ed52>Showing</option><option value="open house" data-v-3bf3ed52>Open House</option><option value="thank you" data-v-3bf3ed52>Thank You</option>',8)]),42,mt),[[he,s.taskType]]),($=c[s.id])!=null&&$.taskType?(l(),n("div",ht,b(c[s.id].taskType),1)):C("",!0)])])):C("",!0),s.type==="Send Email"?(l(),n("div",gt,[e("div",ft,[e("label",{for:"emailTemplate-"+s.id,class:"form-label-custom"},"* Email Template",8,vt),M(e("select",{id:"emailTemplate-"+s.id,class:D(["form-select-custom",{"input-error":(O=c[s.id])==null?void 0:O.emailTemplate}]),"onUpdate:modelValue":f=>s.emailTemplate=f,onBlur:f=>N(s.id,"emailTemplate"),required:""},[m[11]||(m[11]=e("option",{value:""},"Select Template",-1)),(l(!0),n(q,null,H(U.value,f=>(l(),n("option",{key:f.id,value:f.id},b(f.title),9,yt))),128))],42,bt),[[he,s.emailTemplate]]),(ee=c[s.id])!=null&&ee.emailTemplate?(l(),n("div",_t,b(c[s.id].emailTemplate),1)):C("",!0)])])):C("",!0),s.type==="Send Text"?(l(),n("div",kt,[e("div",$t,[e("label",{for:"textTemplate-"+s.id,class:"form-label-custom"},"* Text Template",8,wt),M(e("select",{id:"textTemplate-"+s.id,class:D(["form-select-custom",{"input-error":(Ae=c[s.id])==null?void 0:Ae.textTemplate}]),"onUpdate:modelValue":f=>s.textTemplate=f,onBlur:f=>N(s.id,"textTemplate"),required:""},[m[12]||(m[12]=e("option",{value:""},"Select Template",-1)),(l(!0),n(q,null,H(K.value,f=>(l(),n("option",{key:f.id,value:f.id},b(f.name),9,At))),128))],42,St),[[he,s.textTemplate]]),(Te=c[s.id])!=null&&Te.textTemplate?(l(),n("div",Tt,b(c[s.id].textTemplate),1)):C("",!0)])])):C("",!0),s.type==="Add Note"?(l(),n("div",Ct,[e("div",Pt,[e("label",{for:"noteContent-"+s.id,class:"form-label-custom"},"* Note Content",8,Vt),M(e("textarea",{id:"noteContent-"+s.id,class:D(["form-control-custom",{"input-error":(Ce=c[s.id])==null?void 0:Ce.noteContent}]),"onUpdate:modelValue":f=>s.noteContent=f,rows:"3",onBlur:f=>N(s.id,"noteContent"),required:""},null,42,Lt),[[W,s.noteContent]]),(Pe=c[s.id])!=null&&Pe.noteContent?(l(),n("div",Bt,b(c[s.id].noteContent),1)):C("",!0)])])):C("",!0),s.type==="Change Stage"?(l(),n("div",Nt,[e("div",Ot,[m[13]||(m[13]=e("label",{class:"form-label-custom"},"* Assign Stage(s)",-1)),(l(!0),n(q,null,H(G.value,f=>(l(),n("div",{key:f.id,class:"form-check"},[M(e("input",{type:"checkbox",id:"stage-"+f.id+"-"+s.id,class:"form-check-input-custom",value:f.id,"onUpdate:modelValue":de=>s.newStage=de,onChange:de=>N(s.id,"newStage")},null,40,xt),[[ye,s.newStage]]),e("label",{for:"stage-"+f.id+"-"+s.id,class:"form-check-label-custom"},b(f.name),9,Ft)]))),128)),(Ve=c[s.id])!=null&&Ve.newStage?(l(),n("div",Mt,b(c[s.id].newStage),1)):C("",!0)])])):C("",!0),s.type==="Add Tag(s)"?(l(),n("div",Dt,[e("div",Ut,[m[14]||(m[14]=e("label",{class:"form-label-custom"},"* Tags to Add",-1)),(l(!0),n(q,null,H(V.value,f=>(l(),n("div",{key:f.id,class:"form-check"},[M(e("input",{type:"checkbox",id:"addTag-"+f.id+"-"+s.id,class:"form-check-input-custom",value:f.id,"onUpdate:modelValue":de=>s.addTags=de,onChange:de=>N(s.id,"addTags")},null,40,Et),[[ye,s.addTags]]),e("label",{for:"addTag-"+f.id+"-"+s.id,class:"form-check-label-custom"},b(f.name),9,It)]))),128)),(Le=c[s.id])!=null&&Le.addTags?(l(),n("div",zt,b(c[s.id].addTags),1)):C("",!0)])])):C("",!0),s.type==="Remove Tag(s)"?(l(),n("div",Rt,[e("div",qt,[m[15]||(m[15]=e("label",{class:"form-label-custom"},"* Tags to Remove",-1)),(l(!0),n(q,null,H(V.value,f=>(l(),n("div",{key:f.id,class:"form-check"},[M(e("input",{type:"checkbox",id:"removeTag-"+f.id+"-"+s.id,class:"form-check-input-custom",value:f.id,"onUpdate:modelValue":de=>s.removeTags=de,onChange:de=>N(s.id,"removeTags")},null,40,Ht),[[ye,s.removeTags]]),e("label",{for:"removeTag-"+f.id+"-"+s.id,class:"form-check-label-custom"},b(f.name),9,Gt)]))),128)),(Be=c[s.id])!=null&&Be.removeTags?(l(),n("div",jt,b(c[s.id].removeTags),1)):C("",!0)])])):C("",!0),s.type==="Pause Specific Action plan"?(l(),n("div",Kt,[e("div",Yt,[e("label",{for:"pauseSpecificPlan-"+s.id,class:"form-label-custom"},"* Select Action Plan to Pause",8,Qt),M(e("select",{id:"pauseSpecificPlan-"+s.id,class:D(["form-select-custom",{"input-error":(Ne=c[s.id])==null?void 0:Ne.pauseSpecificPlan}]),"onUpdate:modelValue":f=>s.pauseSpecificPlan=f,onBlur:f=>N(s.id,"pauseSpecificPlan"),required:""},[m[16]||(m[16]=e("option",{value:""},"Select Plan",-1)),(l(!0),n(q,null,H(P.value,f=>(l(),n("option",{key:f.id,value:f.id},b(f.name),9,Zt))),128))],42,Xt),[[he,s.pauseSpecificPlan]]),(Oe=c[s.id])!=null&&Oe.pauseSpecificPlan?(l(),n("div",Wt,b(c[s.id].pauseSpecificPlan),1)):C("",!0)])])):C("",!0),s.type==="Assign Action Plan"?(l(),n("div",Jt,[e("div",es,[e("label",{for:"assignActionPlan-"+s.id,class:"form-label-custom"},"* Assign Action Plan",8,ts),M(e("select",{id:"assignActionPlan-"+s.id,class:D(["form-select-custom",{"input-error":(xe=c[s.id])==null?void 0:xe.assignActionPlan}]),"onUpdate:modelValue":f=>s.assignActionPlan=f,onBlur:f=>N(s.id,"assignActionPlan"),required:""},[m[17]||(m[17]=e("option",{value:""},"Select Plan",-1)),(l(!0),n(q,null,H(P.value,f=>(l(),n("option",{key:f.id,value:f.id},b(f.name),9,ls))),128))],42,ss),[[he,s.assignActionPlan]]),(Fe=c[s.id])!=null&&Fe.assignActionPlan?(l(),n("div",as,b(c[s.id].assignActionPlan),1)):C("",!0)])])):C("",!0)])}),128)),e("button",{type:"button",class:"btn btn-outline-secondary mt-3 d-flex align-items-center gap-2",onClick:ie,disabled:!pe.value},m[18]||(m[18]=[e("i",{class:"fas fa-plus"},null,-1),I(" Add Action ")]),8,os)],32)]),e("div",ns,[e("button",{type:"button",class:"btn btn-secondary-custom",onClick:re}," Cancel "),e("button",{type:"submit",class:"btn btn-success-custom",onClick:me},b(p.value?"Update":"Submit"),1)])])]))}},rs=ge(is,[["__scopeId","data-v-3bf3ed52"]]),ds={class:"modal-overlay"},us={class:"modal-content shadow-lg"},cs={class:"modal-header border-0 pb-0"},ps={class:"modal-title fw-bold"},ms={key:0},hs={key:1},gs={class:"modal-body p-4"},fs={key:"assign"},vs={class:"input-group mb-3"},bs={class:"source-list-container"},ys={key:0,class:"text-muted text-center mt-4"},_s={key:1,class:"list-group"},ks=["onClick"],$s={class:"d-grid mt-3"},ws={key:"add"},Ss={class:"mb-3"},As={class:"modal-footer border-0"},Ts=["disabled"],Cs=["disabled"],Ps={__name:"AssignSourceModal",emits:["close","sources-assigned"],setup(t,{emit:a}){const d=a,A=w([]),h=w([]),k=w(""),o=w(""),y=w(!1),B=(u,p="success")=>{z.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:p,title:u,didOpen:_=>{_.addEventListener("mouseenter",z.stopTimer),_.addEventListener("mouseleave",z.resumeTimer)}})};fe(async()=>{await c()});const c=async()=>{try{const u=localStorage.getItem("auth_token"),p=await F.get("/api/items?type=source",{headers:{Authorization:`Bearer ${u}`}});A.value=p.data.sources||[]}catch(u){console.error("Failed to load sources:",u),B("Failed to load sources.","error")}},U=oe(()=>A.value.filter(u=>u.name.toLowerCase().includes(k.value.toLowerCase()))),K=u=>{const p=h.value.indexOf(u);p>-1?h.value.splice(p,1):h.value.push(u)},G=async()=>{if(o.value)try{const u=localStorage.getItem("auth_token"),_=(await F.post("/api/items",{name:o.value,type:"source"},{headers:{Authorization:`Bearer ${u}`}})).data.item;A.value.push(_),h.value.push(_.id),o.value="",y.value=!1,B("Source added successfully!","success")}catch(u){console.error("Failed to add source:",u),B("Failed to add source.","error")}},V=()=>{d("sources-assigned",h.value),B("Sources selected for assignment!","info"),d("close")},P=()=>{y.value?(o.value="",y.value=!1):d("close")};return(u,p)=>(l(),n("div",ds,[e("div",us,[e("div",cs,[e("h5",ps,[J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("span",hs,"➕ Add New Source")):(l(),n("span",ms,"🌐 Assign Source(s)"))]),_:1})]),e("button",{type:"button",class:"btn-close",onClick:p[0]||(p[0]=_=>u.$emit("close")),"aria-label":"Close"})]),e("div",gs,[J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("div",ws,[e("div",Ss,[p[5]||(p[5]=e("label",{for:"sourceName",class:"form-label fw-semibold"},"Source Name",-1)),M(e("input",{"onUpdate:modelValue":p[3]||(p[3]=_=>o.value=_),id:"sourceName",type:"text",class:"form-control",placeholder:"e.g., Website, Referral"},null,512),[[W,o.value,void 0,{trim:!0}]])])])):(l(),n("div",fs,[e("div",vs,[p[4]||(p[4]=e("span",{class:"input-group-text bg-light border-0"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})])],-1)),M(e("input",{"onUpdate:modelValue":p[1]||(p[1]=_=>k.value=_),type:"text",class:"form-control border-0 bg-light",placeholder:"Search for sources..."},null,512),[[W,k.value]])]),e("div",bs,[U.value.length?(l(),n("div",_s,[(l(!0),n(q,null,H(U.value,_=>(l(),n("button",{key:_.id,type:"button",class:D(["list-group-item list-group-item-action",{active:h.value.includes(_.id)}]),onClick:se=>K(_.id)},b(_.name),11,ks))),128))])):(l(),n("p",ys,"No sources found."))]),e("div",$s,[e("button",{class:"btn btn-light btn-sm",onClick:p[2]||(p[2]=_=>y.value=!0)}," + Add New ")])]))]),_:1})]),e("div",As,[e("button",{type:"button",class:"btn btn-secondary",onClick:P},b(y.value?"Back":"Cancel"),1),J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("button",{key:"addSource",type:"button",class:"btn btn-success",disabled:!o.value,onClick:G}," Add Source ",8,Cs)):(l(),n("button",{key:"apply",type:"button",class:"btn btn-primary",disabled:!h.value.length,onClick:V}," Apply ("+b(h.value.length)+") ",9,Ts))]),_:1})])])]))}},Vs=ge(Ps,[["__scopeId","data-v-62007c9a"]]),Ls={class:"modal-overlay"},Bs={class:"modal-content shadow-lg"},Ns={class:"modal-header border-0 pb-0"},Os={class:"modal-title fw-bold"},xs={key:0},Fs={key:1},Ms={class:"modal-body p-4"},Ds={key:"assign"},Us={class:"input-group mb-3"},Es={class:"stage-list-container"},Is={key:0,class:"text-muted text-center mt-4"},zs={key:1,class:"list-group"},Rs=["onClick"],qs={class:"d-grid mt-3"},Hs={key:"add"},Gs={class:"mb-3"},js={class:"modal-footer border-0"},Ks=["disabled"],Ys=["disabled"],Qs={__name:"AssignStageModal",emits:["close","stages-assigned"],setup(t,{emit:a}){const d=a,A=w([]),h=w([]),k=w(""),o=w(""),y=w(!1),B=(u,p="success")=>{z.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:p,title:u,didOpen:_=>{_.addEventListener("mouseenter",z.stopTimer),_.addEventListener("mouseleave",z.resumeTimer)}})};fe(async()=>{await c()});const c=async()=>{try{const u=localStorage.getItem("auth_token"),p=await F.get("/api/items?type=stage",{headers:{Authorization:`Bearer ${u}`}});A.value=p.data.stages||[]}catch(u){console.error("Failed to load stages:",u),B("Failed to load stages.","error")}},U=oe(()=>A.value.filter(u=>u.name.toLowerCase().includes(k.value.toLowerCase()))),K=u=>{const p=h.value.indexOf(u);p>-1?h.value.splice(p,1):h.value.push(u)},G=async()=>{if(o.value)try{const u=localStorage.getItem("auth_token"),_=(await F.post("/api/items",{name:o.value,type:"stage"},{headers:{Authorization:`Bearer ${u}`}})).data.item;A.value.push(_),h.value.push(_.id),o.value="",y.value=!1,B("Stage added successfully!","success")}catch(u){console.error("Failed to add stage:",u),B("Failed to add stage.","error")}},V=()=>{d("stages-assigned",h.value),B("Stages selected for assignment!","info"),d("close")},P=()=>{y.value?(o.value="",y.value=!1):d("close")};return(u,p)=>(l(),n("div",Ls,[e("div",Bs,[e("div",Ns,[e("h5",Os,[J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("span",Fs,"➕ Add New Stage")):(l(),n("span",xs,"🚩 Assign Stage(s)"))]),_:1})]),e("button",{type:"button",class:"btn-close",onClick:p[0]||(p[0]=_=>u.$emit("close")),"aria-label":"Close"})]),e("div",Ms,[J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("div",Hs,[e("div",Gs,[p[5]||(p[5]=e("label",{for:"stageName",class:"form-label fw-semibold"},"Stage Name",-1)),M(e("input",{"onUpdate:modelValue":p[3]||(p[3]=_=>o.value=_),id:"stageName",type:"text",class:"form-control",placeholder:"e.g., In Progress"},null,512),[[W,o.value,void 0,{trim:!0}]])])])):(l(),n("div",Ds,[e("div",Us,[p[4]||(p[4]=e("span",{class:"input-group-text bg-light border-0"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})])],-1)),M(e("input",{"onUpdate:modelValue":p[1]||(p[1]=_=>k.value=_),type:"text",class:"form-control border-0 bg-light",placeholder:"Search for stages..."},null,512),[[W,k.value]])]),e("div",Es,[U.value.length?(l(),n("div",zs,[(l(!0),n(q,null,H(U.value,_=>(l(),n("button",{key:_.id,type:"button",class:D(["list-group-item list-group-item-action",{active:h.value.includes(_.id)}]),onClick:se=>K(_.id)},b(_.name),11,Rs))),128))])):(l(),n("p",Is,"No stages found."))]),e("div",qs,[e("button",{class:"btn btn-light btn-sm",onClick:p[2]||(p[2]=_=>y.value=!0)}," + Add New ")])]))]),_:1})]),e("div",js,[e("button",{type:"button",class:"btn btn-secondary",onClick:P},b(y.value?"Back":"Cancel"),1),J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("button",{key:"addStage",type:"button",class:"btn btn-success",disabled:!o.value,onClick:G}," Add Stage ",8,Ys)):(l(),n("button",{key:"apply",type:"button",class:"btn btn-primary",disabled:!h.value.length,onClick:V}," Apply ("+b(h.value.length)+") ",9,Ks))]),_:1})])])]))}},Xs=ge(Qs,[["__scopeId","data-v-a2c7f7ee"]]),Zs={class:"modal-overlay"},Ws={class:"modal-content shadow-lg"},Js={class:"modal-header border-0 pb-0"},el={class:"modal-title fw-bold"},tl={key:0},sl={key:1},ll={class:"modal-body p-4"},al={key:"assign"},ol={class:"input-group mb-3"},nl={class:"tag-list-container small"},il={key:0,class:"text-muted text-center mt-4"},rl={key:1,class:"d-flex flex-wrap gap-2"},dl=["onClick"],ul={class:"d-grid mt-3"},cl={key:"add"},pl={class:"mb-3"},ml={class:"modal-footer border-0"},hl=["disabled"],gl=["disabled"],fl={__name:"AssignTagModal",emits:["close","tags-assigned"],setup(t,{emit:a}){const d=a,A=w([]),h=w([]),k=w(""),o=w(""),y=w(!1),B=(u,p="success")=>{z.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:p,title:u,didOpen:_=>{_.addEventListener("mouseenter",z.stopTimer),_.addEventListener("mouseleave",z.resumeTimer)}})};fe(async()=>{await c()});const c=async()=>{try{const u=localStorage.getItem("auth_token"),p=await F.get("/api/items?type=tag",{headers:{Authorization:`Bearer ${u}`}});A.value=p.data.tags||[]}catch(u){console.error("Failed to load tags:",u),B("Failed to load tags.","error")}},U=oe(()=>A.value.filter(u=>u.name.toLowerCase().includes(k.value.toLowerCase()))),K=u=>{const p=h.value.indexOf(u);p===-1?h.value.push(u):h.value.splice(p,1)},G=()=>{d("tags-assigned",h.value),B("Tags selected for assignment!","info"),d("close")},V=async()=>{if(o.value)try{const u=localStorage.getItem("auth_token"),p=await F.post("/api/items",{name:o.value,type:"tag"},{headers:{Authorization:`Bearer ${u}`}});A.value.push(p.data.item),h.value.push(p.data.item.id),o.value="",y.value=!1,B("Tag added successfully!","success")}catch(u){console.error("Failed to add tag:",u),B("Failed to add tag.","error")}},P=()=>{y.value?(y.value=!1,o.value=""):d("close")};return(u,p)=>(l(),n("div",Zs,[e("div",Ws,[e("div",Js,[e("h5",el,[J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("span",sl,"➕ Add New Tag")):(l(),n("span",tl,"🏷️ Assign Tags"))]),_:1})]),e("button",{type:"button",class:"btn-close",onClick:p[0]||(p[0]=_=>u.$emit("close")),"aria-label":"Close"})]),e("div",ll,[J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("div",cl,[e("div",pl,[p[5]||(p[5]=e("label",{for:"tagName",class:"form-label fw-semibold"},"Tag Name",-1)),M(e("input",{"onUpdate:modelValue":p[3]||(p[3]=_=>o.value=_),id:"tagName",type:"text",class:"form-control",placeholder:"e.g., Important"},null,512),[[W,o.value,void 0,{trim:!0}]])])])):(l(),n("div",al,[e("div",ol,[p[4]||(p[4]=e("span",{class:"input-group-text bg-light border-0"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})])],-1)),M(e("input",{"onUpdate:modelValue":p[1]||(p[1]=_=>k.value=_),type:"text",class:"form-control border-0 bg-light",placeholder:"Search for tags..."},null,512),[[W,k.value]])]),e("div",nl,[U.value.length?(l(),n("div",rl,[(l(!0),n(q,null,H(U.value,_=>(l(),n("button",{key:_.id,onClick:se=>K(_.id),class:D(["btn btn-sm rounded-pill",h.value.includes(_.id)?"btn-primary":"btn-outline-secondary"])},b(_.name),11,dl))),128))])):(l(),n("p",il,"No tags found."))]),e("div",ul,[e("button",{class:"btn btn-light btn-sm",onClick:p[2]||(p[2]=_=>y.value=!0)}," + Add New ")])]))]),_:1})]),e("div",ml,[e("button",{type:"button",class:"btn btn-secondary",onClick:P},b(y.value?"Back":"Cancel"),1),J(te,{name:"fade",mode:"out-in"},{default:Z(()=>[y.value?(l(),n("button",{key:"addTag",type:"button",class:"btn btn-success",disabled:!o.value,onClick:V}," Add Tag ",8,gl)):(l(),n("button",{key:"apply",type:"button",class:"btn btn-primary",disabled:!h.value.length,onClick:G}," Apply ("+b(h.value.length)+") ",9,hl))]),_:1})])])]))}},vl=ge(fl,[["__scopeId","data-v-465012cf"]]);function we(t){return t===0?!1:Array.isArray(t)&&t.length===0?!0:!t}function bl(t){return(...a)=>!t(...a)}function yl(t,a){return t===void 0&&(t="undefined"),t===null&&(t="null"),t===!1&&(t="false"),t.toString().toLowerCase().indexOf(a.trim())!==-1}function _l(t){return t.filter(a=>!a.$isLabel)}function Se(t,a){return d=>d.reduce((A,h)=>h[t]&&h[t].length?(A.push({$groupLabel:h[a],$isLabel:!0}),A.concat(h[t])):A,[])}const De=(...t)=>a=>t.reduce((d,A)=>A(d),a);var kl={data(){return{search:"",isOpen:!1,preferredOpenDirection:"below",optimizedHeight:this.maxHeight}},props:{internalSearch:{type:Boolean,default:!0},options:{type:Array,required:!0},multiple:{type:Boolean,default:!1},trackBy:{type:String},label:{type:String},searchable:{type:Boolean,default:!0},clearOnSelect:{type:Boolean,default:!0},hideSelected:{type:Boolean,default:!1},placeholder:{type:String,default:"Select option"},allowEmpty:{type:Boolean,default:!0},resetAfter:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},customLabel:{type:Function,default(t,a){return we(t)?"":a?t[a]:t}},taggable:{type:Boolean,default:!1},tagPlaceholder:{type:String,default:"Press enter to create a tag"},tagPosition:{type:String,default:"top"},max:{type:[Number,Boolean],default:!1},id:{default:null},optionsLimit:{type:Number,default:1e3},groupValues:{type:String},groupLabel:{type:String},groupSelect:{type:Boolean,default:!1},blockKeys:{type:Array,default(){return[]}},preserveSearch:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},preventAutofocus:{type:Boolean,default:!1},filteringSortFunc:{type:Function,default:null}},mounted(){!this.multiple&&this.max&&console.warn("[Vue-Multiselect warn]: Max prop should not be used when prop Multiple equals false."),this.preselectFirst&&!this.internalValue.length&&this.options.length&&this.select(this.filteredOptions[0])},computed:{internalValue(){return this.modelValue||this.modelValue===0?Array.isArray(this.modelValue)?this.modelValue:[this.modelValue]:[]},filteredOptions(){const t=this.search||"",a=t.toLowerCase().trim();let d=this.options.concat();return this.internalSearch?d=this.groupValues?this.filterAndFlat(d,a,this.label):this.filterOptions(d,a,this.label,this.customLabel):d=this.groupValues?Se(this.groupValues,this.groupLabel)(d):d,d=this.hideSelected?d.filter(bl(this.isSelected)):d,this.taggable&&a.length&&!this.isExistingOption(a)&&(this.tagPosition==="bottom"?d.push({isTag:!0,label:t}):d.unshift({isTag:!0,label:t})),d.slice(0,this.optionsLimit)},valueKeys(){return this.trackBy?this.internalValue.map(t=>t[this.trackBy]):this.internalValue},optionKeys(){return(this.groupValues?this.flatAndStrip(this.options):this.options).map(a=>this.customLabel(a,this.label).toString().toLowerCase())},currentOptionLabel(){return this.multiple?this.searchable?"":this.placeholder:this.internalValue.length?this.getOptionLabel(this.internalValue[0]):this.searchable?"":this.placeholder}},watch:{internalValue:{handler(){this.resetAfter&&this.internalValue.length&&(this.search="",this.$emit("update:modelValue",this.multiple?[]:null))},deep:!0},search(){this.$emit("search-change",this.search)}},emits:["open","search-change","close","select","update:modelValue","remove","tag"],methods:{getValue(){return this.multiple?this.internalValue:this.internalValue.length===0?null:this.internalValue[0]},filterAndFlat(t,a,d){return De(this.filterGroups(a,d,this.groupValues,this.groupLabel,this.customLabel),Se(this.groupValues,this.groupLabel))(t)},flatAndStrip(t){return De(Se(this.groupValues,this.groupLabel),_l)(t)},updateSearch(t){this.search=t},isExistingOption(t){return this.options?this.optionKeys.indexOf(t)>-1:!1},isSelected(t){const a=this.trackBy?t[this.trackBy]:t;return this.valueKeys.indexOf(a)>-1},isOptionDisabled(t){return!!t.$isDisabled},getOptionLabel(t){if(we(t))return"";if(t.isTag)return t.label;if(t.$isLabel)return t.$groupLabel;const a=this.customLabel(t,this.label);return we(a)?"":a},select(t,a){if(t.$isLabel&&this.groupSelect){this.selectGroup(t);return}if(!(this.blockKeys.indexOf(a)!==-1||this.disabled||t.$isDisabled||t.$isLabel)&&!(this.max&&this.multiple&&this.internalValue.length===this.max)&&!(a==="Tab"&&!this.pointerDirty)){if(t.isTag)this.$emit("tag",t.label,this.id),this.search="",this.closeOnSelect&&!this.multiple&&this.deactivate();else{if(this.isSelected(t)){a!=="Tab"&&this.removeElement(t);return}this.multiple?this.$emit("update:modelValue",this.internalValue.concat([t])):this.$emit("update:modelValue",t),this.$emit("select",t,this.id),this.clearOnSelect&&(this.search="")}this.closeOnSelect&&this.deactivate()}},selectGroup(t){const a=this.options.find(d=>d[this.groupLabel]===t.$groupLabel);if(a){if(this.wholeGroupSelected(a)){this.$emit("remove",a[this.groupValues],this.id);const d=this.trackBy?a[this.groupValues].map(h=>h[this.trackBy]):a[this.groupValues],A=this.internalValue.filter(h=>d.indexOf(this.trackBy?h[this.trackBy]:h)===-1);this.$emit("update:modelValue",A)}else{const d=a[this.groupValues].filter(A=>!(this.isOptionDisabled(A)||this.isSelected(A)));this.max&&d.splice(this.max-this.internalValue.length),this.$emit("select",d,this.id),this.$emit("update:modelValue",this.internalValue.concat(d))}this.closeOnSelect&&this.deactivate()}},wholeGroupSelected(t){return t[this.groupValues].every(a=>this.isSelected(a)||this.isOptionDisabled(a))},wholeGroupDisabled(t){return t[this.groupValues].every(this.isOptionDisabled)},removeElement(t,a=!0){if(this.disabled||t.$isDisabled)return;if(!this.allowEmpty&&this.internalValue.length<=1){this.deactivate();return}const d=typeof t=="object"?this.valueKeys.indexOf(t[this.trackBy]):this.valueKeys.indexOf(t);if(this.multiple){const A=this.internalValue.slice(0,d).concat(this.internalValue.slice(d+1));this.$emit("update:modelValue",A)}else this.$emit("update:modelValue",null);this.$emit("remove",t,this.id),this.closeOnSelect&&a&&this.deactivate()},removeLastElement(){this.blockKeys.indexOf("Delete")===-1&&this.search.length===0&&Array.isArray(this.internalValue)&&this.internalValue.length&&this.removeElement(this.internalValue[this.internalValue.length-1],!1)},activate(){this.isOpen||this.disabled||(this.adjustPosition(),this.groupValues&&this.pointer===0&&this.filteredOptions.length&&(this.pointer=1),this.isOpen=!0,this.searchable?(this.preserveSearch||(this.search=""),this.preventAutofocus||this.$nextTick(()=>this.$refs.search&&this.$refs.search.focus())):this.preventAutofocus||typeof this.$el<"u"&&this.$el.focus(),this.$emit("open",this.id))},deactivate(){this.isOpen&&(this.isOpen=!1,this.searchable?this.$refs.search!==null&&typeof this.$refs.search<"u"&&this.$refs.search.blur():typeof this.$el<"u"&&this.$el.blur(),this.preserveSearch||(this.search=""),this.$emit("close",this.getValue(),this.id))},toggle(){this.isOpen?this.deactivate():this.activate()},adjustPosition(){if(typeof window>"u")return;const t=this.$el.getBoundingClientRect().top,a=window.innerHeight-this.$el.getBoundingClientRect().bottom;a>this.maxHeight||a>t||this.openDirection==="below"||this.openDirection==="bottom"?(this.preferredOpenDirection="below",this.optimizedHeight=Math.min(a-40,this.maxHeight)):(this.preferredOpenDirection="above",this.optimizedHeight=Math.min(t-40,this.maxHeight))},filterOptions(t,a,d,A){return a?t.filter(h=>yl(A(h,d),a)).sort((h,k)=>typeof this.filteringSortFunc=="function"?this.filteringSortFunc(h,k):A(h,d).length-A(k,d).length):t},filterGroups(t,a,d,A,h){return k=>k.map(o=>{if(!o[d])return console.warn("Options passed to vue-multiselect do not contain groups, despite the config."),[];const y=this.filterOptions(o[d],t,a,h);return y.length?{[A]:o[A],[d]:y}:[]})}}},$l={data(){return{pointer:0,pointerDirty:!1}},props:{showPointer:{type:Boolean,default:!0},optionHeight:{type:Number,default:40}},computed:{pointerPosition(){return this.pointer*this.optionHeight},visibleElements(){return this.optimizedHeight/this.optionHeight}},watch:{filteredOptions(){this.pointerAdjust()},isOpen(){this.pointerDirty=!1},pointer(){this.$refs.search&&this.$refs.search.setAttribute("aria-activedescendant",this.id+"-"+this.pointer.toString())}},methods:{optionHighlight(t,a){return{"multiselect__option--highlight":t===this.pointer&&this.showPointer,"multiselect__option--selected":this.isSelected(a)}},groupHighlight(t,a){if(!this.groupSelect)return["multiselect__option--disabled",{"multiselect__option--group":a.$isLabel}];const d=this.options.find(A=>A[this.groupLabel]===a.$groupLabel);return d&&!this.wholeGroupDisabled(d)?["multiselect__option--group",{"multiselect__option--highlight":t===this.pointer&&this.showPointer},{"multiselect__option--group-selected":this.wholeGroupSelected(d)}]:"multiselect__option--disabled"},addPointerElement({key:t}="Enter"){this.filteredOptions.length>0&&this.select(this.filteredOptions[this.pointer],t),this.pointerReset()},pointerForward(){var t;this.pointer<this.filteredOptions.length-1&&(this.pointer++,((t=this.$refs.list)==null?void 0:t.scrollTop)<=this.pointerPosition-(this.visibleElements-1)*this.optionHeight&&(this.$refs.list.scrollTop=this.pointerPosition-(this.visibleElements-1)*this.optionHeight),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()),this.pointerDirty=!0},pointerBackward(){var t;this.pointer>0?(this.pointer--,((t=this.$refs.list)==null?void 0:t.scrollTop)>=this.pointerPosition&&(this.$refs.list.scrollTop=this.pointerPosition),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerBackward()):this.filteredOptions[this.pointer]&&this.filteredOptions[0].$isLabel&&!this.groupSelect&&this.pointerForward(),this.pointerDirty=!0},pointerReset(){this.closeOnSelect&&(this.pointer=0,this.$refs.list&&(this.$refs.list.scrollTop=0))},pointerAdjust(){this.pointer>=this.filteredOptions.length-1&&(this.pointer=this.filteredOptions.length?this.filteredOptions.length-1:0),this.filteredOptions.length>0&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()},pointerSet(t){this.pointer=t,this.pointerDirty=!0}}},Ue={name:"vue-multiselect",mixins:[kl,$l],compatConfig:{MODE:3,ATTR_ENUMERATED_COERCION:!1},props:{name:{type:String,default:""},modelValue:{type:null,default(){return[]}},selectLabel:{type:String,default:"Press enter to select"},selectGroupLabel:{type:String,default:"Press enter to select group"},selectedLabel:{type:String,default:"Selected"},deselectLabel:{type:String,default:"Press enter to remove"},deselectGroupLabel:{type:String,default:"Press enter to deselect group"},showLabels:{type:Boolean,default:!0},limit:{type:Number,default:99999},maxHeight:{type:Number,default:300},limitText:{type:Function,default:t=>`and ${t} more`},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},spellcheck:{type:Boolean,default:!1},openDirection:{type:String,default:""},showNoOptions:{type:Boolean,default:!0},showNoResults:{type:Boolean,default:!0},tabindex:{type:Number,default:0},required:{type:Boolean,default:!1},useTeleport:{type:Boolean,default:!1}},data(){return{dropdownStyles:{},ready:!1}},computed:{hasOptionGroup(){return this.groupValues&&this.groupLabel&&this.groupSelect},isSingleLabelVisible(){return(this.singleValue||this.singleValue===0)&&(!this.isOpen||!this.searchable)&&!this.visibleValues.length},isPlaceholderVisible(){return!this.internalValue.length&&(!this.searchable||!this.isOpen)},visibleValues(){return this.multiple?this.internalValue.slice(0,this.limit):[]},singleValue(){return this.internalValue[0]},deselectLabelText(){return this.showLabels?this.deselectLabel:""},deselectGroupLabelText(){return this.showLabels?this.deselectGroupLabel:""},selectLabelText(){return this.showLabels?this.selectLabel:""},selectGroupLabelText(){return this.showLabels?this.selectGroupLabel:""},selectedLabelText(){return this.showLabels?this.selectedLabel:""},inputStyle(){return this.searchable||this.multiple&&this.modelValue&&this.modelValue.length?this.isOpen?{width:"100%"}:{width:"0",position:"absolute",padding:"0"}:""},contentStyle(){return this.options.length?{display:"inline-block"}:{display:"block"}},isAbove(){return this.openDirection==="above"||this.openDirection==="top"?!0:this.openDirection==="below"||this.openDirection==="bottom"?!1:this.preferredOpenDirection==="above"},showSearchInput(){return this.searchable&&(this.hasSingleSelectedSlot&&(this.visibleSingleValue||this.visibleSingleValue===0)?this.isOpen:!0)},isRequired(){return this.required===!1?!1:this.internalValue.length<=0}},watch:{isOpen(t){t&&(this.useTeleport?(this.ready=!1,this.$nextTick(()=>{const a=this.$el.getBoundingClientRect();this.dropdownStyles={position:"absolute",top:`${a.bottom+window.scrollY}px`,left:`${a.left+window.scrollX}px`,width:`${a.width}px`,zIndex:9999},this.ready=!0})):this.ready=!0)}}};const wl=["tabindex","aria-expanded","aria-owns","aria-activedescendant"],Sl={ref:"tags",class:"multiselect__tags"},Al={class:"multiselect__tags-wrap"},Tl=["textContent"],Cl=["onKeypress","onMousedown"],Pl=["textContent"],Vl={class:"multiselect__spinner"},Ll=["name","id","spellcheck","placeholder","required","value","disabled","tabindex","aria-label","aria-controls"],Bl=["id","aria-multiselectable"],Nl={key:0},Ol={class:"multiselect__option"},xl=["aria-selected","id","role"],Fl=["onClick","onMouseenter","data-select","data-selected","data-deselect"],Ml=["data-select","data-deselect","onMouseenter","onMousedown"],Dl={class:"multiselect__option"},Ul={class:"multiselect__option"};function El(t,a,d,A,h,k){return l(),n("div",{tabindex:t.searchable?-1:d.tabindex,class:D([{"multiselect--active":t.isOpen,"multiselect--disabled":d.disabled,"multiselect--above":k.isAbove,"multiselect--has-options-group":k.hasOptionGroup},"multiselect"]),onFocus:a[14]||(a[14]=o=>t.activate()),onBlur:a[15]||(a[15]=o=>t.searchable?!1:t.deactivate()),onKeydown:[a[16]||(a[16]=ae(x(o=>t.pointerForward(),["self","prevent"]),["down"])),a[17]||(a[17]=ae(x(o=>t.pointerBackward(),["self","prevent"]),["up"]))],onKeypress:a[18]||(a[18]=ae(x(o=>t.addPointerElement(o),["stop","self"]),["enter","tab"])),onKeyup:a[19]||(a[19]=ae(o=>t.deactivate(),["esc"])),role:"combobox","aria-expanded":t.isOpen,"aria-owns":"listbox-"+t.id,"aria-activedescendant":t.isOpen&&t.pointer!==null?t.id+"-"+t.pointer:null},[Q(t.$slots,"caret",{toggle:t.toggle},()=>[e("div",{onMousedown:a[0]||(a[0]=x(o=>t.toggle(),["prevent","stop"])),class:"multiselect__select"},null,32)]),Q(t.$slots,"clear",{search:t.search}),e("div",Sl,[Q(t.$slots,"selection",{search:t.search,remove:t.removeElement,values:k.visibleValues,isOpen:t.isOpen},()=>[M(e("div",Al,[(l(!0),n(q,null,H(k.visibleValues,(o,y)=>Q(t.$slots,"tag",{option:o,search:t.search,remove:t.removeElement},()=>[(l(),n("span",{class:"multiselect__tag",key:y,onMousedown:a[1]||(a[1]=x(()=>{},["prevent"]))},[e("span",{textContent:b(t.getOptionLabel(o))},null,8,Tl),e("i",{tabindex:"1",onKeypress:ae(x(B=>t.removeElement(o),["prevent"]),["enter"]),onMousedown:x(B=>t.removeElement(o),["prevent"]),class:"multiselect__tag-icon"},null,40,Cl)],32))])),256))],512),[[_e,k.visibleValues.length>0]]),t.internalValue&&t.internalValue.length>d.limit?Q(t.$slots,"limit",{key:0},()=>[e("strong",{class:"multiselect__strong",textContent:b(d.limitText(t.internalValue.length-d.limit))},null,8,Pl)]):C("v-if",!0)]),J(te,{name:"multiselect__loading"},{default:Z(()=>[Q(t.$slots,"loading",{},()=>[M(e("div",Vl,null,512),[[_e,d.loading]])])]),_:3}),t.searchable?(l(),n("input",{key:0,ref:"search",name:d.name,id:t.id,type:"text",autocomplete:"off",spellcheck:d.spellcheck,placeholder:t.placeholder,required:k.isRequired,style:$e(k.inputStyle),value:t.search,disabled:d.disabled,tabindex:d.tabindex,"aria-label":d.name+"-searchbox",onInput:a[2]||(a[2]=o=>t.updateSearch(o.target.value)),onFocus:a[3]||(a[3]=x(o=>t.activate(),["prevent"])),onBlur:a[4]||(a[4]=x(o=>t.deactivate(),["prevent"])),onKeyup:a[5]||(a[5]=ae(o=>t.deactivate(),["esc"])),onKeydown:[a[6]||(a[6]=ae(x(o=>t.pointerForward(),["prevent"]),["down"])),a[7]||(a[7]=ae(x(o=>t.pointerBackward(),["prevent"]),["up"])),a[9]||(a[9]=ae(x(o=>t.removeLastElement(),["stop"]),["delete"]))],onKeypress:a[8]||(a[8]=ae(x(o=>t.addPointerElement(o),["prevent","stop","self"]),["enter"])),class:"multiselect__input","aria-controls":"listbox-"+t.id},null,44,Ll)):C("v-if",!0),k.isSingleLabelVisible?(l(),n("span",{key:1,class:"multiselect__single",onMousedown:a[10]||(a[10]=x((...o)=>t.toggle&&t.toggle(...o),["prevent"]))},[Q(t.$slots,"singleLabel",{option:k.singleValue},()=>[I(b(t.currentOptionLabel),1)])],32)):C("v-if",!0),k.isPlaceholderVisible?(l(),n("span",{key:2,class:"multiselect__placeholder",onMousedown:a[11]||(a[11]=x((...o)=>t.toggle&&t.toggle(...o),["prevent"]))},[Q(t.$slots,"placeholder",{},()=>[I(b(t.placeholder),1)])],32)):C("v-if",!0)],512),(l(),ue(Ie,{to:"body",disabled:!d.useTeleport},[J(te,{name:"multiselect"},{default:Z(()=>[t.isOpen&&h.ready?(l(),n("div",{key:0,class:"multiselect__content-wrapper",onFocus:a[12]||(a[12]=(...o)=>t.activate&&t.activate(...o)),tabindex:"-1",onMousedown:a[13]||(a[13]=x(()=>{},["prevent"])),style:$e([h.dropdownStyles,{maxHeight:t.optimizedHeight+"px"}]),ref:"list"},[e("ul",{class:"multiselect__content",style:$e(k.contentStyle),role:"listbox",id:"listbox-"+t.id,"aria-multiselectable":t.multiple},[Q(t.$slots,"beforeList"),t.multiple&&t.max===t.internalValue.length?(l(),n("li",Nl,[e("span",Ol,[Q(t.$slots,"maxElements",{},()=>[I("Maximum of "+b(t.max)+" options selected. First remove a selected option to select another.",1)])])])):C("v-if",!0),!t.max||t.internalValue.length<t.max?(l(!0),n(q,{key:1},H(t.filteredOptions,(o,y)=>(l(),n("li",{class:"multiselect__element",key:y,"aria-selected":t.isSelected(o),id:t.id+"-"+y,role:o&&(o.$isLabel||o.$isDisabled)?null:"option"},[o&&(o.$isLabel||o.$isDisabled)?C("v-if",!0):(l(),n("span",{key:0,class:D([t.optionHighlight(y,o),"multiselect__option"]),onClick:x(B=>t.select(o),["stop"]),onMouseenter:x(B=>t.pointerSet(y),["self"]),"data-select":o&&o.isTag?t.tagPlaceholder:k.selectLabelText,"data-selected":k.selectedLabelText,"data-deselect":k.deselectLabelText},[Q(t.$slots,"option",{option:o,search:t.search,index:y},()=>[e("span",null,b(t.getOptionLabel(o)),1)])],42,Fl)),o&&(o.$isLabel||o.$isDisabled)?(l(),n("span",{key:1,"data-select":t.groupSelect&&k.selectGroupLabelText,"data-deselect":t.groupSelect&&k.deselectGroupLabelText,class:D([t.groupHighlight(y,o),"multiselect__option"]),onMouseenter:x(B=>t.groupSelect&&t.pointerSet(y),["self"]),onMousedown:x(B=>t.selectGroup(o),["prevent"])},[Q(t.$slots,"option",{option:o,search:t.search,index:y},()=>[e("span",null,b(t.getOptionLabel(o)),1)])],42,Ml)):C("v-if",!0)],8,xl))),128)):C("v-if",!0),M(e("li",null,[e("span",Dl,[Q(t.$slots,"noResult",{search:t.search},()=>[a[20]||(a[20]=I("No elements found. Consider changing the search query."))])])],512),[[_e,d.showNoResults&&t.filteredOptions.length===0&&t.search&&!d.loading]]),M(e("li",null,[e("span",Ul,[Q(t.$slots,"noOptions",{},()=>[a[21]||(a[21]=I("List is empty."))])])],512),[[_e,d.showNoOptions&&(t.options.length===0||k.hasOptionGroup===!0&&t.filteredOptions.length===0)&&!t.search&&!d.loading]]),Q(t.$slots,"afterList")],12,Bl)],36)):C("v-if",!0)]),_:3})],8,["disabled"]))],42,wl)}Ue.render=El;const Il={class:"modal-overlay"},zl={class:"modal-content"},Rl={class:"modal-header"},ql={class:"modal-body"},Hl={key:0,class:"mb-3"},Gl={class:"selected-action-plans-display"},jl={key:1,class:"alert alert-warning mb-3"},Kl={class:"d-flex justify-content-between align-items-center"},Yl={key:0,class:"text-success fw-bold"},Ql={class:"selected-lead-tag"},Xl=["onClick"],Zl={class:"modal-footer"},Wl=["disabled"],Jl={key:0,class:"spinner-border spinner-border-sm me-1"},ea={__name:"AssignUserModal",props:{selectedActionPlanIds:{type:Array,required:!0}},emits:["close"],setup(t,{emit:a}){const d=t,A=a,h=w([]),k=w([]),o=w(!1),y=w([]),B=(V,P="success")=>{typeof Swal<"u"?Swal.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:P,title:V,didOpen:u=>{u.addEventListener("mouseenter",Swal.stopTimer),u.addEventListener("mouseleave",Swal.resumeTimer)}}):console.warn("Swal is not defined. Toast message not shown:",V)},c=async()=>{try{const V=localStorage.getItem("auth_token"),{data:P}=await F.get("/api/leads",{headers:{Authorization:`Bearer ${V}`}});k.value=P.map(u=>({id:u.id,full_name:`${u.first_name} ${u.last_name||""}`.trim()}))}catch(V){console.error("Error fetching leads:",V),B("Failed to load leads.","error")}},U=async()=>{try{const V=localStorage.getItem("auth_token"),P=await F.get("/api/automation/action-plans",{headers:{Authorization:`Bearer ${V}`}});y.value=P.data.data??P.data}catch(V){console.error("Failed to load all action plans for name lookup:",V)}},K=V=>{const P=y.value.find(u=>u.id===V);return P?P.name:`Plan ID: ${V}`},G=async()=>{var V,P;o.value=!0;try{const u=localStorage.getItem("auth_token");await F.post("/api/assign-action-plans",{action_plan_ids:d.selectedActionPlanIds,lead_ids:h.value.map(p=>p.id)},{headers:{Authorization:`Bearer ${u}`}}),B("Action Plans assigned successfully!"),A("close")}catch(u){console.error("Assignment error:",u);const p=((P=(V=u.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to assign action plans.";B(p,"error")}finally{o.value=!1}};return fe(()=>{c(),U()}),ke(()=>d.selectedActionPlanIds,V=>{},{immediate:!0}),(V,P)=>(l(),n("div",Il,[e("div",zl,[e("div",Rl,[P[3]||(P[3]=e("h5",null,"Assign Action Plans to Leads",-1)),e("button",{class:"btn-close",onClick:P[0]||(P[0]=u=>V.$emit("close"))})]),e("div",ql,[t.selectedActionPlanIds.length>0?(l(),n("div",Hl,[P[4]||(P[4]=e("label",{class:"form-label mb-2"},"Selected Action Plan(s) to Assign:",-1)),e("div",Gl,[(l(!0),n(q,null,H(t.selectedActionPlanIds,u=>(l(),n("span",{key:u,class:"badge bg-primary me-1"},b(K(u)),1))),128))])])):(l(),n("div",jl," No action plans selected from the table. Please select action plans first. ")),P[5]||(P[5]=e("label",{class:"form-label mb-2"},"Select Leads:",-1)),J(ze(Ue),{modelValue:h.value,"onUpdate:modelValue":P[1]||(P[1]=u=>h.value=u),options:k.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Search leads",label:"full_name","track-by":"id",class:"lead-multiselect"},{option:Z(({option:u,isSelected:p})=>[e("div",Kl,[e("span",null,b(u.full_name),1),p?(l(),n("span",Yl,"✔")):C("",!0)])]),tag:Z(({option:u,remove:p})=>[e("div",Ql,[I(b(u.full_name)+" ",1),e("span",{onClick:x(_=>p(u),["stop"])},"×",8,Xl)])]),_:1},8,["modelValue","options"])]),e("div",Zl,[e("button",{class:"btn btn-secondary",onClick:P[2]||(P[2]=u=>V.$emit("close"))},"Cancel"),e("button",{class:"btn btn-primary",onClick:G,disabled:h.value.length===0||t.selectedActionPlanIds.length===0||o.value},[o.value?(l(),n("span",Jl)):C("",!0),P[6]||(P[6]=I(" Assign "))],8,Wl)])])]))}},ta=ge(ea,[["__scopeId","data-v-813e60fb"]]),sa={class:"modal-overlay-custom"},la={class:"modal-content-custom-wide"},aa={class:"modal-header-custom"},oa={class:"modal-body-custom"},na={class:"mb-3"},ia={class:"table-responsive"},ra={class:"table table-bordered table-hover align-middle"},da={key:0},ua={key:1},ca={key:0},pa={key:1},ma=["onClick","disabled"],ha={key:0,class:"spinner-border spinner-border-sm me-1"},ga=["onClick","disabled"],fa={key:0,class:"spinner-border spinner-border-sm me-1"},va=["onClick","disabled"],ba={key:0,class:"spinner-border spinner-border-sm me-1"},ya={key:3},_a={key:0,"aria-label":"Page navigation"},ka={class:"pagination justify-content-center"},$a=["disabled"],wa=["onClick"],Sa=["disabled"],Aa={class:"modal-footer-custom"},Ta={__name:"LeadActionPlanAssignmentsModal",emits:["close"],setup(t,{emit:a}){const d=w([]),A=w(!0),h=localStorage.getItem("auth_token"),k=w(1),o=w(5),y=w("");let B=null;const c=oe(()=>{if(!y.value)return d.value;const L=y.value.toLowerCase();return d.value.filter(g=>{var ne,ie,ve,ce,pe,me,re,r,m,s,E;const S=`${((ne=g.lead)==null?void 0:ne.first_name)||""} ${((ie=g.lead)==null?void 0:ie.last_name)||""}`.toLowerCase(),j=((ce=(ve=g.action_plan)==null?void 0:ve.name)==null?void 0:ce.toLowerCase())||"",Y=((pe=g.status)==null?void 0:pe.toLowerCase())||"",N=((re=(me=g.current_action)==null?void 0:me.type)==null?void 0:re.toLowerCase())||"",X=((m=(r=g.current_action)==null?void 0:r.task_name)==null?void 0:m.toLowerCase())||"",le=((E=(s=g.current_action)==null?void 0:s.note_content)==null?void 0:E.toLowerCase())||"";return S.includes(L)||j.includes(L)||Y.includes(L)||N.includes(L)||X.includes(L)||le.includes(L)})}),U=oe(()=>Math.ceil(c.value.length/o.value)),K=oe(()=>{const L=(k.value-1)*o.value,g=L+o.value;return c.value.slice(L,g)}),G=()=>{B&&clearTimeout(B),B=setTimeout(()=>{k.value=1},300)},V=(L,g="success")=>{typeof z<"u"&&z.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:g,title:L,didOpen:S=>{S.addEventListener("mouseenter",z.stopTimer),S.addEventListener("mouseleave",z.resumeTimer)}})},P=async()=>{A.value=!0;try{const L=await F.get("/api/lead-action-plan-assignments",{headers:{Authorization:`Bearer ${h}`}});d.value=(L.data.data||[]).map(g=>({...g,isUpdatingStatus:!1}))}catch(L){console.error("Failed to load assignments:",L),V("Failed to load assigned action plans.","error"),d.value=[]}finally{A.value=!1}},u=async(L,g)=>{var S,j;L.isUpdatingStatus=!0;try{const N=(await F.post(`/api/lead-action-plan-assignments/${L.id}/status`,{status:g},{headers:{Authorization:`Bearer ${h}`}})).data.data,X=d.value.findIndex(le=>le.id===N.id);X!==-1&&(d.value[X]={...d.value[X],...N}),V(`Action Plan status updated to '${g}' successfully!`)}catch(Y){console.error(`Failed to update status for assignment ${L.id}:`,Y);const N=((j=(S=Y.response)==null?void 0:S.data)==null?void 0:j.message)||`Failed to update status to '${g}'.`;V(N,"error")}finally{L.isUpdatingStatus=!1}},p=async L=>{var g,S;L.isUpdatingStatus=!0;try{await F.post("/api/assign-action-plans",{action_plan_ids:[L.action_plan_id],lead_ids:[L.lead_id]},{headers:{Authorization:`Bearer ${h}`}}),V("Action Plan has been successfully re-assigned!"),await P()}catch(j){console.error("Re-assignment error:",j);const Y=((S=(g=j.response)==null?void 0:g.data)==null?void 0:S.message)||"Failed to re-assign action plan.";V(Y,"error")}finally{L.isUpdatingStatus=!1}},_=L=>L?new Date(L).toLocaleString():"N/A",se=L=>{switch(L){case"active":return"badge bg-success";case"paused":return"badge bg-warning text-dark";case"completed":return"badge bg-info";case"stopped":return"badge bg-danger";default:return"badge bg-secondary"}};return fe(P),(L,g)=>(l(),n("div",sa,[e("div",la,[e("div",aa,[g[5]||(g[5]=e("h5",{class:"modal-title-custom"},"Assigned Action Plans to Leads",-1)),e("button",{type:"button",class:"close-button-custom",onClick:g[0]||(g[0]=S=>L.$emit("close"))}," × ")]),e("div",oa,[e("div",na,[M(e("input",{type:"text",class:"form-control",placeholder:"Search by Lead Name, Action Plan, or Status...","onUpdate:modelValue":g[1]||(g[1]=S=>y.value=S),onInput:G},null,544),[[W,y.value]])]),e("div",ia,[e("table",ra,[g[11]||(g[11]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Lead Name"),e("th",null,"Action Plan"),e("th",null,"Status"),e("th",null,"Current Action"),e("th",null,"Next Due Date"),e("th",null,"Assigned At"),e("th",null,"Actions")])],-1)),e("tbody",null,[A.value?(l(),n("tr",da,g[6]||(g[6]=[e("td",{colspan:"7",class:"text-center py-4"},"Loading assignments...",-1)]))):K.value.length===0?(l(),n("tr",ua,g[7]||(g[7]=[e("td",{colspan:"7",class:"text-center py-4"},"No assignments found matching your criteria.",-1)]))):(l(!0),n(q,{key:2},H(K.value,S=>{var j,Y,N,X,le,ne;return l(),n("tr",{key:S.id},[e("td",null,b((j=S.lead)==null?void 0:j.first_name)+" "+b((Y=S.lead)==null?void 0:Y.last_name),1),e("td",null,b((N=S.action_plan)==null?void 0:N.name),1),e("td",null,[e("span",{class:D(se(S.status))},b(S.status),3)]),e("td",null,[I(b(((X=S.current_action)==null?void 0:X.type)||"N/A")+" ",1),(le=S.current_action)!=null&&le.task_name?(l(),n("span",ca," ("+b(S.current_action.task_name)+")",1)):(ne=S.current_action)!=null&&ne.note_content?(l(),n("span",pa," (Note)")):C("",!0)]),e("td",null,b(_(S.next_action_due_at)),1),e("td",null,b(_(S.assigned_at)),1),e("td",null,[S.status==="active"?(l(),n("button",{key:0,class:"btn btn-sm btn-warning",onClick:ie=>u(S,"paused"),disabled:S.isUpdatingStatus},[S.isUpdatingStatus?(l(),n("span",ha)):C("",!0),g[8]||(g[8]=I(" Pause "))],8,ma)):S.status==="paused"?(l(),n("button",{key:1,class:"btn btn-sm btn-success",onClick:ie=>u(S,"active"),disabled:S.isUpdatingStatus},[S.isUpdatingStatus?(l(),n("span",fa)):C("",!0),g[9]||(g[9]=I(" Resume "))],8,ga)):S.status==="completed"?(l(),n("button",{key:2,class:"btn btn-sm btn-primary",onClick:ie=>p(S),disabled:S.isUpdatingStatus},[S.isUpdatingStatus?(l(),n("span",ba)):C("",!0),g[10]||(g[10]=I(" Re-assign "))],8,va)):(l(),n("span",ya,"N/A"))])])}),128))])])]),U.value>1?(l(),n("nav",_a,[e("ul",ka,[e("li",{class:D(["page-item",{disabled:k.value===1}])},[e("a",{class:"page-link",href:"#",onClick:g[2]||(g[2]=x(S=>k.value--,["prevent"])),disabled:k.value===1},"Previous",8,$a)],2),(l(!0),n(q,null,H(U.value,S=>(l(),n("li",{class:D(["page-item",{active:k.value===S}]),key:S},[e("a",{class:"page-link",href:"#",onClick:x(j=>k.value=S,["prevent"])},b(S),9,wa)],2))),128)),e("li",{class:D(["page-item",{disabled:k.value===U.value}])},[e("a",{class:"page-link",href:"#",onClick:g[3]||(g[3]=x(S=>k.value++,["prevent"])),disabled:k.value===U.value},"Next",8,Sa)],2)])])):C("",!0)]),e("div",Aa,[e("button",{type:"button",class:"btn btn-secondary-custom",onClick:g[4]||(g[4]=S=>L.$emit("close"))}," Close ")])])]))}},Ca=ge(Ta,[["__scopeId","data-v-61b5c4ae"]]),Pa={class:"action-bar d-flex justify-content-between align-items-center gap-2 my-3 flex-wrap"},Va={class:"d-flex align-items-center gap-2 flex-wrap"},La=["disabled"],Ba=["disabled"],Na=["disabled"],Oa=["disabled"],xa=["disabled"],Fa={class:"mb-3"},Ma={key:1,class:"table-responsive"},Da={class:"table table-bordered table-hover align-middle"},Ua={class:"table-light"},Ea=["checked"],Ia={key:0},za=["value"],Ra={class:"scrollable-cell"},qa={class:"scrollable-cell"},Ha={class:"scrollable-cell"},Ga=["onClick"],ja=["onClick"],Ka={key:2,"aria-label":"Page navigation"},Ya={class:"pagination justify-content-center"},Qa=["disabled"],Xa=["onClick"],Za=["disabled"],Wa={__name:"Actionplansmain",setup(t){const a=localStorage.getItem("auth_token");a&&(F.defaults.headers.common.Authorization=`Bearer ${a}`);const d=w([]),A=w(!0),h=w(1),k=w(10),o=w(1),y=w("");let B=null;const c=w([]),U=oe(()=>c.value.length===d.value.length&&d.value.length>0),K=()=>{c.value=U.value?[]:d.value.map(T=>T.id)},G=w(!1),V=w(null),P=w(!1),u=w(!1),p=w(!1),_=w(!1),se=w(!1);w(!1),w([]);const L=oe(()=>c.value.length===0),g=(T,i="success")=>{typeof z<"u"&&z.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:i,title:T,didOpen:v=>{v.addEventListener("mouseenter",z.stopTimer),v.addEventListener("mouseleave",z.resumeTimer)}})},S=w({}),j=w({}),Y=w({}),N=async()=>{A.value=!0;try{const T=await F.get("/api/automation/action-plans",{params:{page:h.value,per_page:k.value,search:y.value,include:"actions,creator"},headers:{Authorization:`Bearer ${a}`}});d.value=T.data.data||[],o.value=T.data.last_page||1}catch(T){console.error("Failed to load action plans:",T),g("Failed to load action plans.","error"),d.value=[],o.value=1}finally{A.value=!1}},X=async()=>{try{const T=localStorage.getItem("auth_token"),[i,v,$]=await Promise.all([F.get("/api/items?type=tag",{headers:{Authorization:`Bearer ${T}`}}),F.get("/api/items?type=stage",{headers:{Authorization:`Bearer ${T}`}}),F.get("/api/items?type=source",{headers:{Authorization:`Bearer ${T}`}})]);S.value=(i.data.tags||[]).reduce((O,ee)=>(O[ee.id]=ee.name,O),{}),j.value=(v.data.stages||[]).reduce((O,ee)=>(O[ee.id]=ee.name,O),{}),Y.value=($.data.sources||[]).reduce((O,ee)=>(O[ee.id]=ee.name,O),{})}catch(T){console.error("Failed to load tags/stages/sources for lookup:",T)}},le=()=>{B&&clearTimeout(B),B=setTimeout(()=>{h.value=1,N()},300)};ke(h,()=>{N()});const ne=()=>{V.value=null,G.value=!0},ie=T=>{F.get(`/api/automation/action-plans/${T.id}?include=actions`).then(i=>{V.value=i.data.data,G.value=!0}).catch(i=>{console.error("Failed to fetch action plan for edit:",i),g("Failed to load action plan details for editing.","error")})},ve=async T=>{var i,v;try{T.id?(await F.put(`/api/automation/action-plans/${T.id}`,T),g("Action Plan updated successfully!")):(await F.post("/api/automation/action-plan",T),g("Action Plan added successfully!")),ce(),await N()}catch($){console.error("Failed to save action plan:",$);const O=((v=(i=$.response)==null?void 0:i.data)==null?void 0:v.message)||"Something went wrong.";g(O,"error")}},ce=()=>{G.value=!1,V.value=null},pe=T=>{z.fire({title:"Are you sure?",text:"You are about to delete this action plan. This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"}).then(i=>{i.isConfirmed&&re([T])})},me=()=>{if(c.value.length===0){g("Please select at least one action plan to delete.","warning");return}z.fire({title:"Are you sure?",text:`You are about to delete ${c.value.length} selected action plan(s).`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete them!"}).then(T=>{T.isConfirmed&&re(c.value)})},re=async T=>{try{await F.post("/api/automation/action-plans/batch-delete",{ids:T}),await N(),c.value=[],g(response.data.message||"Action Plan(s) deleted successfully!","success")}catch(i){console.error("Failed to delete action plan(s):",i),g("Failed to delete action plan(s).","error")}},r=async T=>{var i,v;try{if(c.value.length===0){g("Please select at least one action plan to assign tags to.","warning");return}const $={action_plan_ids:c.value,tag_ids:T},O=await F.post("/api/automation/action-plans/add-tag-action",$);g(O.data.message||"Tags action added to plan(s) successfully!","success"),u.value=!1,await N()}catch($){console.error("Failed to add tags action to plan(s):",$);const O=((v=(i=$.response)==null?void 0:i.data)==null?void 0:v.message)||"Something went wrong.";g(O,"error")}},m=async T=>{var i,v;try{if(c.value.length===0){g("Please select at least one action plan to assign stages to.","warning");return}const $={action_plan_ids:c.value,stage_ids:T},O=await F.post("/api/automation/action-plans/change-stage-action",$);g(O.data.message||"Change Stage action added to plan(s) successfully!","success"),p.value=!1,await N()}catch($){console.error("Failed to add change stage action to plan(s):",$);const O=((v=(i=$.response)==null?void 0:i.data)==null?void 0:v.message)||"Something went wrong.";g(O,"error")}},s=async T=>{var i,v;try{if(c.value.length===0){g("Please select at least one action plan to assign sources to.","warning");return}const $={action_plan_ids:c.value,source_ids:T},O=await F.post("/api/automation/action-plans/assign-source-action",$);g(O.data.message||"Assign Source action added to plan(s) successfully!","success"),_.value=!1,await N()}catch($){console.error("Failed to add assign source action to plan(s):",$);const O=((v=(i=$.response)==null?void 0:i.data)==null?void 0:v.message)||"Something went wrong.";g(O,"error")}},E=T=>{if(!T.actions||T.actions.length===0)return"N/A";const i=T.actions.filter($=>$.type==="Add Tag(s)"&&$.add_tags&&$.add_tags.length>0).flatMap($=>$.add_tags);if(i.length===0)return"N/A";const v=i.map($=>S.value[$]).filter($=>$);return v.length>0?v.join(", "):"N/A"},R=T=>{if(!T.actions||T.actions.length===0)return"N/A";const i=T.actions.filter($=>$.type==="Change Stage"&&$.new_stage&&$.new_stage.length>0).flatMap($=>$.new_stage);if(i.length===0)return"N/A";const v=i.map($=>j.value[$]).filter($=>$);return v.length>0?v.join(", "):"N/A"},be=T=>{if(!T.actions||T.actions.length===0)return"N/A";const i=T.actions.filter($=>$.type==="Assign Source"&&$.assign_action_plan).map($=>parseInt($.assign_action_plan));if(i.length===0)return"N/A";const v=i.map($=>Y.value[$]).filter($=>$);return v.length>0?v.join(", "):"N/A"};return fe(()=>{X(),N()}),(T,i)=>(l(),n("div",null,[e("div",Pa,[i[21]||(i[21]=e("div",{class:"fw-bold fs-5 text-dark"},"Action Bar",-1)),e("div",Va,[e("button",{class:"btn btn-success",onClick:ne,title:"Add New Action Plan"},i[14]||(i[14]=[e("i",{class:"fas fa-plus"},null,-1),I(" Add Action Plan ")])),e("button",{class:"btn btn-warning",disabled:L.value,onClick:i[0]||(i[0]=v=>P.value=!0),title:"Assign to Lead"},i[15]||(i[15]=[e("i",{class:"fas fa-user"},null,-1),I(" Assign User ")]),8,La),e("button",{class:"btn btn-warning",disabled:L.value,onClick:i[1]||(i[1]=v=>u.value=!0),title:"Assign Tag"},i[16]||(i[16]=[e("i",{class:"fas fa-tags"},null,-1),I(" Assign Tag ")]),8,Ba),e("button",{class:"btn btn-warning",disabled:L.value,onClick:i[2]||(i[2]=v=>p.value=!0),title:"Assign Stage"},i[17]||(i[17]=[e("i",{class:"fas fa-calendar-alt"},null,-1),I(" Assign Stage ")]),8,Na),e("button",{class:"btn btn-warning",disabled:L.value,onClick:i[3]||(i[3]=v=>_.value=!0),title:"Assign Source"},i[18]||(i[18]=[e("i",{class:"fas fa-globe"},null,-1),I(" Assign Source ")]),8,Oa),e("button",{class:"btn btn-danger",disabled:L.value,onClick:me,title:"Delete Selected Action Plans"},i[19]||(i[19]=[e("i",{class:"fas fa-trash-alt"},null,-1),I(" Delete ")]),8,xa),e("button",{class:"btn btn-info",onClick:i[4]||(i[4]=v=>se.value=!0),title:"View Assigned Action Plans"},i[20]||(i[20]=[e("i",{class:"fas fa-list-alt"},null,-1),I(" View Assignments ")]))])]),e("div",Fa,[M(e("input",{type:"text",class:"form-control",placeholder:"Search action plans by name...","onUpdate:modelValue":i[5]||(i[5]=v=>y.value=v),onInput:le},null,544),[[W,y.value]])]),A.value?(l(),ue(Re,{key:0})):C("",!0),A.value?C("",!0):(l(),n("div",Ma,[e("table",Da,[e("thead",Ua,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",onChange:K,checked:U.value},null,40,Ea)]),i[22]||(i[22]=e("th",null,"Name",-1)),i[23]||(i[23]=e("th",null,"Steps",-1)),i[24]||(i[24]=e("th",null,"Active",-1)),i[25]||(i[25]=e("th",null,"Paused",-1)),i[26]||(i[26]=e("th",null,"Stopped",-1)),i[27]||(i[27]=e("th",null,"Completed",-1)),i[28]||(i[28]=e("th",null,"Created By",-1)),i[29]||(i[29]=e("th",null,"Tag(s)",-1)),i[30]||(i[30]=e("th",null,"Stage(s)",-1)),i[31]||(i[31]=e("th",null,"Source(s)",-1)),i[32]||(i[32]=e("th",null,"Actions",-1))])]),e("tbody",null,[d.value.length===0?(l(),n("tr",Ia,i[33]||(i[33]=[e("td",{colspan:"12",class:"text-center py-4"},"No action plans found matching your criteria.",-1)]))):(l(!0),n(q,{key:1},H(d.value,v=>{var $;return l(),n("tr",{key:v.id},[e("td",null,[M(e("input",{type:"checkbox",value:v.id,"onUpdate:modelValue":i[6]||(i[6]=O=>c.value=O)},null,8,za),[[ye,c.value]])]),e("td",null,b(v.name),1),e("td",null,b(v.step_count),1),e("td",null,b(v.active_leads_count),1),e("td",null,b(v.paused_leads_count),1),e("td",null,b(v.stopped_leads_count),1),e("td",null,b(v.completed_leads_count),1),e("td",null,b((($=v.creator)==null?void 0:$.name)||"N/A"),1),e("td",null,[e("div",Ra,b(E(v)),1)]),e("td",null,[e("div",qa,b(R(v)),1)]),e("td",null,[e("div",Ha,b(be(v)),1)]),e("td",null,[e("button",{class:"btn btn-sm btn-info me-2",onClick:O=>ie(v),title:"Edit Action Plan"},i[34]||(i[34]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ga),e("button",{class:"btn btn-sm btn-danger",onClick:O=>pe(v.id),title:"Delete Action Plan"},i[35]||(i[35]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,ja)])])}),128))])])])),o.value>1&&!A.value?(l(),n("nav",Ka,[e("ul",Ya,[e("li",{class:D(["page-item",{disabled:h.value===1}])},[e("a",{class:"page-link",href:"#",onClick:i[7]||(i[7]=x(v=>h.value--,["prevent"])),disabled:h.value===1},"Previous",8,Qa)],2),(l(!0),n(q,null,H(o.value,v=>(l(),n("li",{class:D(["page-item",{active:h.value===v}]),key:v},[e("a",{class:"page-link",href:"#",onClick:x($=>h.value=v,["prevent"])},b(v),9,Xa)],2))),128)),e("li",{class:D(["page-item",{disabled:h.value===o.value}])},[e("a",{class:"page-link",href:"#",onClick:i[8]||(i[8]=x(v=>h.value++,["prevent"])),disabled:h.value===o.value},"Next",8,Za)],2)])])):C("",!0),G.value?(l(),ue(rs,{key:3,initialData:V.value,onClose:ce,onSubmit:ve},null,8,["initialData"])):C("",!0),P.value?(l(),ue(ta,{key:4,onClose:i[9]||(i[9]=v=>P.value=!1),selectedActionPlanIds:c.value},null,8,["selectedActionPlanIds"])):C("",!0),u.value?(l(),ue(vl,{key:5,onClose:i[10]||(i[10]=v=>u.value=!1),onTagsAssigned:r,selectedActionPlanIds:c.value},null,8,["selectedActionPlanIds"])):C("",!0),p.value?(l(),ue(Xs,{key:6,onClose:i[11]||(i[11]=v=>p.value=!1),onStagesAssigned:m,selectedActionPlanIds:c.value},null,8,["selectedActionPlanIds"])):C("",!0),_.value?(l(),ue(Vs,{key:7,onClose:i[12]||(i[12]=v=>_.value=!1),onSourcesAssigned:s,selectedActionPlanIds:c.value},null,8,["selectedActionPlanIds"])):C("",!0),se.value?(l(),ue(Ca,{key:8,onClose:i[13]||(i[13]=v=>se.value=!1)})):C("",!0)]))}},ao=ge(Wa,[["__scopeId","data-v-ce3bf80d"]]);export{ao as default};
