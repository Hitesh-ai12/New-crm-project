import{_ as ee,r as A,bh as Ue,b as W,S as te,w as fe,o as a,m as n,k as e,l as b,aI as B,M as L,bp as K,n as D,a0 as S,br as ae,F as E,$ as U,Z,Y as xe,Q as M,j as H,h as R,a_ as G,p as z,N as ue,bq as j,ct as pe,f as J,bj as ze,u as Ie}from"./main-CyUTswze.js";import{a as N}from"./axios-CdtiCRuU.js";import"./bootstrap.min-KxrJAQL6.js";import{S as Q}from"./sweetalert2.all-BgaqdXRD.js";const Re={class:"modal-content-custom"},He={class:"modal-header-custom"},qe={class:"modal-title-custom"},Ge={class:"modal-body-custom"},je={class:"form-group mb-3"},Ke={key:0,class:"error-text"},Qe={class:"form-check mb-4"},Ye={class:"d-flex justify-content-end"},Xe=["onClick","disabled"],Ze={class:"form-group row mb-3 align-items-center"},Je=["for"],We={class:"col-sm-5"},et=["id","onUpdate:modelValue","onChange","onBlur"],tt={key:0,class:"error-text"},st={class:"col-sm-5 d-flex align-items-center"},lt=["onUpdate:modelValue"],at=["onUpdate:modelValue"],ot={key:0,class:"conditional-fields p-3 mt-3 border rounded"},nt={class:"form-group mb-3"},it=["for"],rt=["id","onUpdate:modelValue","onBlur"],dt={key:0,class:"error-text"},ut={class:"form-group mb-3"},ct=["for"],pt=["id","onUpdate:modelValue","onBlur"],mt={key:0,class:"error-text"},ht={key:1,class:"conditional-fields p-3 mt-3 border rounded"},ft={class:"form-group mb-3"},gt=["for"],vt=["id","onUpdate:modelValue","onBlur"],bt=["value"],yt={key:0,class:"error-text"},kt={key:2,class:"conditional-fields p-3 mt-3 border rounded"},_t={class:"form-group mb-3"},$t=["for"],wt=["id","onUpdate:modelValue","onBlur"],St=["value"],At={key:0,class:"error-text"},Tt={key:3,class:"conditional-fields p-3 mt-3 border rounded"},Ct={class:"form-group mb-3"},Vt=["for"],Pt=["id","onUpdate:modelValue","onBlur"],Lt={key:0,class:"error-text"},Ot={key:4,class:"conditional-fields p-3 mt-3 border rounded"},Bt={class:"form-group mb-3"},Nt=["id","value","onUpdate:modelValue","onChange"],xt=["for"],Mt={key:0,class:"error-text"},Ft={key:5,class:"conditional-fields p-3 mt-3 border rounded"},Dt={class:"form-group mb-3"},Et=["id","value","onUpdate:modelValue","onChange"],Ut=["for"],zt={key:0,class:"error-text"},It={key:6,class:"conditional-fields p-3 mt-3 border rounded"},Rt={class:"form-group mb-3"},Ht=["id","value","onUpdate:modelValue","onChange"],qt=["for"],Gt={key:0,class:"error-text"},jt={key:7,class:"conditional-fields p-3 mt-3 border rounded"},Kt={class:"form-group mb-3"},Qt=["for"],Yt=["id","onUpdate:modelValue","onBlur"],Xt=["value"],Zt={key:0,class:"error-text"},Jt={key:8,class:"conditional-fields p-3 mt-3 border rounded"},Wt={class:"form-group mb-3"},es=["for"],ts=["id","onUpdate:modelValue","onBlur"],ss=["value"],ls={key:0,class:"error-text"},as=["disabled"],os={class:"modal-footer-custom"},ns={__name:"ActionPlanFormModal",props:{initialData:{type:Object,default:null}},emits:["close","submit"],setup(t,{emit:l}){const i=t,k=l,h=A(""),y=A(!1),o=A([]);let v=Date.now();const C=A(!1),p=Ue({}),V=A([]),w=A([]),$=A([]),T=A([]),g=A([]),d=localStorage.getItem("auth_token"),u=W(()=>!!i.initialData),_=async()=>{try{const r=await N.get("/api/templates",{headers:{Authorization:`Bearer ${d}`}});V.value=r.data.data??r.data}catch(r){console.error("Failed to load email templates:",r)}},O=async()=>{try{const r=await N.get("/api/sms-templates",{headers:{Authorization:`Bearer ${d}`}});w.value=r.data.templates}catch(r){console.error("Failed to load SMS templates:",r)}},se=async()=>{try{const r=await N.get("/api/items?type=stage",{headers:{Authorization:`Bearer ${d}`}});$.value=r.data.stages||[]}catch(r){console.error("Failed to load stages:",r)}},oe=async()=>{try{const r=await N.get("/api/items?type=tag",{headers:{Authorization:`Bearer ${d}`}});T.value=r.data.tags||[]}catch(r){console.error("Failed to load tags:",r)}},F=async()=>{try{const r=await N.get("/api/automation/action-plans",{headers:{Authorization:`Bearer ${d}`}});g.value=r.data.data??r.data}catch(r){console.error("Failed to load all action plans for dropdown:",r)}},m=()=>{u.value&&i.initialData?(h.value=i.initialData.name,y.value=i.initialData.pause_on_reply,o.value=(i.initialData.actions||[]).map(r=>{let c=r.delay_days;return{id:Date.now()+Math.random(),backend_id:r.id,type:r.type,delayValue:c,delayUnit:"Days",taskName:r.task_name,taskType:r.task_type,emailTemplate:r.email_template_id,textTemplate:r.sms_template_id,noteContent:r.note_content,newStage:r.new_stage||[],addTags:r.add_tags||[],removeTags:r.remove_tags||[],pauseSpecificPlan:r.pause_specific_plan,assignActionPlan:r.assign_action_plan}}),v=o.value.length>0?Math.max(...o.value.map(r=>r.id)):Date.now()):(h.value="",y.value=!1,o.value=[{id:Date.now(),backend_id:null,type:"",delayValue:0,delayUnit:"Days",taskName:null,taskType:null,emailTemplate:null,textTemplate:null,newStage:[],noteContent:null,addTags:[],removeTags:[],pauseSpecificPlan:null,assignActionPlan:null}],v=Date.now())};function P(r,c=null){c===null?p[r]&&delete p[r]:p[c]&&p[c][r]&&(delete p[c][r],Object.keys(p[c]).length===0&&delete p[c])}function x(r,c){const s=o.value.find(de=>de.id===r);if(!s)return!0;const q=s[c];let I="";switch(c){case"type":q||(I="Action Type is required");break;case"taskName":case"taskType":s.type==="Create Task"&&!q&&(I=c==="taskName"?"Task Name is required":"Task Type is required");break;case"emailTemplate":break;case"textTemplate":break;case"newStage":break;case"noteContent":s.type==="Add Note"&&!q&&(I="Note Content is required");break;case"addTags":break;case"removeTags":break;case"pauseSpecificPlan":s.type==="Pause Specific Action plan"&&!q&&(I="Please select an Action Plan to pause");break;case"assignActionPlan":s.type==="Assign Action Plan"&&!q&&(I="Please select an Action Plan to assign");break}return I?(p[r]||(p[r]={}),p[r][c]=I,!1):(p[r]&&(delete p[r][c],Object.keys(p[r]).length===0&&delete p[r]),!0)}function Y(r){const c=["type"];switch(r.type){case"Create Task":c.push("taskName","taskType");break;case"Send Email":break;case"Send Text":break;case"Add Note":c.push("noteContent");break;case"Pause Specific Action plan":c.push("pauseSpecificPlan");break;case"Assign Action Plan":c.push("assignActionPlan");break}let s=!0;for(const q of c)x(r.id,q)||(s=!1);return s}function ne(r){return!r.type&&!r.taskName&&!r.taskType&&!r.emailTemplate&&!r.textTemplate&&r.newStage.length===0&&!r.noteContent&&r.addTags.length===0&&r.removeTags.length===0&&!r.pauseSpecificPlan&&!r.assignActionPlan}function ie(){let r=!0;return h.value.trim()?delete p.actionPlanName:(p.actionPlanName="Action Plan Name is required",r=!1),o.value.forEach(c=>{Y(c)||(r=!1)}),r}const le=W(()=>{const r=h.value.trim()!=="";if(!o.value.length)return r;const c=o.value[o.value.length-1];return ne(c)&&!C.value?!1:r&&Y(c)}),re=()=>{if(!le.value){C.value=!0,Y(o.value[o.value.length-1]);return}v++,o.value.push({id:v,backend_id:null,type:"",delayValue:0,delayUnit:"Days",taskName:null,taskType:null,emailTemplate:null,textTemplate:null,newStage:[],noteContent:null,addTags:[],removeTags:[],pauseSpecificPlan:null,assignActionPlan:null})},De=r=>{if(o.value.length>1){const c=o.value[r].id;p[c]&&delete p[c],o.value.splice(r,1)}},Ee=r=>{r.taskName=null,r.taskType=null,r.emailTemplate=null,r.textTemplate=null,r.newStage=[],r.noteContent=null,r.addTags=[],r.removeTags=[],r.pauseSpecificPlan=null,r.assignActionPlan=null,p[r.id]&&delete p[r.id]},ge=async()=>{if(C.value=!0,!ie())return;const r=o.value.map((s,q)=>{let I=s.delayValue;return s.delayUnit==="Hours"&&(I=s.delayValue/24),{...s.backend_id&&{id:s.backend_id},type:s.type,delay_days:I,task_name:s.taskName,task_type:s.taskType,email_template_id:s.emailTemplate,sms_template_id:s.textTemplate,note_content:s.noteContent,new_stage:s.newStage,add_tags:s.addTags,remove_tags:s.removeTags,pause_specific_plan:s.pauseSpecificPlan,assign_action_plan:s.assignActionPlan,step_order:q+1}}),c={...u.value&&{id:i.initialData.id},title:h.value,pause_on_reply:y.value,actions:r};k("submit",c)},ce=()=>{k("close")};return te(()=>{_(),O(),se(),oe(),F(),m()}),fe(()=>i.initialData,(r,c)=>{r!==c&&m()},{deep:!0}),fe(o,()=>{o.value.length===0?v=Date.now():v=Math.max(...o.value.map(r=>r.id),Date.now())},{deep:!0}),(r,c)=>(a(),n("div",{class:"modal-backdrop-custom",onClick:B(ce,["self"])},[e("div",Re,[e("div",He,[e("h5",qe,b(u.value?"Edit Action Plan":"Add Action Plan"),1),e("button",{type:"button",class:"close-button-custom",onClick:ce}," × ")]),e("div",Ge,[e("form",{onSubmit:B(ge,["prevent"]),novalidate:""},[e("div",je,[c[3]||(c[3]=e("label",{for:"actionPlanName",class:"form-label-custom"},"* Action plan name",-1)),L(e("input",{id:"actionPlanName",type:"text",class:D(["form-control-custom",{"input-error":p.actionPlanName}]),"onUpdate:modelValue":c[0]||(c[0]=s=>h.value=s),onInput:c[1]||(c[1]=s=>P("actionPlanName")),autocomplete:"off"},null,34),[[K,h.value]]),C.value&&p.actionPlanName?(a(),n("div",Ke,b(p.actionPlanName),1)):S("",!0)]),e("div",Qe,[L(e("input",{type:"checkbox",class:"form-check-input-custom",id:"pauseOnReply","onUpdate:modelValue":c[2]||(c[2]=s=>y.value=s)},null,512),[[ae,y.value]]),c[4]||(c[4]=e("label",{class:"form-check-label-custom",for:"pauseOnReply"}," Pause the action plan when the lead replies to the mail ",-1))]),(a(!0),n(E,null,U(o.value,(s,q)=>{var I,de,ve,be,ye,ke,_e,$e,we,Se,Ae,Te,Ce,Ve,Pe,Le,Oe,Be,Ne;return a(),n("div",{key:s.id,class:"action-item-container mb-4 p-3 border rounded"},[e("div",Ye,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:f=>De(q),disabled:o.value.length===1,title:"Remove Action"},c[5]||(c[5]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,Xe)]),e("div",Ze,[e("label",{for:"actionSelect-"+s.id,class:"col-sm-2 col-form-label-custom"},"* Action",8,Je),e("div",We,[L(e("select",{id:"actionSelect-"+s.id,class:D(["form-select-custom",{"input-error":(I=p[s.id])==null?void 0:I.type}]),"onUpdate:modelValue":f=>s.type=f,onChange:f=>Ee(s),onBlur:f=>x(s.id,"type"),required:""},c[6]||(c[6]=[xe('<option value="" disabled data-v-96de83af>Please select an action plan</option><option value="Create Task" data-v-96de83af>Create Task</option><option value="Send Email" data-v-96de83af>Send Email</option><option value="Send Text" data-v-96de83af>Send Text</option><option value="Change Stage" data-v-96de83af>Change Stage</option><option value="Add Note" data-v-96de83af>Add Note</option><option value="Add Tag(s)" data-v-96de83af>Add Tag(s)</option><option value="Remove Tag(s)" data-v-96de83af>Remove Tag(s)</option><option value="Remove all Tags" data-v-96de83af>Remove all Tags</option><option value="Pause all other Action plans" data-v-96de83af>Pause all other Action plans</option><option value="Pause Specific Action plan" data-v-96de83af>Pause Specific Action plan</option><option value="Repeat Action Plan" data-v-96de83af>Repeat Action Plan</option><option value="Assign Action Plan" data-v-96de83af>Assign Action Plan</option>',13)]),42,et),[[Z,s.type]]),(de=p[s.id])!=null&&de.type?(a(),n("div",tt,b(p[s.id].type),1)):S("",!0)]),e("div",st,[c[8]||(c[8]=e("span",{class:"me-2"},"Immediately run",-1)),L(e("input",{type:"number",min:"0",class:"form-control-custom w-auto me-2","onUpdate:modelValue":f=>s.delayValue=f},null,8,lt),[[K,s.delayValue,void 0,{number:!0}]]),L(e("select",{class:"form-select-custom w-auto me-2","onUpdate:modelValue":f=>s.delayUnit=f},c[7]||(c[7]=[e("option",{value:"Days"},"Days",-1),e("option",{value:"Hours"},"Hours",-1)]),8,at),[[Z,s.delayUnit]]),c[9]||(c[9]=e("span",null,"after the previous step",-1))])]),s.type==="Create Task"?(a(),n("div",ot,[e("div",nt,[e("label",{for:"taskName-"+s.id,class:"form-label-custom"},"* Task Name",8,it),L(e("input",{type:"text",id:"taskName-"+s.id,class:D(["form-control-custom",{"input-error":(ve=p[s.id])==null?void 0:ve.taskName}]),"onUpdate:modelValue":f=>s.taskName=f,onBlur:f=>x(s.id,"taskName"),autocomplete:"off",required:""},null,42,rt),[[K,s.taskName]]),C.value&&((be=p[s.id])!=null&&be.taskName)?(a(),n("div",dt,b(p[s.id].taskName),1)):S("",!0)]),e("div",ut,[e("label",{for:"taskType-"+s.id,class:"form-label-custom"},"* Task Type",8,ct),L(e("select",{id:"taskType-"+s.id,class:D(["form-select-custom",{"input-error":(ye=p[s.id])==null?void 0:ye.taskType}]),"onUpdate:modelValue":f=>s.taskType=f,onBlur:f=>x(s.id,"taskType"),required:""},c[10]||(c[10]=[xe('<option value="" data-v-96de83af>Select Type</option><option value="call" data-v-96de83af>Call</option><option value="email" data-v-96de83af>Email</option><option value="text" data-v-96de83af>Text</option><option value="closing" data-v-96de83af>Closing</option><option value="showing" data-v-96de83af>Showing</option><option value="open house" data-v-96de83af>Open House</option><option value="thank you" data-v-96de83af>Thank You</option>',8)]),42,pt),[[Z,s.taskType]]),(ke=p[s.id])!=null&&ke.taskType?(a(),n("div",mt,b(p[s.id].taskType),1)):S("",!0)])])):S("",!0),s.type==="Send Email"?(a(),n("div",ht,[e("div",ft,[e("label",{for:"emailTemplate-"+s.id,class:"form-label-custom"},"Email Template",8,gt),L(e("select",{id:"emailTemplate-"+s.id,class:D(["form-select-custom",{"input-error":(_e=p[s.id])==null?void 0:_e.emailTemplate}]),"onUpdate:modelValue":f=>s.emailTemplate=f,onBlur:f=>x(s.id,"emailTemplate")},[c[11]||(c[11]=e("option",{value:""},"Select Template (Optional)",-1)),(a(!0),n(E,null,U(V.value,f=>(a(),n("option",{key:f.id,value:f.id},b(f.title),9,bt))),128))],42,vt),[[Z,s.emailTemplate]]),($e=p[s.id])!=null&&$e.emailTemplate?(a(),n("div",yt,b(p[s.id].emailTemplate),1)):S("",!0)])])):S("",!0),s.type==="Send Text"?(a(),n("div",kt,[e("div",_t,[e("label",{for:"textTemplate-"+s.id,class:"form-label-custom"},"Text Template",8,$t),L(e("select",{id:"textTemplate-"+s.id,class:D(["form-select-custom",{"input-error":(we=p[s.id])==null?void 0:we.textTemplate}]),"onUpdate:modelValue":f=>s.textTemplate=f,onBlur:f=>x(s.id,"textTemplate")},[c[12]||(c[12]=e("option",{value:""},"Select Template (Optional)",-1)),(a(!0),n(E,null,U(w.value,f=>(a(),n("option",{key:f.id,value:f.id},b(f.name),9,St))),128))],42,wt),[[Z,s.textTemplate]]),(Se=p[s.id])!=null&&Se.textTemplate?(a(),n("div",At,b(p[s.id].textTemplate),1)):S("",!0)])])):S("",!0),s.type==="Add Note"?(a(),n("div",Tt,[e("div",Ct,[e("label",{for:"noteContent-"+s.id,class:"form-label-custom"},"* Note Content",8,Vt),L(e("textarea",{id:"noteContent-"+s.id,class:D(["form-control-custom",{"input-error":(Ae=p[s.id])==null?void 0:Ae.noteContent}]),"onUpdate:modelValue":f=>s.noteContent=f,rows:"3",onBlur:f=>x(s.id,"noteContent"),required:""},null,42,Pt),[[K,s.noteContent]]),(Te=p[s.id])!=null&&Te.noteContent?(a(),n("div",Lt,b(p[s.id].noteContent),1)):S("",!0)])])):S("",!0),s.type==="Change Stage"?(a(),n("div",Ot,[e("div",Bt,[c[13]||(c[13]=e("label",{class:"form-label-custom"},"* Assign Stage(s)",-1)),(a(!0),n(E,null,U($.value,f=>(a(),n("div",{key:f.id,class:"form-check"},[L(e("input",{type:"checkbox",id:"stage-"+f.id+"-"+s.id,class:"form-check-input-custom",value:f.id,"onUpdate:modelValue":X=>s.newStage=X,onChange:X=>x(s.id,"newStage")},null,40,Nt),[[ae,s.newStage]]),e("label",{for:"stage-"+f.id+"-"+s.id,class:"form-check-label-custom"},b(f.name),9,xt)]))),128)),(Ce=p[s.id])!=null&&Ce.newStage?(a(),n("div",Mt,b(p[s.id].newStage),1)):S("",!0)])])):S("",!0),s.type==="Add Tag(s)"?(a(),n("div",Ft,[e("div",Dt,[c[14]||(c[14]=e("label",{class:"form-label-custom"},"* Tags to Add",-1)),(a(!0),n(E,null,U(T.value,f=>(a(),n("div",{key:f.id,class:"form-check"},[L(e("input",{type:"checkbox",id:"addTag-"+f.id+"-"+s.id,class:"form-check-input-custom",value:f.id,"onUpdate:modelValue":X=>s.addTags=X,onChange:X=>x(s.id,"addTags")},null,40,Et),[[ae,s.addTags]]),e("label",{for:"addTag-"+f.id+"-"+s.id,class:"form-check-label-custom"},b(f.name),9,Ut)]))),128)),(Ve=p[s.id])!=null&&Ve.addTags?(a(),n("div",zt,b(p[s.id].addTags),1)):S("",!0)])])):S("",!0),s.type==="Remove Tag(s)"?(a(),n("div",It,[e("div",Rt,[c[15]||(c[15]=e("label",{class:"form-label-custom"},"* Tags to Remove",-1)),(a(!0),n(E,null,U(T.value,f=>(a(),n("div",{key:f.id,class:"form-check"},[L(e("input",{type:"checkbox",id:"removeTag-"+f.id+"-"+s.id,class:"form-check-input-custom",value:f.id,"onUpdate:modelValue":X=>s.removeTags=X,onChange:X=>x(s.id,"removeTags")},null,40,Ht),[[ae,s.removeTags]]),e("label",{for:"removeTag-"+f.id+"-"+s.id,class:"form-check-label-custom"},b(f.name),9,qt)]))),128)),(Pe=p[s.id])!=null&&Pe.removeTags?(a(),n("div",Gt,b(p[s.id].removeTags),1)):S("",!0)])])):S("",!0),s.type==="Pause Specific Action plan"?(a(),n("div",jt,[e("div",Kt,[e("label",{for:"pauseSpecificPlan-"+s.id,class:"form-label-custom"},"* Select Action Plan to Pause",8,Qt),L(e("select",{id:"pauseSpecificPlan-"+s.id,class:D(["form-select-custom",{"input-error":(Le=p[s.id])==null?void 0:Le.pauseSpecificPlan}]),"onUpdate:modelValue":f=>s.pauseSpecificPlan=f,onBlur:f=>x(s.id,"pauseSpecificPlan"),required:""},[c[16]||(c[16]=e("option",{value:""},"Select Plan",-1)),(a(!0),n(E,null,U(g.value,f=>(a(),n("option",{key:f.id,value:f.id},b(f.name),9,Xt))),128))],42,Yt),[[Z,s.pauseSpecificPlan]]),(Oe=p[s.id])!=null&&Oe.pauseSpecificPlan?(a(),n("div",Zt,b(p[s.id].pauseSpecificPlan),1)):S("",!0)])])):S("",!0),s.type==="Assign Action Plan"?(a(),n("div",Jt,[e("div",Wt,[e("label",{for:"assignActionPlan-"+s.id,class:"form-label-custom"},"* Assign Action Plan",8,es),L(e("select",{id:"assignActionPlan-"+s.id,class:D(["form-select-custom",{"input-error":(Be=p[s.id])==null?void 0:Be.assignActionPlan}]),"onUpdate:modelValue":f=>s.assignActionPlan=f,onBlur:f=>x(s.id,"assignActionPlan"),required:""},[c[17]||(c[17]=e("option",{value:""},"Select Plan",-1)),(a(!0),n(E,null,U(g.value,f=>(a(),n("option",{key:f.id,value:f.id},b(f.name),9,ss))),128))],42,ts),[[Z,s.assignActionPlan]]),(Ne=p[s.id])!=null&&Ne.assignActionPlan?(a(),n("div",ls,b(p[s.id].assignActionPlan),1)):S("",!0)])])):S("",!0)])}),128)),e("button",{type:"button",class:"btn btn-outline-secondary mt-3 d-flex align-items-center gap-2",onClick:re,disabled:!le.value},c[18]||(c[18]=[e("i",{class:"fas fa-plus"},null,-1),M(" Add Action ")]),8,as)],32)]),e("div",os,[e("button",{type:"button",class:"btn btn-secondary-custom",onClick:ce}," Cancel "),e("button",{type:"submit",class:"btn btn-success-custom",onClick:ge},b(u.value?"Update":"Submit"),1)])])]))}},is=ee(ns,[["__scopeId","data-v-96de83af"]]),rs={class:"modal-overlay"},ds={class:"modal-content shadow-lg"},us={class:"modal-header border-0 pb-0"},cs={class:"modal-title fw-bold"},ps={key:0},ms={key:1},hs={class:"modal-body p-4"},fs={key:"assign"},gs={class:"input-group mb-3"},vs={class:"source-list-container"},bs={key:0,class:"text-muted text-center mt-4"},ys={key:1,class:"list-group"},ks=["onClick"],_s={class:"d-grid mt-3"},$s={key:"add"},ws={class:"mb-3"},Ss={class:"modal-footer border-0"},As=["disabled"],Ts=["disabled"],Cs={__name:"AssignSourceModal",emits:["close","source-assigned"],setup(t,{emit:l}){const i=l,k=A([]),h=A(null),y=A(""),o=A(""),v=A(!1),C=(g,d="success")=>{Q.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:d,title:g,didOpen:u=>{u.addEventListener("mouseenter",Q.stopTimer),u.addEventListener("mouseleave",Q.resumeTimer)}})};te(async()=>{await p()});const p=async()=>{try{const g=localStorage.getItem("auth_token"),d=await N.get("/api/items?type=source",{headers:{Authorization:`Bearer ${g}`}});k.value=d.data.sources||[]}catch(g){console.error("Failed to fetch sources:",g),C("Failed to fetch sources.","error")}},V=W(()=>k.value.filter(g=>g.name.toLowerCase().includes(y.value.toLowerCase()))),w=async()=>{if(o.value.trim())try{const g=localStorage.getItem("auth_token"),u=(await N.post("/api/items",{name:o.value,type:"source"},{headers:{Authorization:`Bearer ${g}`}})).data.item;k.value.push(u),h.value=u.id,o.value="",v.value=!1,C("Source added successfully!")}catch(g){console.error("Failed to add source:",g),C("Failed to add source.","error")}},$=()=>{i("source-assigned",h.value),C("Source assigned successfully!"),i("close")},T=()=>{v.value?(o.value="",v.value=!1):i("close")};return(g,d)=>(a(),n("div",rs,[e("div",ds,[e("div",us,[e("h5",cs,[H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("span",ms,"➕ Add New Source")):(a(),n("span",ps,"🚩 Assign Source"))]),_:1})]),e("button",{type:"button",class:"btn-close",onClick:d[0]||(d[0]=u=>g.$emit("close")),"aria-label":"Close"})]),e("div",hs,[H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("div",$s,[e("div",ws,[d[5]||(d[5]=e("label",{for:"sourceName",class:"form-label fw-semibold"},"Source Name",-1)),L(e("input",{"onUpdate:modelValue":d[3]||(d[3]=u=>o.value=u),id:"sourceName",type:"text",class:"form-control",placeholder:"e.g., Social Media"},null,512),[[K,o.value,void 0,{trim:!0}]])])])):(a(),n("div",fs,[e("div",gs,[d[4]||(d[4]=e("span",{class:"input-group-text bg-light border-0"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})])],-1)),L(e("input",{"onUpdate:modelValue":d[1]||(d[1]=u=>y.value=u),type:"text",class:"form-control border-0 bg-light",placeholder:"Search for sources..."},null,512),[[K,y.value]])]),e("div",vs,[V.value.length?(a(),n("div",ys,[(a(!0),n(E,null,U(V.value,u=>(a(),n("button",{key:u.id,type:"button",class:D(["list-group-item list-group-item-action",{active:u.id===h.value}]),onClick:_=>h.value=u.id},b(u.name),11,ks))),128))])):(a(),n("p",bs,"No sources found."))]),e("div",_s,[e("button",{class:"btn btn-light btn-sm",onClick:d[2]||(d[2]=u=>v.value=!0)}," + Add New ")])]))]),_:1})]),e("div",Ss,[e("button",{type:"button",class:"btn btn-secondary",onClick:T},b(v.value?"Back":"Cancel"),1),H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("button",{key:"addSource",type:"button",class:"btn btn-success",disabled:!o.value.trim(),onClick:w}," Add Source ",8,Ts)):(a(),n("button",{key:"apply",type:"button",class:"btn btn-primary",disabled:!h.value,onClick:$}," Apply ",8,As))]),_:1})])])]))}},Vs=ee(Cs,[["__scopeId","data-v-b8fc1599"]]),Ps={class:"modal-overlay"},Ls={class:"modal-content shadow-lg"},Os={class:"modal-header border-0 pb-0"},Bs={class:"modal-title fw-bold"},Ns={key:0},xs={key:1},Ms={class:"modal-body p-4"},Fs={key:"assign"},Ds={class:"input-group mb-3"},Es={class:"stage-list-container"},Us={key:0,class:"text-muted text-center mt-4"},zs={key:1,class:"list-group"},Is=["onClick"],Rs={class:"d-grid mt-3"},Hs={key:"add"},qs={class:"mb-3"},Gs={class:"modal-footer border-0"},js=["disabled"],Ks=["disabled"],Qs={__name:"AssignStageModal",emits:["close","stage-assigned"],setup(t,{emit:l}){const i=l,k=A([]),h=A(null),y=A(""),o=A(""),v=A(!1),C=A([]),p=(u,_="success")=>{Q.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:_,title:u,didOpen:O=>{O.addEventListener("mouseenter",Q.stopTimer),O.addEventListener("mouseleave",Q.resumeTimer)}})};te(async()=>{await V()});const V=async()=>{try{const u=localStorage.getItem("auth_token"),_=await N.get("/api/items?type=stage",{headers:{Authorization:`Bearer ${u}`}});k.value=_.data.stages||[]}catch(u){console.error("Failed to load stages:",u),p("Failed to load stages.","error")}},w=W(()=>k.value.filter(u=>u.name.toLowerCase().includes(y.value.toLowerCase()))),$=u=>{const _=C.value.indexOf(u);_>-1?C.value.splice(_,1):C.value.push(u)},T=async()=>{if(o.value)try{const u=localStorage.getItem("auth_token"),O=(await N.post("/api/items",{name:o.value,type:"stage"},{headers:{Authorization:`Bearer ${u}`}})).data.item;k.value.push(O),h.value=O.id,o.value="",v.value=!1,p("Stage added successfully!")}catch(u){console.error("Failed to add stage:",u),p("Failed to add stage.","error")}},g=()=>{i("stage-assigned",h.value),p("Stage assigned successfully!"),i("close")},d=()=>{v.value?(o.value="",v.value=!1):i("close")};return(u,_)=>(a(),n("div",Ps,[e("div",Ls,[e("div",Os,[e("h5",Bs,[H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("span",xs,"➕ Add New Stage")):(a(),n("span",Ns,"🚩 Assign Stage"))]),_:1})]),e("button",{type:"button",class:"btn-close",onClick:_[0]||(_[0]=O=>u.$emit("close")),"aria-label":"Close"})]),e("div",Ms,[H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("div",Hs,[e("div",qs,[_[5]||(_[5]=e("label",{for:"stageName",class:"form-label fw-semibold"},"Stage Name",-1)),L(e("input",{"onUpdate:modelValue":_[3]||(_[3]=O=>o.value=O),id:"stageName",type:"text",class:"form-control",placeholder:"e.g., In Progress"},null,512),[[K,o.value,void 0,{trim:!0}]])])])):(a(),n("div",Fs,[e("div",Ds,[_[4]||(_[4]=e("span",{class:"input-group-text bg-light border-0"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})])],-1)),L(e("input",{"onUpdate:modelValue":_[1]||(_[1]=O=>y.value=O),type:"text",class:"form-control border-0 bg-light",placeholder:"Search for stages..."},null,512),[[K,y.value]])]),e("div",Es,[w.value.length?(a(),n("div",zs,[(a(!0),n(E,null,U(w.value,O=>(a(),n("button",{key:O.id,type:"button",class:D(["list-group-item list-group-item-action",{active:C.value.includes(O.id)}]),onClick:se=>$(O.id)},b(O.name),11,Is))),128))])):(a(),n("p",Us,"No stages found."))]),e("div",Rs,[e("button",{class:"btn btn-light btn-sm",onClick:_[2]||(_[2]=O=>v.value=!0)}," + Add New ")])]))]),_:1})]),e("div",Gs,[e("button",{type:"button",class:"btn btn-secondary",onClick:d},b(v.value?"Back":"Cancel"),1),H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("button",{key:"addStage",type:"button",class:"btn btn-success",disabled:!o.value,onClick:T}," Add Stage ",8,Ks)):(a(),n("button",{key:"apply",type:"button",class:"btn btn-primary",disabled:!h.value,onClick:g}," Apply ",8,js))]),_:1})])])]))}},Ys=ee(Qs,[["__scopeId","data-v-ababe50f"]]),Xs={class:"modal-overlay"},Zs={class:"modal-content shadow-lg"},Js={class:"modal-header border-0 pb-0"},Ws={class:"modal-title fw-bold"},el={key:0},tl={key:1},sl={class:"modal-body p-4"},ll={key:"assign"},al={class:"input-group mb-3"},ol={class:"tag-list-container small"},nl={key:0,class:"text-muted text-center mt-4"},il={key:1,class:"d-flex flex-wrap gap-2"},rl=["onClick"],dl={class:"d-grid mt-3"},ul={key:"add"},cl={class:"mb-3"},pl={class:"modal-footer border-0"},ml=["disabled"],hl=["disabled"],fl={__name:"AssignTagModal",emits:["close","tags-assigned"],setup(t,{emit:l}){const i=l,k=A([]),h=A([]),y=A(""),o=A(""),v=A(!1),C=(d,u="success")=>{Q.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:u,title:d,didOpen:_=>{_.addEventListener("mouseenter",Q.stopTimer),_.addEventListener("mouseleave",Q.resumeTimer)}})};te(async()=>{await p()});const p=async()=>{try{const d=localStorage.getItem("auth_token"),u=await N.get("/api/items?type=tag",{headers:{Authorization:`Bearer ${d}`}});k.value=u.data.tags||[]}catch(d){console.error("Failed to load tags:",d),C("Failed to load tags.","error")}},V=W(()=>k.value.filter(d=>d.name.toLowerCase().includes(y.value.toLowerCase()))),w=d=>{const u=h.value.indexOf(d);u===-1?h.value.push(d):h.value.splice(u,1)},$=()=>{i("tags-assigned",h.value),C("Tags assigned successfully!"),i("close")},T=async()=>{if(o.value)try{const d=localStorage.getItem("auth_token"),u=await N.post("/api/items",{name:o.value,type:"tag"},{headers:{Authorization:`Bearer ${d}`}});k.value.push(u.data.item),h.value.push(u.data.item.id),o.value="",v.value=!1,C("Tag added successfully!")}catch(d){console.error("Failed to add tag:",d),C("Failed to add tag.","error")}},g=()=>{v.value?(v.value=!1,o.value=""):i("close")};return(d,u)=>(a(),n("div",Xs,[e("div",Zs,[e("div",Js,[e("h5",Ws,[H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("span",tl,"➕ Add New Tag")):(a(),n("span",el,"🏷️ Assign Tags"))]),_:1})]),e("button",{type:"button",class:"btn-close",onClick:u[0]||(u[0]=_=>d.$emit("close")),"aria-label":"Close"})]),e("div",sl,[H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("div",ul,[e("div",cl,[u[5]||(u[5]=e("label",{for:"tagName",class:"form-label fw-semibold"},"Tag Name",-1)),L(e("input",{"onUpdate:modelValue":u[3]||(u[3]=_=>o.value=_),id:"tagName",type:"text",class:"form-control",placeholder:"e.g., Important"},null,512),[[K,o.value,void 0,{trim:!0}]])])])):(a(),n("div",ll,[e("div",al,[u[4]||(u[4]=e("span",{class:"input-group-text bg-light border-0"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})])],-1)),L(e("input",{"onUpdate:modelValue":u[1]||(u[1]=_=>y.value=_),type:"text",class:"form-control border-0 bg-light",placeholder:"Search for tags..."},null,512),[[K,y.value]])]),e("div",ol,[V.value.length?(a(),n("div",il,[(a(!0),n(E,null,U(V.value,_=>(a(),n("button",{key:_.id,onClick:O=>w(_.id),class:D(["btn btn-sm rounded-pill",h.value.includes(_.id)?"btn-primary":"btn-outline-secondary"])},b(_.name),11,rl))),128))])):(a(),n("p",nl,"No tags found."))]),e("div",dl,[e("button",{class:"btn btn-light btn-sm",onClick:u[2]||(u[2]=_=>v.value=!0)}," + Add New ")])]))]),_:1})]),e("div",pl,[e("button",{type:"button",class:"btn btn-secondary",onClick:g},b(v.value?"Back":"Cancel"),1),H(G,{name:"fade",mode:"out-in"},{default:R(()=>[v.value?(a(),n("button",{key:"addTag",type:"button",class:"btn btn-success",disabled:!o.value,onClick:T}," Add Tag ",8,hl)):(a(),n("button",{key:"apply",type:"button",class:"btn btn-primary",disabled:!h.value.length,onClick:$}," Apply ("+b(h.value.length)+") ",9,ml))]),_:1})])])]))}},gl=ee(fl,[["__scopeId","data-v-c9b4ec68"]]);function me(t){return t===0?!1:Array.isArray(t)&&t.length===0?!0:!t}function vl(t){return(...l)=>!t(...l)}function bl(t,l){return t===void 0&&(t="undefined"),t===null&&(t="null"),t===!1&&(t="false"),t.toString().toLowerCase().indexOf(l.trim())!==-1}function yl(t){return t.filter(l=>!l.$isLabel)}function he(t,l){return i=>i.reduce((k,h)=>h[t]&&h[t].length?(k.push({$groupLabel:h[l],$isLabel:!0}),k.concat(h[t])):k,[])}const Me=(...t)=>l=>t.reduce((i,k)=>k(i),l);var kl={data(){return{search:"",isOpen:!1,preferredOpenDirection:"below",optimizedHeight:this.maxHeight}},props:{internalSearch:{type:Boolean,default:!0},options:{type:Array,required:!0},multiple:{type:Boolean,default:!1},trackBy:{type:String},label:{type:String},searchable:{type:Boolean,default:!0},clearOnSelect:{type:Boolean,default:!0},hideSelected:{type:Boolean,default:!1},placeholder:{type:String,default:"Select option"},allowEmpty:{type:Boolean,default:!0},resetAfter:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},customLabel:{type:Function,default(t,l){return me(t)?"":l?t[l]:t}},taggable:{type:Boolean,default:!1},tagPlaceholder:{type:String,default:"Press enter to create a tag"},tagPosition:{type:String,default:"top"},max:{type:[Number,Boolean],default:!1},id:{default:null},optionsLimit:{type:Number,default:1e3},groupValues:{type:String},groupLabel:{type:String},groupSelect:{type:Boolean,default:!1},blockKeys:{type:Array,default(){return[]}},preserveSearch:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},preventAutofocus:{type:Boolean,default:!1},filteringSortFunc:{type:Function,default:null}},mounted(){!this.multiple&&this.max&&console.warn("[Vue-Multiselect warn]: Max prop should not be used when prop Multiple equals false."),this.preselectFirst&&!this.internalValue.length&&this.options.length&&this.select(this.filteredOptions[0])},computed:{internalValue(){return this.modelValue||this.modelValue===0?Array.isArray(this.modelValue)?this.modelValue:[this.modelValue]:[]},filteredOptions(){const t=this.search||"",l=t.toLowerCase().trim();let i=this.options.concat();return this.internalSearch?i=this.groupValues?this.filterAndFlat(i,l,this.label):this.filterOptions(i,l,this.label,this.customLabel):i=this.groupValues?he(this.groupValues,this.groupLabel)(i):i,i=this.hideSelected?i.filter(vl(this.isSelected)):i,this.taggable&&l.length&&!this.isExistingOption(l)&&(this.tagPosition==="bottom"?i.push({isTag:!0,label:t}):i.unshift({isTag:!0,label:t})),i.slice(0,this.optionsLimit)},valueKeys(){return this.trackBy?this.internalValue.map(t=>t[this.trackBy]):this.internalValue},optionKeys(){return(this.groupValues?this.flatAndStrip(this.options):this.options).map(l=>this.customLabel(l,this.label).toString().toLowerCase())},currentOptionLabel(){return this.multiple?this.searchable?"":this.placeholder:this.internalValue.length?this.getOptionLabel(this.internalValue[0]):this.searchable?"":this.placeholder}},watch:{internalValue:{handler(){this.resetAfter&&this.internalValue.length&&(this.search="",this.$emit("update:modelValue",this.multiple?[]:null))},deep:!0},search(){this.$emit("search-change",this.search)}},emits:["open","search-change","close","select","update:modelValue","remove","tag"],methods:{getValue(){return this.multiple?this.internalValue:this.internalValue.length===0?null:this.internalValue[0]},filterAndFlat(t,l,i){return Me(this.filterGroups(l,i,this.groupValues,this.groupLabel,this.customLabel),he(this.groupValues,this.groupLabel))(t)},flatAndStrip(t){return Me(he(this.groupValues,this.groupLabel),yl)(t)},updateSearch(t){this.search=t},isExistingOption(t){return this.options?this.optionKeys.indexOf(t)>-1:!1},isSelected(t){const l=this.trackBy?t[this.trackBy]:t;return this.valueKeys.indexOf(l)>-1},isOptionDisabled(t){return!!t.$isDisabled},getOptionLabel(t){if(me(t))return"";if(t.isTag)return t.label;if(t.$isLabel)return t.$groupLabel;const l=this.customLabel(t,this.label);return me(l)?"":l},select(t,l){if(t.$isLabel&&this.groupSelect){this.selectGroup(t);return}if(!(this.blockKeys.indexOf(l)!==-1||this.disabled||t.$isDisabled||t.$isLabel)&&!(this.max&&this.multiple&&this.internalValue.length===this.max)&&!(l==="Tab"&&!this.pointerDirty)){if(t.isTag)this.$emit("tag",t.label,this.id),this.search="",this.closeOnSelect&&!this.multiple&&this.deactivate();else{if(this.isSelected(t)){l!=="Tab"&&this.removeElement(t);return}this.multiple?this.$emit("update:modelValue",this.internalValue.concat([t])):this.$emit("update:modelValue",t),this.$emit("select",t,this.id),this.clearOnSelect&&(this.search="")}this.closeOnSelect&&this.deactivate()}},selectGroup(t){const l=this.options.find(i=>i[this.groupLabel]===t.$groupLabel);if(l){if(this.wholeGroupSelected(l)){this.$emit("remove",l[this.groupValues],this.id);const i=this.trackBy?l[this.groupValues].map(h=>h[this.trackBy]):l[this.groupValues],k=this.internalValue.filter(h=>i.indexOf(this.trackBy?h[this.trackBy]:h)===-1);this.$emit("update:modelValue",k)}else{const i=l[this.groupValues].filter(k=>!(this.isOptionDisabled(k)||this.isSelected(k)));this.max&&i.splice(this.max-this.internalValue.length),this.$emit("select",i,this.id),this.$emit("update:modelValue",this.internalValue.concat(i))}this.closeOnSelect&&this.deactivate()}},wholeGroupSelected(t){return t[this.groupValues].every(l=>this.isSelected(l)||this.isOptionDisabled(l))},wholeGroupDisabled(t){return t[this.groupValues].every(this.isOptionDisabled)},removeElement(t,l=!0){if(this.disabled||t.$isDisabled)return;if(!this.allowEmpty&&this.internalValue.length<=1){this.deactivate();return}const i=typeof t=="object"?this.valueKeys.indexOf(t[this.trackBy]):this.valueKeys.indexOf(t);if(this.multiple){const k=this.internalValue.slice(0,i).concat(this.internalValue.slice(i+1));this.$emit("update:modelValue",k)}else this.$emit("update:modelValue",null);this.$emit("remove",t,this.id),this.closeOnSelect&&l&&this.deactivate()},removeLastElement(){this.blockKeys.indexOf("Delete")===-1&&this.search.length===0&&Array.isArray(this.internalValue)&&this.internalValue.length&&this.removeElement(this.internalValue[this.internalValue.length-1],!1)},activate(){this.isOpen||this.disabled||(this.adjustPosition(),this.groupValues&&this.pointer===0&&this.filteredOptions.length&&(this.pointer=1),this.isOpen=!0,this.searchable?(this.preserveSearch||(this.search=""),this.preventAutofocus||this.$nextTick(()=>this.$refs.search&&this.$refs.search.focus())):this.preventAutofocus||typeof this.$el<"u"&&this.$el.focus(),this.$emit("open",this.id))},deactivate(){this.isOpen&&(this.isOpen=!1,this.searchable?this.$refs.search!==null&&typeof this.$refs.search<"u"&&this.$refs.search.blur():typeof this.$el<"u"&&this.$el.blur(),this.preserveSearch||(this.search=""),this.$emit("close",this.getValue(),this.id))},toggle(){this.isOpen?this.deactivate():this.activate()},adjustPosition(){if(typeof window>"u")return;const t=this.$el.getBoundingClientRect().top,l=window.innerHeight-this.$el.getBoundingClientRect().bottom;l>this.maxHeight||l>t||this.openDirection==="below"||this.openDirection==="bottom"?(this.preferredOpenDirection="below",this.optimizedHeight=Math.min(l-40,this.maxHeight)):(this.preferredOpenDirection="above",this.optimizedHeight=Math.min(t-40,this.maxHeight))},filterOptions(t,l,i,k){return l?t.filter(h=>bl(k(h,i),l)).sort((h,y)=>typeof this.filteringSortFunc=="function"?this.filteringSortFunc(h,y):k(h,i).length-k(y,i).length):t},filterGroups(t,l,i,k,h){return y=>y.map(o=>{if(!o[i])return console.warn("Options passed to vue-multiselect do not contain groups, despite the config."),[];const v=this.filterOptions(o[i],t,l,h);return v.length?{[k]:o[k],[i]:v}:[]})}}},_l={data(){return{pointer:0,pointerDirty:!1}},props:{showPointer:{type:Boolean,default:!0},optionHeight:{type:Number,default:40}},computed:{pointerPosition(){return this.pointer*this.optionHeight},visibleElements(){return this.optimizedHeight/this.optionHeight}},watch:{filteredOptions(){this.pointerAdjust()},isOpen(){this.pointerDirty=!1},pointer(){this.$refs.search&&this.$refs.search.setAttribute("aria-activedescendant",this.id+"-"+this.pointer.toString())}},methods:{optionHighlight(t,l){return{"multiselect__option--highlight":t===this.pointer&&this.showPointer,"multiselect__option--selected":this.isSelected(l)}},groupHighlight(t,l){if(!this.groupSelect)return["multiselect__option--disabled",{"multiselect__option--group":l.$isLabel}];const i=this.options.find(k=>k[this.groupLabel]===l.$groupLabel);return i&&!this.wholeGroupDisabled(i)?["multiselect__option--group",{"multiselect__option--highlight":t===this.pointer&&this.showPointer},{"multiselect__option--group-selected":this.wholeGroupSelected(i)}]:"multiselect__option--disabled"},addPointerElement({key:t}="Enter"){this.filteredOptions.length>0&&this.select(this.filteredOptions[this.pointer],t),this.pointerReset()},pointerForward(){var t;this.pointer<this.filteredOptions.length-1&&(this.pointer++,((t=this.$refs.list)==null?void 0:t.scrollTop)<=this.pointerPosition-(this.visibleElements-1)*this.optionHeight&&(this.$refs.list.scrollTop=this.pointerPosition-(this.visibleElements-1)*this.optionHeight),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()),this.pointerDirty=!0},pointerBackward(){var t;this.pointer>0?(this.pointer--,((t=this.$refs.list)==null?void 0:t.scrollTop)>=this.pointerPosition&&(this.$refs.list.scrollTop=this.pointerPosition),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerBackward()):this.filteredOptions[this.pointer]&&this.filteredOptions[0].$isLabel&&!this.groupSelect&&this.pointerForward(),this.pointerDirty=!0},pointerReset(){this.closeOnSelect&&(this.pointer=0,this.$refs.list&&(this.$refs.list.scrollTop=0))},pointerAdjust(){this.pointer>=this.filteredOptions.length-1&&(this.pointer=this.filteredOptions.length?this.filteredOptions.length-1:0),this.filteredOptions.length>0&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()},pointerSet(t){this.pointer=t,this.pointerDirty=!0}}},Fe={name:"vue-multiselect",mixins:[kl,_l],compatConfig:{MODE:3,ATTR_ENUMERATED_COERCION:!1},props:{name:{type:String,default:""},modelValue:{type:null,default(){return[]}},selectLabel:{type:String,default:"Press enter to select"},selectGroupLabel:{type:String,default:"Press enter to select group"},selectedLabel:{type:String,default:"Selected"},deselectLabel:{type:String,default:"Press enter to remove"},deselectGroupLabel:{type:String,default:"Press enter to deselect group"},showLabels:{type:Boolean,default:!0},limit:{type:Number,default:99999},maxHeight:{type:Number,default:300},limitText:{type:Function,default:t=>`and ${t} more`},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},spellcheck:{type:Boolean,default:!1},openDirection:{type:String,default:""},showNoOptions:{type:Boolean,default:!0},showNoResults:{type:Boolean,default:!0},tabindex:{type:Number,default:0},required:{type:Boolean,default:!1},useTeleport:{type:Boolean,default:!1}},data(){return{dropdownStyles:{},ready:!1}},computed:{hasOptionGroup(){return this.groupValues&&this.groupLabel&&this.groupSelect},isSingleLabelVisible(){return(this.singleValue||this.singleValue===0)&&(!this.isOpen||!this.searchable)&&!this.visibleValues.length},isPlaceholderVisible(){return!this.internalValue.length&&(!this.searchable||!this.isOpen)},visibleValues(){return this.multiple?this.internalValue.slice(0,this.limit):[]},singleValue(){return this.internalValue[0]},deselectLabelText(){return this.showLabels?this.deselectLabel:""},deselectGroupLabelText(){return this.showLabels?this.deselectGroupLabel:""},selectLabelText(){return this.showLabels?this.selectLabel:""},selectGroupLabelText(){return this.showLabels?this.selectGroupLabel:""},selectedLabelText(){return this.showLabels?this.selectedLabel:""},inputStyle(){return this.searchable||this.multiple&&this.modelValue&&this.modelValue.length?this.isOpen?{width:"100%"}:{width:"0",position:"absolute",padding:"0"}:""},contentStyle(){return this.options.length?{display:"inline-block"}:{display:"block"}},isAbove(){return this.openDirection==="above"||this.openDirection==="top"?!0:this.openDirection==="below"||this.openDirection==="bottom"?!1:this.preferredOpenDirection==="above"},showSearchInput(){return this.searchable&&(this.hasSingleSelectedSlot&&(this.visibleSingleValue||this.visibleSingleValue===0)?this.isOpen:!0)},isRequired(){return this.required===!1?!1:this.internalValue.length<=0}},watch:{isOpen(t){t&&(this.useTeleport?(this.ready=!1,this.$nextTick(()=>{const l=this.$el.getBoundingClientRect();this.dropdownStyles={position:"absolute",top:`${l.bottom+window.scrollY}px`,left:`${l.left+window.scrollX}px`,width:`${l.width}px`,zIndex:9999},this.ready=!0})):this.ready=!0)}}};const $l=["tabindex","aria-expanded","aria-owns","aria-activedescendant"],wl={ref:"tags",class:"multiselect__tags"},Sl={class:"multiselect__tags-wrap"},Al=["textContent"],Tl=["onKeypress","onMousedown"],Cl=["textContent"],Vl={class:"multiselect__spinner"},Pl=["name","id","spellcheck","placeholder","required","value","disabled","tabindex","aria-label","aria-controls"],Ll=["id","aria-multiselectable"],Ol={key:0},Bl={class:"multiselect__option"},Nl=["aria-selected","id","role"],xl=["onClick","onMouseenter","data-select","data-selected","data-deselect"],Ml=["data-select","data-deselect","onMouseenter","onMousedown"],Fl={class:"multiselect__option"},Dl={class:"multiselect__option"};function El(t,l,i,k,h,y){return a(),n("div",{tabindex:t.searchable?-1:i.tabindex,class:D([{"multiselect--active":t.isOpen,"multiselect--disabled":i.disabled,"multiselect--above":y.isAbove,"multiselect--has-options-group":y.hasOptionGroup},"multiselect"]),onFocus:l[14]||(l[14]=o=>t.activate()),onBlur:l[15]||(l[15]=o=>t.searchable?!1:t.deactivate()),onKeydown:[l[16]||(l[16]=j(B(o=>t.pointerForward(),["self","prevent"]),["down"])),l[17]||(l[17]=j(B(o=>t.pointerBackward(),["self","prevent"]),["up"]))],onKeypress:l[18]||(l[18]=j(B(o=>t.addPointerElement(o),["stop","self"]),["enter","tab"])),onKeyup:l[19]||(l[19]=j(o=>t.deactivate(),["esc"])),role:"combobox","aria-expanded":t.isOpen,"aria-owns":"listbox-"+t.id,"aria-activedescendant":t.isOpen&&t.pointer!==null?t.id+"-"+t.pointer:null},[z(t.$slots,"caret",{toggle:t.toggle},()=>[e("div",{onMousedown:l[0]||(l[0]=B(o=>t.toggle(),["prevent","stop"])),class:"multiselect__select"},null,32)]),z(t.$slots,"clear",{search:t.search}),e("div",wl,[z(t.$slots,"selection",{search:t.search,remove:t.removeElement,values:y.visibleValues,isOpen:t.isOpen},()=>[L(e("div",Sl,[(a(!0),n(E,null,U(y.visibleValues,(o,v)=>z(t.$slots,"tag",{option:o,search:t.search,remove:t.removeElement},()=>[(a(),n("span",{class:"multiselect__tag",key:v,onMousedown:l[1]||(l[1]=B(()=>{},["prevent"]))},[e("span",{textContent:b(t.getOptionLabel(o))},null,8,Al),e("i",{tabindex:"1",onKeypress:j(B(C=>t.removeElement(o),["prevent"]),["enter"]),onMousedown:B(C=>t.removeElement(o),["prevent"]),class:"multiselect__tag-icon"},null,40,Tl)],32))])),256))],512),[[ue,y.visibleValues.length>0]]),t.internalValue&&t.internalValue.length>i.limit?z(t.$slots,"limit",{key:0},()=>[e("strong",{class:"multiselect__strong",textContent:b(i.limitText(t.internalValue.length-i.limit))},null,8,Cl)]):S("v-if",!0)]),H(G,{name:"multiselect__loading"},{default:R(()=>[z(t.$slots,"loading",{},()=>[L(e("div",Vl,null,512),[[ue,i.loading]])])]),_:3}),t.searchable?(a(),n("input",{key:0,ref:"search",name:i.name,id:t.id,type:"text",autocomplete:"off",spellcheck:i.spellcheck,placeholder:t.placeholder,required:y.isRequired,style:pe(y.inputStyle),value:t.search,disabled:i.disabled,tabindex:i.tabindex,"aria-label":i.name+"-searchbox",onInput:l[2]||(l[2]=o=>t.updateSearch(o.target.value)),onFocus:l[3]||(l[3]=B(o=>t.activate(),["prevent"])),onBlur:l[4]||(l[4]=B(o=>t.deactivate(),["prevent"])),onKeyup:l[5]||(l[5]=j(o=>t.deactivate(),["esc"])),onKeydown:[l[6]||(l[6]=j(B(o=>t.pointerForward(),["prevent"]),["down"])),l[7]||(l[7]=j(B(o=>t.pointerBackward(),["prevent"]),["up"])),l[9]||(l[9]=j(B(o=>t.removeLastElement(),["stop"]),["delete"]))],onKeypress:l[8]||(l[8]=j(B(o=>t.addPointerElement(o),["prevent","stop","self"]),["enter"])),class:"multiselect__input","aria-controls":"listbox-"+t.id},null,44,Pl)):S("v-if",!0),y.isSingleLabelVisible?(a(),n("span",{key:1,class:"multiselect__single",onMousedown:l[10]||(l[10]=B((...o)=>t.toggle&&t.toggle(...o),["prevent"]))},[z(t.$slots,"singleLabel",{option:y.singleValue},()=>[M(b(t.currentOptionLabel),1)])],32)):S("v-if",!0),y.isPlaceholderVisible?(a(),n("span",{key:2,class:"multiselect__placeholder",onMousedown:l[11]||(l[11]=B((...o)=>t.toggle&&t.toggle(...o),["prevent"]))},[z(t.$slots,"placeholder",{},()=>[M(b(t.placeholder),1)])],32)):S("v-if",!0)],512),(a(),J(ze,{to:"body",disabled:!i.useTeleport},[H(G,{name:"multiselect"},{default:R(()=>[t.isOpen&&h.ready?(a(),n("div",{key:0,class:"multiselect__content-wrapper",onFocus:l[12]||(l[12]=(...o)=>t.activate&&t.activate(...o)),tabindex:"-1",onMousedown:l[13]||(l[13]=B(()=>{},["prevent"])),style:pe([h.dropdownStyles,{maxHeight:t.optimizedHeight+"px"}]),ref:"list"},[e("ul",{class:"multiselect__content",style:pe(y.contentStyle),role:"listbox",id:"listbox-"+t.id,"aria-multiselectable":t.multiple},[z(t.$slots,"beforeList"),t.multiple&&t.max===t.internalValue.length?(a(),n("li",Ol,[e("span",Bl,[z(t.$slots,"maxElements",{},()=>[M("Maximum of "+b(t.max)+" options selected. First remove a selected option to select another.",1)])])])):S("v-if",!0),!t.max||t.internalValue.length<t.max?(a(!0),n(E,{key:1},U(t.filteredOptions,(o,v)=>(a(),n("li",{class:"multiselect__element",key:v,"aria-selected":t.isSelected(o),id:t.id+"-"+v,role:o&&(o.$isLabel||o.$isDisabled)?null:"option"},[o&&(o.$isLabel||o.$isDisabled)?S("v-if",!0):(a(),n("span",{key:0,class:D([t.optionHighlight(v,o),"multiselect__option"]),onClick:B(C=>t.select(o),["stop"]),onMouseenter:B(C=>t.pointerSet(v),["self"]),"data-select":o&&o.isTag?t.tagPlaceholder:y.selectLabelText,"data-selected":y.selectedLabelText,"data-deselect":y.deselectLabelText},[z(t.$slots,"option",{option:o,search:t.search,index:v},()=>[e("span",null,b(t.getOptionLabel(o)),1)])],42,xl)),o&&(o.$isLabel||o.$isDisabled)?(a(),n("span",{key:1,"data-select":t.groupSelect&&y.selectGroupLabelText,"data-deselect":t.groupSelect&&y.deselectGroupLabelText,class:D([t.groupHighlight(v,o),"multiselect__option"]),onMouseenter:B(C=>t.groupSelect&&t.pointerSet(v),["self"]),onMousedown:B(C=>t.selectGroup(o),["prevent"])},[z(t.$slots,"option",{option:o,search:t.search,index:v},()=>[e("span",null,b(t.getOptionLabel(o)),1)])],42,Ml)):S("v-if",!0)],8,Nl))),128)):S("v-if",!0),L(e("li",null,[e("span",Fl,[z(t.$slots,"noResult",{search:t.search},()=>[l[20]||(l[20]=M("No elements found. Consider changing the search query."))])])],512),[[ue,i.showNoResults&&t.filteredOptions.length===0&&t.search&&!i.loading]]),L(e("li",null,[e("span",Dl,[z(t.$slots,"noOptions",{},()=>[l[21]||(l[21]=M("List is empty."))])])],512),[[ue,i.showNoOptions&&(t.options.length===0||y.hasOptionGroup===!0&&t.filteredOptions.length===0)&&!t.search&&!i.loading]]),z(t.$slots,"afterList")],12,Ll)],36)):S("v-if",!0)]),_:3})],8,["disabled"]))],42,$l)}Fe.render=El;const Ul={class:"modal-overlay"},zl={class:"modal-content"},Il={class:"modal-header"},Rl={class:"modal-body"},Hl={key:0,class:"mb-3"},ql={class:"selected-action-plans-display"},Gl={key:1,class:"alert alert-warning mb-3"},jl={class:"d-flex justify-content-between align-items-center"},Kl={key:0,class:"text-success fw-bold"},Ql={class:"selected-lead-tag"},Yl=["onClick"],Xl={class:"modal-footer"},Zl=["disabled"],Jl={key:0,class:"spinner-border spinner-border-sm me-1"},Wl={__name:"AssignUserModal",props:{selectedActionPlanIds:{type:Array,required:!0}},emits:["close"],setup(t,{emit:l}){const i=t,k=l,h=A([]),y=A([]),o=A(!1),v=A([]),C=(T,g="success")=>{typeof Swal<"u"?Swal.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:g,title:T,didOpen:d=>{d.addEventListener("mouseenter",Swal.stopTimer),d.addEventListener("mouseleave",Swal.resumeTimer)}}):console.warn("Swal is not defined. Toast message not shown:",T)},p=async()=>{try{const T=localStorage.getItem("auth_token"),{data:g}=await N.get("/api/leads",{headers:{Authorization:`Bearer ${T}`}});y.value=g.map(d=>({id:d.id,full_name:`${d.first_name} ${d.last_name||""}`.trim()}))}catch(T){console.error("Error fetching leads:",T),C("Failed to load leads.","error")}},V=async()=>{try{const T=localStorage.getItem("auth_token"),g=await N.get("/api/automation/action-plans",{headers:{Authorization:`Bearer ${T}`}});v.value=g.data.data??g.data}catch(T){console.error("Failed to load all action plans for name lookup:",T)}},w=T=>{const g=v.value.find(d=>d.id===T);return g?g.name:`Plan ID: ${T}`},$=async()=>{var T,g;o.value=!0;try{const d=localStorage.getItem("auth_token");await N.post("/api/assign-action-plans",{action_plan_ids:i.selectedActionPlanIds,lead_ids:h.value.map(u=>u.id)},{headers:{Authorization:`Bearer ${d}`}}),C("Action Plans assigned successfully!"),k("close")}catch(d){console.error("Assignment error:",d);const u=((g=(T=d.response)==null?void 0:T.data)==null?void 0:g.message)||"Failed to assign action plans.";C(u,"error")}finally{o.value=!1}};return te(()=>{p(),V()}),fe(()=>i.selectedActionPlanIds,T=>{},{immediate:!0}),(T,g)=>(a(),n("div",Ul,[e("div",zl,[e("div",Il,[g[3]||(g[3]=e("h5",null,"Assign Action Plans to Leads",-1)),e("button",{class:"btn-close",onClick:g[0]||(g[0]=d=>T.$emit("close"))})]),e("div",Rl,[t.selectedActionPlanIds.length>0?(a(),n("div",Hl,[g[4]||(g[4]=e("label",{class:"form-label mb-2"},"Selected Action Plan(s) to Assign:",-1)),e("div",ql,[(a(!0),n(E,null,U(t.selectedActionPlanIds,d=>(a(),n("span",{key:d,class:"badge bg-primary me-1"},b(w(d)),1))),128))])])):(a(),n("div",Gl," No action plans selected from the table. Please select action plans first. ")),g[5]||(g[5]=e("label",{class:"form-label mb-2"},"Select Leads:",-1)),H(Ie(Fe),{modelValue:h.value,"onUpdate:modelValue":g[1]||(g[1]=d=>h.value=d),options:y.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Search leads",label:"full_name","track-by":"id",class:"lead-multiselect"},{option:R(({option:d,isSelected:u})=>[e("div",jl,[e("span",null,b(d.full_name),1),u?(a(),n("span",Kl,"✔")):S("",!0)])]),tag:R(({option:d,remove:u})=>[e("div",Ql,[M(b(d.full_name)+" ",1),e("span",{onClick:B(_=>u(d),["stop"])},"×",8,Yl)])]),_:1},8,["modelValue","options"])]),e("div",Xl,[e("button",{class:"btn btn-secondary",onClick:g[2]||(g[2]=d=>T.$emit("close"))},"Cancel"),e("button",{class:"btn btn-primary",onClick:$,disabled:h.value.length===0||t.selectedActionPlanIds.length===0||o.value},[o.value?(a(),n("span",Jl)):S("",!0),g[6]||(g[6]=M(" Assign "))],8,Zl)])])]))}},ea=ee(Wl,[["__scopeId","data-v-813e60fb"]]),ta={class:"modal-overlay-custom"},sa={class:"modal-content-custom-wide"},la={class:"modal-header-custom"},aa={class:"modal-body-custom"},oa={class:"table-responsive"},na={class:"table table-bordered table-hover align-middle"},ia={key:0},ra={key:1},da={key:0},ua={key:1},ca=["onClick","disabled"],pa={key:0,class:"spinner-border spinner-border-sm me-1"},ma=["onClick","disabled"],ha={key:0,class:"spinner-border spinner-border-sm me-1"},fa={key:2},ga={class:"modal-footer-custom"},va={__name:"LeadActionPlanAssignmentsModal",emits:["close"],setup(t,{emit:l}){const i=A([]),k=A(!0),h=localStorage.getItem("auth_token"),y=(V,w="success")=>{typeof Swal<"u"&&Swal.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:w,title:V,didOpen:$=>{$.addEventListener("mouseenter",Swal.stopTimer),$.addEventListener("mouseleave",Swal.resumeTimer)}})},o=async()=>{k.value=!0;try{const V=await N.get("/api/lead-action-plan-assignments",{headers:{Authorization:`Bearer ${h}`}});i.value=(V.data.data||[]).map(w=>({...w,isUpdatingStatus:!1}))}catch(V){console.error("Failed to load assignments:",V),y("Failed to load assigned action plans.","error"),i.value=[]}finally{k.value=!1}},v=async(V,w)=>{var $,T;V.isUpdatingStatus=!0;try{const d=(await N.post(`/api/lead-action-plan-assignments/${V.id}/status`,{status:w},{headers:{Authorization:`Bearer ${h}`}})).data.data,u=i.value.findIndex(_=>_.id===d.id);u!==-1&&(i.value[u].status=d.status,i.value[u].next_action_due_at=d.next_action_due_at),y(`Action Plan status updated to '${w}' successfully!`)}catch(g){console.error(`Failed to update status for assignment ${V.id}:`,g);const d=((T=($=g.response)==null?void 0:$.data)==null?void 0:T.message)||`Failed to update status to '${w}'.`;y(d,"error")}finally{V.isUpdatingStatus=!1}},C=V=>V?new Date(V).toLocaleString():"N/A",p=V=>{switch(V){case"active":return"badge bg-success";case"paused":return"badge bg-warning text-dark";case"completed":return"badge bg-info";case"stopped":return"badge bg-danger";default:return"badge bg-secondary"}};return te(o),(V,w)=>(a(),n("div",ta,[e("div",sa,[e("div",la,[w[2]||(w[2]=e("h5",{class:"modal-title-custom"},"Assigned Action Plans to Leads",-1)),e("button",{type:"button",class:"close-button-custom",onClick:w[0]||(w[0]=$=>V.$emit("close"))}," × ")]),e("div",aa,[e("div",oa,[e("table",na,[w[7]||(w[7]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Lead Name"),e("th",null,"Action Plan"),e("th",null,"Status"),e("th",null,"Current Action"),e("th",null,"Next Due Date"),e("th",null,"Assigned At"),e("th",null,"Actions")])],-1)),e("tbody",null,[k.value?(a(),n("tr",ia,w[3]||(w[3]=[e("td",{colspan:"7",class:"text-center py-4"},"Loading assignments...",-1)]))):i.value.length===0?(a(),n("tr",ra,w[4]||(w[4]=[e("td",{colspan:"7",class:"text-center py-4"},"No action plans assigned to leads yet.",-1)]))):(a(!0),n(E,{key:2},U(i.value,$=>{var T,g,d,u,_,O;return a(),n("tr",{key:$.id},[e("td",null,b((T=$.lead)==null?void 0:T.first_name)+" "+b((g=$.lead)==null?void 0:g.last_name),1),e("td",null,b((d=$.action_plan)==null?void 0:d.name),1),e("td",null,[e("span",{class:D(p($.status))},b($.status),3)]),e("td",null,[M(b(((u=$.current_action)==null?void 0:u.type)||"N/A")+" ",1),(_=$.current_action)!=null&&_.task_name?(a(),n("span",da," ("+b($.current_action.task_name)+")",1)):(O=$.current_action)!=null&&O.note_content?(a(),n("span",ua," (Note)")):S("",!0)]),e("td",null,b(C($.next_action_due_at)),1),e("td",null,b(C($.assigned_at)),1),e("td",null,[$.status==="active"?(a(),n("button",{key:0,class:"btn btn-sm btn-warning",onClick:se=>v($,"paused"),disabled:$.isUpdatingStatus},[$.isUpdatingStatus?(a(),n("span",pa)):S("",!0),w[5]||(w[5]=M(" Pause "))],8,ca)):$.status==="paused"?(a(),n("button",{key:1,class:"btn btn-sm btn-success",onClick:se=>v($,"active"),disabled:$.isUpdatingStatus},[$.isUpdatingStatus?(a(),n("span",ha)):S("",!0),w[6]||(w[6]=M(" Resume "))],8,ma)):(a(),n("span",fa,"N/A"))])])}),128))])])])]),e("div",ga,[e("button",{type:"button",class:"btn btn-secondary-custom",onClick:w[1]||(w[1]=$=>V.$emit("close"))}," Close ")])])]))}},ba=ee(va,[["__scopeId","data-v-447707ca"]]),ya={class:"action-bar d-flex justify-content-between align-items-center gap-2 my-3 flex-wrap"},ka={class:"d-flex align-items-center gap-2 flex-wrap"},_a=["disabled"],$a=["disabled"],wa=["disabled"],Sa=["disabled"],Aa={class:"table-responsive"},Ta={class:"table table-bordered table-hover align-middle"},Ca={class:"table-light"},Va=["checked"],Pa={key:0},La={key:1},Oa=["value"],Ba=["onClick"],Na={__name:"Actionplansmain",setup(t){const l=localStorage.getItem("auth_token");l&&(N.defaults.headers.common.Authorization=`Bearer ${l}`);const i=A([]),k=A(!0),h=A([]),y=W(()=>h.value.length===i.value.length&&i.value.length>0),o=()=>{h.value=y.value?[]:i.value.map(F=>F.id)},v=A(!1),C=A(null),p=A(!1),V=A(!1),w=A(!1),$=A(!1),T=A(!1),g=W(()=>h.value.length===0),d=(F,m="success")=>{typeof Swal<"u"&&Swal.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:m,title:F,didOpen:P=>{P.addEventListener("mouseenter",Swal.stopTimer),P.addEventListener("mouseleave",Swal.resumeTimer)}})},u=async()=>{k.value=!0;try{const F=await N.get("/api/automation/action-plans?include=actions,creator");i.value=F.data.data||[]}catch(F){console.error("Failed to load action plans:",F),d("Failed to load action plans.","error"),i.value=[]}finally{k.value=!1}},_=()=>{C.value=null,v.value=!0},O=F=>{N.get(`/api/automation/action-plans/${F.id}?include=actions`).then(m=>{C.value=m.data.data,v.value=!0}).catch(m=>{console.error("Failed to fetch action plan for edit:",m),d("Failed to load action plan details for editing.","error")})},se=async F=>{var m,P;try{F.id?(await N.put(`/api/automation/action-plans/${F.id}`,F),d("Action Plan updated successfully!")):(await N.post("/api/automation/action-plan",F),d("Action Plan added successfully!")),oe(),await u()}catch(x){console.error("Failed to save action plan:",x);const Y=((P=(m=x.response)==null?void 0:m.data)==null?void 0:P.message)||"Something went wrong.";d(Y,"error")}},oe=()=>{v.value=!1,C.value=null};return te(()=>{u()}),(F,m)=>(a(),n("div",null,[e("div",ya,[m[17]||(m[17]=e("div",{class:"fw-bold fs-5 text-dark"},"Action Bar",-1)),e("div",ka,[e("button",{class:"btn btn-success",onClick:_,title:"Add New Action Plan"},m[11]||(m[11]=[e("i",{class:"fas fa-plus"},null,-1),M(" Add Action Plan ")])),e("button",{class:"btn btn-warning",disabled:g.value,onClick:m[0]||(m[0]=P=>p.value=!0),title:"Assign to Lead"},m[12]||(m[12]=[e("i",{class:"fas fa-user"},null,-1),M(" Assign User ")]),8,_a),e("button",{class:"btn btn-warning",disabled:g.value,onClick:m[1]||(m[1]=P=>V.value=!0),title:"Assign Tag"},m[13]||(m[13]=[e("i",{class:"fas fa-tags"},null,-1),M(" Assign Tag ")]),8,$a),e("button",{class:"btn btn-warning",disabled:g.value,onClick:m[2]||(m[2]=P=>w.value=!0),title:"Assign Stage"},m[14]||(m[14]=[e("i",{class:"fas fa-calendar-alt"},null,-1),M(" Assign Stage ")]),8,wa),e("button",{class:"btn btn-warning",disabled:g.value,onClick:m[3]||(m[3]=P=>$.value=!0),title:"Assign Source"},m[15]||(m[15]=[e("i",{class:"fas fa-globe"},null,-1),M(" Assign Source ")]),8,Sa),e("button",{class:"btn btn-info",onClick:m[4]||(m[4]=P=>T.value=!0),title:"View Assigned Action Plans"},m[16]||(m[16]=[e("i",{class:"fas fa-list-alt"},null,-1),M(" View Assignments ")]))])]),e("div",Aa,[e("table",Ta,[e("thead",Ca,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",onChange:o,checked:y.value},null,40,Va)]),m[18]||(m[18]=e("th",null,"Name",-1)),m[19]||(m[19]=e("th",null,"Steps",-1)),m[20]||(m[20]=e("th",null,"Active",-1)),m[21]||(m[21]=e("th",null,"Paused",-1)),m[22]||(m[22]=e("th",null,"Stopped",-1)),m[23]||(m[23]=e("th",null,"Completed",-1)),m[24]||(m[24]=e("th",null,"Created By",-1)),m[25]||(m[25]=e("th",null,"Actions",-1))])]),e("tbody",null,[k.value?(a(),n("tr",Pa,m[26]||(m[26]=[e("td",{colspan:"9",class:"text-center py-4"},"Loading action plans...",-1)]))):i.value.length===0?(a(),n("tr",La,m[27]||(m[27]=[e("td",{colspan:"9",class:"text-center py-4"},"No action plans found.",-1)]))):(a(!0),n(E,{key:2},U(i.value,P=>{var x,Y,ne,ie,le;return a(),n("tr",{key:P.id},[e("td",null,[L(e("input",{type:"checkbox",value:P.id,"onUpdate:modelValue":m[5]||(m[5]=re=>h.value=re)},null,8,Oa),[[ae,h.value]])]),e("td",null,b(P.name),1),e("td",null,b(P.step_count),1),e("td",null,b(((x=P.tracking_stats)==null?void 0:x.active)||0),1),e("td",null,b(((Y=P.tracking_stats)==null?void 0:Y.paused)||0),1),e("td",null,b(((ne=P.tracking_stats)==null?void 0:ne.stopped)||0),1),e("td",null,b(((ie=P.tracking_stats)==null?void 0:ie.completed)||0),1),e("td",null,b(((le=P.creator)==null?void 0:le.name)||"N/A"),1),e("td",null,[e("button",{class:"btn btn-sm btn-info",onClick:re=>O(P),title:"Edit Action Plan"},m[28]||(m[28]=[e("i",{class:"fas fa-edit"},null,-1),M(" Edit ")]),8,Ba)])])}),128))])])]),v.value?(a(),J(is,{key:0,initialData:C.value,onClose:oe,onSubmit:se},null,8,["initialData"])):S("",!0),p.value?(a(),J(ea,{key:1,onClose:m[6]||(m[6]=P=>p.value=!1),selectedActionPlanIds:h.value},null,8,["selectedActionPlanIds"])):S("",!0),V.value?(a(),J(gl,{key:2,onClose:m[7]||(m[7]=P=>V.value=!1),selected:h.value},null,8,["selected"])):S("",!0),w.value?(a(),J(Ys,{key:3,onClose:m[8]||(m[8]=P=>w.value=!1),selected:h.value},null,8,["selected"])):S("",!0),$.value?(a(),J(Vs,{key:4,onClose:m[9]||(m[9]=P=>$.value=!1),selected:h.value},null,8,["selected"])):S("",!0),T.value?(a(),J(ba,{key:5,onClose:m[10]||(m[10]=P=>T.value=!1)})):S("",!0)]))}},Ea=ee(Na,[["__scopeId","data-v-7ec8aea7"]]);export{Ea as default};
