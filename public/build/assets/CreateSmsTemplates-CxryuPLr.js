import{_ as be,r as u,b as I,R as he,l as s,j as t,P as C,L as g,bo as S,F as D,Z as P,k as d,$ as m,n as $,Y as K,h as Y,u as R,o}from"./main-BxCp_q14.js";import{E as W}from"./Editor-B7Lhi41L.js";import{a as f}from"./axios-CdtiCRuU.js";import"./bootstrap.min-DQoSNxk7.js";import{S as i}from"./sweetalert2.all-DyJFIm0t.js";import"./_commonjsHelpers-BosuxZz1.js";const ye={class:"container py-4"},ge={class:"d-flex justify-content-between align-items-center mb-4"},_e={key:0,class:"table-responsive"},Ce={class:"table table-bordered table-hover"},ke=["onClick"],we=["onClick"],xe=["onClick"],Fe={key:0,class:"d-flex justify-content-between align-items-center mt-2"},Te=["disabled"],Se=["disabled"],$e={key:1},Ee={class:"d-flex align-items-center mb-3"},Me={class:"list-group"},Be={key:0,class:"list-group-item text-muted fst-italic"},Ve={key:1,class:"table-auto w-full border text-left"},Ae={class:"p-2"},De={class:"p-2"},Pe=["innerHTML"],Ne={class:"p-2"},Ue={class:"p-2"},je=["href"],Le={key:1},ze={class:"p-2"},Ie={class:"p-2 flex gap-2"},qe=["onClick"],Xe=["onClick"],Ge={key:2,class:"modal fade show d-block",tabindex:"-1"},He={class:"modal-dialog"},Oe={class:"modal-content"},Je={class:"modal-header"},Ke={class:"modal-body"},Ye={class:"modal-footer"},Re={key:3,class:"modal fade show d-block",tabindex:"-1"},We={class:"modal-dialog"},Ze={class:"modal-content"},Qe={class:"modal-header"},et={class:"modal-body"},tt={class:"modal-footer"},lt={key:4,class:"modal fade show d-block",tabindex:"-1"},at={class:"modal-dialog modal-xl"},st={class:"modal-content"},ot={class:"modal-header"},nt={class:"modal-body"},it={class:"row g-3"},dt={class:"col-md-6"},rt={key:0,class:"invalid-feedback"},ut={class:"col-md-6"},ct={class:"input-group"},mt=["value"],vt={key:0,class:"invalid-feedback"},pt={class:"col-12"},ft={key:0,class:"text-danger mt-1"},bt={class:"col-12"},ht={key:0,class:"text-danger small mt-1"},yt={class:"modal-footer"},gt={key:5,class:"modal fade show d-block",tabindex:"-1"},_t={class:"modal-dialog modal-xl"},Ct={class:"modal-content"},kt={class:"modal-body"},wt={class:"row g-3"},xt={class:"col-md-6"},Ft={key:0,class:"invalid-feedback"},Tt={class:"col-md-6"},St={class:"input-group"},$t=["value"],Et={key:0,class:"invalid-feedback"},Mt={class:"col-12"},Bt={key:0,class:"text-danger mt-1"},Vt={class:"col-12"},N=10,At={__name:"CreateSmsTemplates",setup(Dt){const _=u("folders"),b=u(null),q=u(!1),k=u(!1),p=u([]),E=u([]),w=u(null),U=u(""),X=u([]),x=u(!1),F=u(!1),y=u({name:""}),c=u({title:"",folder_id:"",subject:"",content:"",attachment:null}),G={height:300,menubar:!1,plugins:"link lists image code",toolbar:"undo redo | formatselect | bold italic underline | alignleft aligncenter alignright | bullist numlist outdent indent | image link code | mergefields signatures",branding:!1,resize:!0,automatic_uploads:!0,images_upload_handler:l=>new Promise((e,a)=>{const r=l.blob();if(r.size>51200){a("Image size must be less than 50KB");return}const A=new FormData;A.append("file",r,l.filename()),f.post("/api/upload-image",A).then(T=>{T.data&&T.data.url?e(T.data.url):a("Upload failed: Invalid response")}).catch(()=>{a("Image upload failed")})}),setup(l){l.ui.registry.addMenuButton("mergefields",{text:"Merge Fields",fetch(e){const a=re.map(r=>({type:"menuitem",text:r,onAction:()=>{l.insertContent(`{{${r}}}`)}}));e(a)}}),l.ui.registry.addMenuButton("signatures",{text:"Signatures",fetch(e){const a=X.value.map(r=>({type:"menuitem",text:r.title,onAction:()=>{const A=`<h4>${r.title}</h4>`,T=r.content||"",pe=r.attachment?`<p><a href="${r.attachment}" target="_blank">ðŸ“Ž Attachment</a></p>`:"",fe=`${A}
${T}
${pe}`;l.insertContent(fe)}}));e(a)}})}},H=localStorage.getItem("auth_token");H&&(f.defaults.headers.common.Authorization=`Bearer ${H}`);const j=I(()=>p.value.filter(l=>l.name.toLowerCase().includes(U.value.toLowerCase()))),Z=l=>{const e=l.target.files[0];if(!e)return;if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","text/plain","image/jpeg","image/png","image/jpg"].includes(e.type)){i.fire("Invalid File","Allowed file types: PDF, DOC, DOCX, TXT, JPG, PNG, XLS","warning"),l.target.value="";return}if(e.size>300*1024){i.fire("File Too Large","Max allowed size is 300KB.","warning"),l.target.value="";return}c.value.attachment=e},L=async()=>{try{const l=await f.get("/api/folders?type=sms");p.value=l.data}catch{i.fire("Error","Failed to load folders","error")}},n=u({});function O(l){n.value={};let e=!0;return(!l.title||l.title.trim()==="")&&(n.value.title="Template name is required.",e=!1),l.folder_id||(n.value.folder_id="Please choose a folder.",e=!1),(!l.content||l.content.trim()==="")&&(n.value.content="Content is required.",e=!1),e}const M=async l=>{try{const e=await f.get(`/api/folders/${l}/templates`,{params:{type:"sms"}});E.value=e.data;const a=p.value.find(r=>r.id===l);b.value=a,w.value=l,_.value="folder-view"}catch{i.fire("Error","Could not load templates for this folder","error")}},Q=async()=>{if(!y.value.name.trim()){i.fire("Error","Folder name is required","error");return}if(p.value.some(e=>e.name.trim().toLowerCase()===y.value.name.trim().toLowerCase())){i.fire("Warning","A folder with this name already exists.","warning");return}try{const e=await f.post("/api/folders",{name:y.value.name,type:"sms"});p.value.push(e.data.folder),x.value=!1,y.value.name="",i.fire("Success","Folder created successfully.","success")}catch{i.fire("Error","Could not create folder","error")}},ee=async()=>{if(O(c.value))try{const l=new FormData;l.append("title",c.value.title),l.append("folder_id",c.value.folder_id),l.append("subject",c.value.subject),l.append("content",c.value.content),l.append("type","sms"),c.value.attachment&&l.append("attachment",c.value.attachment),await f.post("/api/templates",l),c.value={title:"",folder_id:"",subject:"",content:"",attachment:null},k.value=!1,_.value==="folder-view"&&w.value?await M(w.value):await L(),i.fire("Success","SMS template saved.","success")}catch{i.fire("Error","Could not save template","error")}},h=u(1),z=I(()=>Math.ceil(j.value.length/N)),te=I(()=>{const l=(h.value-1)*N,e=l+N;return j.value.slice(l,e)}),le=()=>{h.value<z.value&&h.value++},ae=()=>{h.value>1&&h.value--},B=u(!1),V=u(null),v=u({title:"",subject:"",content:"",type:"sms",attachment:null}),se=l=>{B.value=!0,V.value=l.id,v.value={title:l.title,subject:l.subject,content:l.content,folder_id:l.folder_id,type:l.type,attachment:null}},oe=async()=>{if(O(c.value))try{const l=new FormData;l.append("title",v.value.title),l.append("subject",v.value.subject),l.append("content",v.value.content),l.append("type","sms"),l.append("folder_id",v.value.folder_id),v.value.attachment&&l.append("attachment",v.value.attachment),await f.post(`/api/email-templates/${V.value}?_method=PUT`,l,{headers:{"Content-Type":"multipart/form-data"}}),B.value=!1,V.value=null,await M(w.value),i.fire("Updated!","Template updated successfully.","success")}catch(l){console.error(l),i.fire("Error!","Could not update template.","error")}},J=()=>{B.value=!1,V.value=null},ne=async l=>{if((await i.fire({title:"Are you sure?",text:"This will permanently delete the template.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await f.delete(`/api/templates/${l}`),await M(w.value),i.fire("Deleted!","Template has been deleted.","success")}catch{i.fire("Error!","Failed to delete template.","error")}},ie=async()=>{try{const l=await f.get("/api/signature-templates-sms/sms");X.value=l.data}catch{}},de=async()=>{if(!b.value.name.trim()){i.fire("Error","Folder name is required","error");return}try{const l=await f.put(`/api/folders/${b.value.id}`,{name:b.value.name}),e=p.value.findIndex(a=>a.id===b.value.id);e!==-1&&(p.value[e]=l.data.folder),F.value=!1,b.value=null,i.fire("Success","Folder updated successfully.","success"),L()}catch{i.fire("Error","Could not update folder","error")}},re=["first_name","last_name","email","phone","city","zip_code","province","street","house_number","tag","stage","created_at"],ue=l=>{i.fire({title:"Are you sure?",text:"This folder and all its templates will be deleted!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"}).then(async e=>{if(e.isConfirmed)try{await f.delete(`/api/folders/${l}`),p.value=p.value.filter(a=>a.id!==l),i.fire("Deleted!","The folder and its templates have been deleted.","success")}catch{i.fire("Error","Could not delete the folder.","error")}else i.fire("Cancelled","The folder is safe :)","info")})},ce=()=>{y.value.name="",x.value=!0},me=l=>{b.value={...l},F.value=!0},ve=l=>{v.value.attachment=l.target.files[0]};return he(()=>{L(),ie()}),(l,e)=>(o(),s("div",ye,[t("div",ge,[e[21]||(e[21]=t("h2",null,"SMS Templates",-1)),t("div",null,[t("button",{onClick:ce,class:"btn btn-success"},e[19]||(e[19]=[t("i",{class:"fas fa-plus me-1"},null,-1),C(" Create Folder")])),t("button",{onClick:e[0]||(e[0]=a=>k.value=!0),class:"btn btn-success"},e[20]||(e[20]=[t("i",{class:"fas fa-sms me-1"},null,-1),C(" Add SMS Template ")]))])]),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>U.value=a),type:"text",class:"form-control mb-3",placeholder:"Search by folder name"},null,512),[[S,U.value]]),_.value==="folders"?(o(),s("div",_e,[t("table",Ce,[e[24]||(e[24]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Name"),t("th",null,"Templates"),t("th",null,"Created By"),t("th",null,"Action")])],-1)),t("tbody",null,[(o(!0),s(D,null,P(te.value,a=>(o(),s("tr",{key:a.id},[t("td",{onClick:r=>M(a.id),class:"cursor-pointer"},[e[22]||(e[22]=t("i",{class:"fas fa-folder text-warning me-2"},null,-1)),C(d(a.name),1)],8,ke),t("td",null,d(a.template_count),1),t("td",null,d(a.created_by_name),1),t("td",null,[t("button",{onClick:r=>me(a),class:"btn btn-warning"},"Edit",8,we),t("button",{onClick:r=>ue(a.id),class:"bg-red-600 text-white px-2 py-1 rounded"},e[23]||(e[23]=[t("i",{class:"fas fa-trash"},null,-1),C(" Delete ")]),8,xe)])]))),128))])]),j.value.length>N?(o(),s("div",Fe,[t("button",{class:"btn btn-sm btn-outline-secondary",onClick:ae,disabled:h.value===1},"Previous",8,Te),t("span",null,"Page "+d(h.value)+" of "+d(z.value),1),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:le,disabled:h.value===z.value},"Next",8,Se)])):m("",!0)])):_.value==="folder-view"?(o(),s("div",$e,[_.value==="folder-view"?(o(),s("button",{key:0,onClick:e[2]||(e[2]=a=>_.value="folders"),class:"btn btn-secondary mb-3"},e[25]||(e[25]=[t("i",{class:"fas fa-arrow-left me-1"},null,-1),C(" Back to Folders ")]))):m("",!0),t("h3",Ee,[e[26]||(e[26]=t("i",{class:"fas fa-folder text-warning me-2"},null,-1)),C(" "+d(b.value.name),1)]),t("ul",Me,[E.value.length===0?(o(),s("li",Be," No templates in this folder. ")):m("",!0),E.value.length>0?(o(),s("table",Ve,[e[30]||(e[30]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"p-2"},[t("input",{type:"checkbox"})]),t("th",{class:"p-2"},"Title"),t("th",{class:"p-2"},"Created By"),t("th",{class:"p-2"},"Content"),t("th",{class:"p-2"},"Type"),t("th",{class:"p-2"},"Attachment"),t("th",{class:"p-2"},"Created At"),t("th",{class:"p-2"},"Action")])],-1)),t("tbody",null,[(o(!0),s(D,null,P(E.value,a=>(o(),s("tr",{key:a.id,class:"border-b hover:bg-gray-50"},[e[29]||(e[29]=t("td",{class:"p-2"},[t("input",{type:"checkbox"})],-1)),t("td",Ae,d(a.title),1),t("td",De,d(a.created_by),1),t("td",{class:"p-2",innerHTML:a.content},null,8,Pe),t("td",Ne,d(a.type),1),t("td",Ue,[a.attachment_path?(o(),s("a",{key:0,href:`/storage/${a.attachment_path}`,target:"_blank",class:"text-blue-600 underline"}," View Attachment ",8,je)):(o(),s("span",Le,"No Attachment"))]),t("td",ze,d(new Date(a.created_at).toLocaleString()),1),t("td",Ie,[e[28]||(e[28]=t("button",{class:"bg-red-600 text-white px-2 py-1 rounded"},[t("i",{class:"fas fa-eye"})],-1)),t("button",{class:"btn btn-sm btn-warning",onClick:r=>se(a)},"Edit",8,qe),t("button",{onClick:r=>ne(a.id),class:"bg-red-600 text-white px-2 py-1 rounded"},e[27]||(e[27]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Xe)])]))),128))])])):m("",!0)])])):m("",!0),x.value?(o(),s("div",Ge,[t("div",He,[t("div",Oe,[t("div",Je,[e[31]||(e[31]=t("h5",{class:"modal-title"},"Create Folder",-1)),t("button",{type:"button",class:"btn-close",onClick:e[3]||(e[3]=a=>x.value=!1)})]),t("div",Ke,[e[32]||(e[32]=t("label",{class:"form-label"},"* Folder Name",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>y.value.name=a),type:"text",class:"form-control",placeholder:"Enter folder name",required:""},null,512),[[S,y.value.name]])]),t("div",Ye,[t("button",{class:"btn btn-secondary",onClick:e[5]||(e[5]=a=>x.value=!1)},"Cancel"),t("button",{class:"btn btn-primary",onClick:Q}," Create Folder ")])])])])):m("",!0),F.value?(o(),s("div",Re,[t("div",We,[t("div",Ze,[t("div",Qe,[e[33]||(e[33]=t("h5",{class:"modal-title"},"Edit Folder",-1)),t("button",{type:"button",class:"btn-close",onClick:e[6]||(e[6]=a=>F.value=!1)})]),t("div",et,[e[34]||(e[34]=t("label",{class:"form-label"},"* Folder Name",-1)),g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>b.value.name=a),type:"text",class:"form-control",placeholder:"Enter new folder name",required:""},null,512),[[S,b.value.name]])]),t("div",tt,[t("button",{class:"btn btn-secondary",onClick:e[8]||(e[8]=a=>F.value=!1)},"Cancel"),t("button",{class:"btn btn-primary",onClick:de}," Save Changes ")])])])])):m("",!0),k.value?(o(),s("div",lt,[t("div",at,[t("div",st,[t("div",ot,[e[35]||(e[35]=t("h5",{class:"modal-title"},"Add SMS Template",-1)),t("button",{type:"button",class:"btn-close",onClick:e[9]||(e[9]=a=>k.value=!1)})]),t("div",nt,[t("div",it,[t("div",dt,[e[36]||(e[36]=t("label",{class:"form-label"},"* Template Name",-1)),g(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>c.value.title=a),type:"text",class:$(["form-control",{"is-invalid":n.value.title}]),placeholder:"Template Name"},null,2),[[S,c.value.title]]),n.value.title?(o(),s("div",rt,d(n.value.title),1)):m("",!0)]),t("div",ut,[e[38]||(e[38]=t("label",{class:"form-label"},"* Folder",-1)),t("div",ct,[g(t("select",{"onUpdate:modelValue":e[11]||(e[11]=a=>c.value.folder_id=a),class:$(["form-select",{"is-invalid":n.value.folder_id}])},[e[37]||(e[37]=t("option",{value:""},"Choose Folder",-1)),(o(!0),s(D,null,P(p.value,a=>(o(),s("option",{key:a.id,value:a.id},d(a.name),9,mt))),128))],2),[[K,c.value.folder_id]]),t("button",{class:"btn btn-outline-success",type:"button",onClick:e[12]||(e[12]=a=>q.value=!0)},"+")]),n.value.folder_id?(o(),s("div",vt,d(n.value.folder_id),1)):m("",!0)]),t("div",pt,[e[39]||(e[39]=t("label",{class:"form-label"},"* Body",-1)),Y(R(W),{init:G,modelValue:c.value.content,"onUpdate:modelValue":e[13]||(e[13]=a=>c.value.content=a)},null,8,["modelValue"]),n.value.content?(o(),s("div",ft,d(n.value.content),1)):m("",!0)]),t("div",bt,[e[40]||(e[40]=t("label",{for:"attachment",class:"form-label"},"Attachment",-1)),t("input",{id:"attachment",type:"file",class:$(["form-control",{"is-invalid":n.value.attachment}]),onChange:Z,accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.xls"},null,34),e[41]||(e[41]=t("small",{class:"text-muted d-block"}," Allowed types: PDF, DOC, DOCX, TXT, JPG, JPEG, PNG, XLS (Max: 300KB) ",-1)),n.value.attachment?(o(),s("div",ht,d(n.value.attachment),1)):m("",!0)])])]),t("div",yt,[t("button",{class:"btn btn-secondary",onClick:e[14]||(e[14]=a=>k.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",onClick:ee},"Save SMS Template")])])])])):m("",!0),B.value?(o(),s("div",gt,[t("div",_t,[t("div",Ct,[t("div",{class:"modal-header"},[e[42]||(e[42]=t("h5",{class:"modal-title"},"Edit SMS Template",-1)),t("button",{type:"button",class:"btn-close",onClick:J})]),t("div",kt,[t("div",wt,[t("div",xt,[e[43]||(e[43]=t("label",{class:"form-label"},"* Template Name",-1)),g(t("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>v.value.title=a),type:"text",class:$(["form-control",{"is-invalid":n.value.title}]),placeholder:"Template Name"},null,2),[[S,v.value.title]]),n.value.title?(o(),s("div",Ft,d(n.value.title),1)):m("",!0)]),t("div",Tt,[e[45]||(e[45]=t("label",{class:"form-label"},"* Folder",-1)),t("div",St,[g(t("select",{"onUpdate:modelValue":e[16]||(e[16]=a=>v.value.folder_id=a),class:$(["form-select",{"is-invalid":n.value.folder_id}])},[e[44]||(e[44]=t("option",{value:""},"Choose Folder",-1)),(o(!0),s(D,null,P(p.value,a=>(o(),s("option",{key:a.id,value:a.id},d(a.name),9,$t))),128))],2),[[K,v.value.folder_id]]),t("button",{class:"btn btn-outline-success",type:"button",onClick:e[17]||(e[17]=a=>q.value=!0)},"+")]),n.value.folder_id?(o(),s("div",Et,d(n.value.folder_id),1)):m("",!0)]),t("div",Mt,[e[46]||(e[46]=t("label",{class:"form-label"},"* Body",-1)),Y(R(W),{init:G,modelValue:v.value.content,"onUpdate:modelValue":e[18]||(e[18]=a=>v.value.content=a)},null,8,["modelValue"]),n.value.content?(o(),s("div",Bt,d(n.value.content),1)):m("",!0)]),t("div",Vt,[e[47]||(e[47]=t("label",{class:"form-label"},"Attachment",-1)),t("input",{type:"file",class:"form-control",onChange:ve},null,32)])])]),t("div",{class:"modal-footer"},[t("button",{class:"btn btn-secondary",onClick:J},"Cancel"),t("button",{class:"btn btn-danger",onClick:oe},"Update Template")])])])])):m("",!0)]))}},qt=be(At,[["__scopeId","data-v-c9122adb"]]);export{qt as default};
