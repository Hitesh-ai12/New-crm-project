import{_ as oe,r,b as M,R as ne,l as a,j as e,P as T,X as m,L as b,d6 as _,F as k,Y as w,k as d,Z as W,h as G,u as K,o,aG as de}from"./main-CG-JhxE2.js";import{E as R}from"./bootstrap.min-B_txeHIb.js";import{a as f}from"./axios-CdtiCRuU.js";import{S as u}from"./sweetalert2.all-DyJFIm0t.js";import"./_commonjsHelpers-BosuxZz1.js";const ie={class:"container py-4"},re={class:"d-flex justify-content-between align-items-center mb-4"},ue={key:0,class:"table-responsive"},ce={class:"table table-bordered table-hover"},me=["onClick"],pe=["onClick"],ve={key:0,class:"d-flex justify-content-between align-items-center mt-2"},be=["disabled"],fe=["disabled"],ye={key:1},ge={class:"d-flex align-items-center mb-3"},he={class:"list-group"},_e={key:0,class:"list-group-item text-muted fst-italic"},ke={key:1,class:"table-auto w-full border text-left"},we={class:"p-2"},Ce={class:"p-2"},xe={class:"p-2"},Te=["innerHTML"],Fe={class:"p-2"},Ee={class:"p-2"},je=["href"],Ve={key:1},$e={class:"p-2"},Ue={class:"p-2 flex gap-2"},Se=["onClick"],Ae=["onClick"],Ne={key:2,class:"modal fade show d-block",tabindex:"-1"},Be={class:"modal-dialog"},Me={class:"modal-content"},De={class:"modal-header"},Ie={class:"modal-body"},Pe={class:"modal-footer"},Le={key:3,class:"modal fade show d-block",tabindex:"-1"},ze={class:"modal-dialog modal-xl"},Ye={class:"modal-content"},He={class:"modal-header"},We={class:"modal-body"},Ge={class:"row g-3"},Ke={class:"col-md-6"},Re={class:"col-md-6"},Xe={class:"input-group"},Ze=["value"],qe={class:"col-12"},Je={class:"input-group"},Oe=["value"],Qe={class:"col-12"},et={class:"col-12"},tt={class:"modal-footer"},lt={key:4,class:"modal fade show d-block",tabindex:"-1"},st={class:"modal-dialog modal-xl"},at={class:"modal-content"},ot={class:"modal-body"},nt={class:"row g-3"},dt={class:"col-md-6"},it={class:"col-md-6"},rt={class:"input-group"},ut=["value"],ct={class:"col-12"},mt={class:"input-group"},pt=["value"],vt={class:"col-12"},bt={class:"col-12"},$=10,ft={__name:"CreateEmailTemplates",setup(yt){const p=r("folders"),D=r(null),y=r(!1),h=r(!1),g=r([]),F=r([]),C=r(null),U=r(""),x=r({name:""}),n=r({title:"",folder_id:"",subject:"",content:"",attachment:null}),I={height:300,menubar:!1,plugins:"link lists image code",toolbar:"undo redo | formatselect | bold italic underline | alignleft aligncenter alignright | bullist numlist outdent indent | image link code | mergefields",branding:!1,resize:!0,automatic_uploads:!0,images_upload_handler:s=>new Promise((t,l)=>{const c=s.blob();if(c.size>51200){l("Image size must be less than 50KB");return}const H=new FormData;H.append("file",c,s.filename()),f.post("/api/upload-image",H).then(B=>{B.data&&B.data.url?t(B.data.url):l("Upload failed: Invalid response")}).catch(()=>{l("Image upload failed")})}),setup(s){s.ui.registry.addMenuButton("mergefields",{text:"Merge Fields",fetch(t){const l=N.map(c=>({type:"menuitem",text:c,onAction:()=>{s.insertContent(`{{${c}}}`)}}));t(l)}})}},P=localStorage.getItem("auth_token");P&&(f.defaults.headers.common.Authorization=`Bearer ${P}`);const S=M(()=>g.value.filter(s=>s.name.toLowerCase().includes(U.value.toLowerCase()))),L=async()=>{try{const s=await f.get("/api/folders?type=email");g.value=s.data}catch{u.fire("Error","Failed to load folders","error")}},E=async s=>{try{const t=await f.get(`/api/folders/${s}/templates`);F.value=t.data;const l=g.value.find(c=>c.id===s);D.value=l,C.value=s,p.value="folder-view"}catch{u.fire("Error","Could not load templates for this folder","error")}},X=async()=>{if(p.value!=="folders"){u.fire("Warning","You can only create folders from the main view.","warning");return}if(g.value.some(t=>t.name.trim().toLowerCase()===x.value.name.trim().toLowerCase())){u.fire("Warning","A folder with this name already exists.","warning");return}try{const t=await f.post("/api/folders",{name:x.value.name,type:"email"});g.value.push(t.data),x.value.name="",y.value=!1,u.fire("Success","Folder created successfully.","success")}catch{u.fire("Error","Could not create folder","error")}},Z=async()=>{try{const s=new FormData;s.append("title",n.value.title),s.append("folder_id",n.value.folder_id),s.append("subject",n.value.subject),s.append("content",n.value.content),s.append("type","email"),n.value.attachment&&s.append("attachment",n.value.attachment),await f.post("/api/templates",s),n.value={title:"",folder_id:"",subject:"",content:"",attachment:null},h.value=!1,p.value==="folder-view"&&C.value?await E(C.value):await L(),u.fire("Success","Email template saved.","success")}catch{u.fire("Error","Could not save template","error")}},v=r(1),A=M(()=>Math.ceil(S.value.length/$)),q=M(()=>{const s=(v.value-1)*$,t=s+$;return S.value.slice(s,t)}),J=()=>{v.value<A.value&&v.value++},O=()=>{v.value>1&&v.value--},j=r(!1),V=r(null),i=r({title:"",subject:"",content:"",type:"email",attachment:null}),Q=s=>{j.value=!0,V.value=s.id,i.value={title:s.title,subject:s.subject,content:s.content,folder_id:s.folder_id,type:s.type,attachment:null}},ee=async()=>{try{const s=new FormData;s.append("title",i.value.title),s.append("subject",i.value.subject),s.append("content",i.value.content),s.append("type","email"),s.append("folder_id",i.value.folder_id),i.value.attachment&&s.append("attachment",i.value.attachment),await f.post(`/api/email-templates/${V.value}?_method=PUT`,s,{headers:{"Content-Type":"multipart/form-data"}}),j.value=!1,V.value=null,await E(C.value),u.fire("Updated!","Template updated successfully.","success")}catch(s){console.error(s),u.fire("Error!","Could not update template.","error")}},z=()=>{j.value=!1,V.value=null},te=async s=>{if((await u.fire({title:"Are you sure?",text:"This will permanently delete the template.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await f.delete(`/api/templates/${s}`),await E(C.value),u.fire("Deleted!","Template has been deleted.","success")}catch{u.fire("Error!","Failed to delete template.","error")}},N=["first_name","last_name","email","phone","city","zip_code","province","street","house_number","tag","stage","created_at"],Y=s=>{s&&(n.value.subject+=` {{${s}}} `)},le=s=>{i.value.attachment=s.target.files[0]},se=s=>{n.value.attachment=s.target.files[0]},ae=s=>{n.value.folder_id=s,h.value=!0};return ne(L),(s,t)=>(o(),a("div",ie,[e("div",re,[t[23]||(t[23]=e("h2",null,"Email Templates",-1)),e("div",null,[p.value==="folders"?(o(),a("button",{key:0,onClick:t[0]||(t[0]=l=>y.value=!0),class:"btn btn-success me-2"},t[21]||(t[21]=[e("i",{class:"fas fa-plus me-1"},null,-1),T(" Create Folder ")]))):m("",!0),e("button",{onClick:t[1]||(t[1]=l=>h.value=!0),class:"btn btn-success"},t[22]||(t[22]=[e("i",{class:"fas fa-file-alt me-1"},null,-1),T(" Add Email Template ")]))])]),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>U.value=l),type:"text",class:"form-control mb-3",placeholder:"Search by folder name"},null,512),[[_,U.value]]),p.value==="folders"?(o(),a("div",ue,[e("table",ce,[t[25]||(t[25]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Templates"),e("th",null,"Created By"),e("th",null,"Action")])],-1)),e("tbody",null,[(o(!0),a(k,null,w(q.value,l=>(o(),a("tr",{key:l.id},[e("td",{onClick:c=>E(l.id),class:"cursor-pointer"},[t[24]||(t[24]=e("i",{class:"fas fa-folder text-warning me-2"},null,-1)),T(d(l.name),1)],8,me),e("td",null,d(l.template_count),1),e("td",null,d(l.created_by_name),1),e("td",null,[e("button",{class:"btn btn-link text-success p-0",onClick:de(c=>ae(l.id),["stop"])}," Add Email Template ",8,pe)])]))),128))])]),S.value.length>$?(o(),a("div",ve,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:O,disabled:v.value===1},"Previous",8,be),e("span",null,"Page "+d(v.value)+" of "+d(A.value),1),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:J,disabled:v.value===A.value},"Next",8,fe)])):m("",!0)])):p.value==="folder-view"?(o(),a("div",ye,[p.value==="folder-view"?(o(),a("button",{key:0,onClick:t[3]||(t[3]=l=>p.value="folders"),class:"btn btn-secondary mb-3"},t[26]||(t[26]=[e("i",{class:"fas fa-arrow-left me-1"},null,-1),T(" Back to Folders ")]))):m("",!0),e("h3",ge,[t[27]||(t[27]=e("i",{class:"fas fa-folder text-warning me-2"},null,-1)),T(" "+d(D.value.name),1)]),e("ul",he,[F.value.length===0?(o(),a("li",_e," No templates in this folder. ")):m("",!0),F.value.length>0?(o(),a("table",ke,[t[31]||(t[31]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"p-2"},[e("input",{type:"checkbox"})]),e("th",{class:"p-2"},"Title"),e("th",{class:"p-2"},"Created By"),e("th",{class:"p-2"},"Subject"),e("th",{class:"p-2"},"Content"),e("th",{class:"p-2"},"Type"),e("th",{class:"p-2"},"Attachment"),e("th",{class:"p-2"},"Created At"),e("th",{class:"p-2"},"Action")])],-1)),e("tbody",null,[(o(!0),a(k,null,w(F.value,l=>(o(),a("tr",{key:l.id,class:"border-b hover:bg-gray-50"},[t[30]||(t[30]=e("td",{class:"p-2"},[e("input",{type:"checkbox"})],-1)),e("td",we,d(l.title),1),e("td",Ce,d(l.created_by),1),e("td",xe,d(l.subject),1),e("td",{class:"p-2",innerHTML:l.content},null,8,Te),e("td",Fe,d(l.type),1),e("td",Ee,[l.attachment_path?(o(),a("a",{key:0,href:`/storage/${l.attachment_path}`,target:"_blank",class:"text-blue-600 underline"}," View Attachment ",8,je)):(o(),a("span",Ve,"No Attachment"))]),e("td",$e,d(new Date(l.created_at).toLocaleString()),1),e("td",Ue,[t[29]||(t[29]=e("button",{class:"bg-red-600 text-white px-2 py-1 rounded"},[e("i",{class:"fas fa-eye"})],-1)),e("button",{class:"btn btn-sm btn-warning",onClick:c=>Q(l)}," Edit ",8,Se),e("button",{onClick:c=>te(l.id),class:"bg-red-600 text-white px-2 py-1 rounded"},t[28]||(t[28]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ae)])]))),128))])])):m("",!0)])])):m("",!0),y.value?(o(),a("div",Ne,[e("div",Be,[e("div",Me,[e("div",De,[t[32]||(t[32]=e("h5",{class:"modal-title"},"Create Folder",-1)),e("button",{type:"button",class:"btn-close",onClick:t[4]||(t[4]=l=>y.value=!1)})]),e("div",Ie,[t[33]||(t[33]=e("label",{class:"form-label"},"* Folder Name",-1)),b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>x.value.name=l),type:"text",class:"form-control",placeholder:"Folder Name"},null,512),[[_,x.value.name]])]),e("div",Pe,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=l=>y.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",onClick:X},"Save")])])])])):m("",!0),h.value?(o(),a("div",Le,[e("div",ze,[e("div",Ye,[e("div",He,[t[34]||(t[34]=e("h5",{class:"modal-title"},"Add Email Template",-1)),e("button",{type:"button",class:"btn-close",onClick:t[7]||(t[7]=l=>h.value=!1)})]),e("div",We,[e("div",Ge,[e("div",Ke,[t[35]||(t[35]=e("label",{class:"form-label"},"* Template Name",-1)),b(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>n.value.title=l),type:"text",class:"form-control",placeholder:"Template Name"},null,512),[[_,n.value.title]])]),e("div",Re,[t[37]||(t[37]=e("label",{class:"form-label"},"* Folder",-1)),e("div",Xe,[b(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>n.value.folder_id=l),class:"form-select"},[t[36]||(t[36]=e("option",{value:""},"Choose Folder",-1)),(o(!0),a(k,null,w(g.value,l=>(o(),a("option",{key:l.id,value:l.id},d(l.name),9,Ze))),128))],512),[[W,n.value.folder_id]]),e("button",{class:"btn btn-outline-success",type:"button",onClick:t[10]||(t[10]=l=>y.value=!0)},"+")])]),e("div",qe,[t[39]||(t[39]=e("label",{class:"form-label"},"* Subject",-1)),e("div",Je,[b(e("input",{"onUpdate:modelValue":t[11]||(t[11]=l=>n.value.subject=l),type:"text",class:"form-control",placeholder:"Subject"},null,512),[[_,n.value.subject]]),e("select",{class:"form-select w-auto",onChange:t[12]||(t[12]=l=>Y(l.target.value))},[t[38]||(t[38]=e("option",{disabled:"",selected:""},"Insert Field",-1)),(o(),a(k,null,w(N,l=>e("option",{key:l,value:l},d(l),9,Oe)),64))],32)])]),e("div",Qe,[t[40]||(t[40]=e("label",{class:"form-label"},"Body",-1)),G(K(R),{init:I,modelValue:n.value.content,"onUpdate:modelValue":t[13]||(t[13]=l=>n.value.content=l)},null,8,["modelValue"])]),e("div",et,[t[41]||(t[41]=e("label",{class:"form-label"},"Attachment",-1)),e("input",{type:"file",class:"form-control",onChange:se},null,32)])])]),e("div",tt,[e("button",{class:"btn btn-secondary",onClick:t[14]||(t[14]=l=>h.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",onClick:Z},"Save Email Template")])])])])):m("",!0),j.value?(o(),a("div",lt,[e("div",st,[e("div",at,[e("div",{class:"modal-header"},[t[42]||(t[42]=e("h5",{class:"modal-title"},"Edit Email Template",-1)),e("button",{type:"button",class:"btn-close",onClick:z})]),e("div",ot,[e("div",nt,[e("div",dt,[t[43]||(t[43]=e("label",{class:"form-label"},"* Template Name",-1)),b(e("input",{"onUpdate:modelValue":t[15]||(t[15]=l=>i.value.title=l),type:"text",class:"form-control",placeholder:"Template Name"},null,512),[[_,i.value.title]])]),e("div",it,[t[45]||(t[45]=e("label",{class:"form-label"},"* Folder",-1)),e("div",rt,[b(e("select",{"onUpdate:modelValue":t[16]||(t[16]=l=>i.value.folder_id=l),class:"form-select"},[t[44]||(t[44]=e("option",{value:""},"Choose Folder",-1)),(o(!0),a(k,null,w(g.value,l=>(o(),a("option",{key:l.id,value:l.id},d(l.name),9,ut))),128))],512),[[W,i.value.folder_id]]),e("button",{class:"btn btn-outline-success",type:"button",onClick:t[17]||(t[17]=l=>y.value=!0)},"+")])]),e("div",ct,[t[47]||(t[47]=e("label",{class:"form-label"},"* Subject",-1)),e("div",mt,[b(e("input",{"onUpdate:modelValue":t[18]||(t[18]=l=>n.value.subject=l),type:"text",class:"form-control",placeholder:"Subject"},null,512),[[_,n.value.subject]]),e("select",{class:"form-select w-auto",onChange:t[19]||(t[19]=l=>Y(l.target.value))},[t[46]||(t[46]=e("option",{disabled:"",selected:""},"Insert Field",-1)),(o(),a(k,null,w(N,l=>e("option",{key:l,value:l},d(l),9,pt)),64))],32)])]),e("div",vt,[t[48]||(t[48]=e("label",{class:"form-label"},"Body",-1)),G(K(R),{init:I,modelValue:i.value.content,"onUpdate:modelValue":t[20]||(t[20]=l=>i.value.content=l)},null,8,["modelValue"])]),e("div",bt,[t[49]||(t[49]=e("label",{class:"form-label"},"Attachment",-1)),e("input",{type:"file",class:"form-control",onChange:le},null,32)])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:z},"Cancel"),e("button",{class:"btn btn-danger",onClick:ee},"Update Template")])])])])):m("",!0)]))}},xt=oe(ft,[["__scopeId","data-v-d8a7be1e"]]);export{xt as default};
