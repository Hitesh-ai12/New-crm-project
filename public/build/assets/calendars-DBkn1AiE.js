import{_ as A,r as f,o as d,l as c,j as e,L as _,Y as N,F as T,Z as M,k as v,bo as h,P as w,X as J,b as P,R as z,f as F,$ as C,e as V,n as q,aH as H}from"./main-12_IZHkA.js";const R={props:["leads"],emits:["close","save"],setup(s,{emit:t}){const l=f({lead:"",title:"",description:"",location:"",date:""});return{appointmentData:l,handleFormSubmit:async()=>{try{const p=await fetch("/api/appointments",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(l.value)}),u=await p.json();p.ok&&(u!=null&&u.appointment)?(t("save",{id:u.appointment.id,title:u.appointment.title,type:"Appointment",due_date:u.appointment.date,lead_id:u.appointment.lead_id,lead_name:u.appointment.lead_name}),t("close")):console.error("❌ Appointment creation failed:",u)}catch(p){console.error("❌ Error creating appointment:",p)}}}}},W={class:"appointment_modal"},X={class:"modal-content"},Z={class:"modal-header"},G={class:"modal-body"},K={class:"form-group"},Q=["value"],tt={class:"form-group"},et={class:"form-group"},ot={class:"form-group"},at={class:"form-group"},nt={class:"form-actions"};function st(s,t,l,o,p,u){return d(),c("div",W,[e("div",X,[e("div",Z,[t[7]||(t[7]=e("h2",null,"Create Appointment",-1)),e("button",{onClick:t[0]||(t[0]=a=>s.$emit("close"))},"×")]),e("div",G,[e("div",K,[t[9]||(t[9]=e("label",{for:"appointment-lead"},"Lead Name:",-1)),_(e("select",{id:"appointment-lead","onUpdate:modelValue":t[1]||(t[1]=a=>o.appointmentData.lead=a)},[t[8]||(t[8]=e("option",{disabled:"",value:""},"Select Lead",-1)),(d(!0),c(T,null,M(l.leads,a=>(d(),c("option",{key:a.id,value:a.id},v(a.first_name)+" "+v(a.last_name),9,Q))),128))],512),[[N,o.appointmentData.lead]])]),e("div",tt,[t[10]||(t[10]=e("label",{for:"appointment-title"},"Title:",-1)),_(e("input",{type:"text",id:"appointment-title","onUpdate:modelValue":t[2]||(t[2]=a=>o.appointmentData.title=a),placeholder:"Enter title"},null,512),[[h,o.appointmentData.title]])]),e("div",et,[t[11]||(t[11]=e("label",{for:"appointment-description"},"Description:",-1)),_(e("textarea",{id:"appointment-description","onUpdate:modelValue":t[3]||(t[3]=a=>o.appointmentData.description=a),placeholder:"Enter description"},null,512),[[h,o.appointmentData.description]])]),e("div",ot,[t[12]||(t[12]=e("label",{for:"appointment-location"},"Location:",-1)),_(e("input",{type:"text",id:"appointment-location","onUpdate:modelValue":t[4]||(t[4]=a=>o.appointmentData.location=a),placeholder:"Enter location"},null,512),[[h,o.appointmentData.location]])]),e("div",at,[t[13]||(t[13]=e("label",{for:"appointment-date"},"Date:",-1)),_(e("input",{type:"datetime-local",id:"appointment-date","onUpdate:modelValue":t[5]||(t[5]=a=>o.appointmentData.date=a)},null,512),[[h,o.appointmentData.date]])]),e("div",nt,[e("button",{onClick:t[6]||(t[6]=(...a)=>o.handleFormSubmit&&o.handleFormSubmit(...a))},"Create Appointment")])])])])}const lt=A(R,[["render",st],["__scopeId","data-v-46b49c48"]]),it={props:["task"]},dt={class:"modal-overlay"},rt={class:"modal-content"};function pt(s,t,l,o,p,u){return d(),c("div",dt,[e("div",rt,[t[5]||(t[5]=e("h3",null,"Task Details",-1)),e("p",null,[t[1]||(t[1]=e("strong",null,"Lead:",-1)),w(" "+v(l.task.lead_name),1)]),e("p",null,[t[2]||(t[2]=e("strong",null,"Title:",-1)),w(" "+v(l.task.title),1)]),e("p",null,[t[3]||(t[3]=e("strong",null,"Type:",-1)),w(" "+v(l.task.type),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"Date & Time:",-1)),w(" "+v(l.task.due_date),1)]),e("button",{onClick:t[0]||(t[0]=a=>s.$emit("close"))},"Close")])])}const ut=A(it,[["render",pt]]),mt={props:{leads:Array},emits:["close","save"],setup(s,{emit:t}){const l=f({lead_id:"",title:"",type:"Meeting",due_date:""});return{taskData:l,saveTask:()=>{if(!l.value.lead_id||!l.value.title||!l.value.due_date){alert("Please fill all required fields");return}t("save",l.value),t("close")}}}},ct={class:"task_modal"},vt={class:"modal-content"},kt={class:"modal-header"},ft={class:"modal-body"},_t={class:"form-group"},yt=["value"],Dt={class:"form-group"},gt={class:"form-group"},ht={class:"form-group"},Tt={class:"form-actions"};function Mt(s,t,l,o,p,u){return d(),c("div",ct,[e("div",vt,[e("div",kt,[t[6]||(t[6]=e("h2",null,"Add Task",-1)),e("button",{onClick:t[0]||(t[0]=a=>s.$emit("close"))},"×")]),e("div",ft,[e("div",_t,[t[7]||(t[7]=e("label",null,"Select Lead:",-1)),_(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>o.taskData.lead_id=a)},[(d(!0),c(T,null,M(l.leads,a=>(d(),c("option",{key:a.id,value:a.id},v(a.first_name)+" "+v(a.last_name),9,yt))),128))],512),[[N,o.taskData.lead_id]])]),e("div",Dt,[t[8]||(t[8]=e("label",null,"Task Title:",-1)),_(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>o.taskData.title=a),placeholder:"Enter task title"},null,512),[[h,o.taskData.title]])]),e("div",gt,[t[10]||(t[10]=e("label",null,"Task Type:",-1)),_(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>o.taskData.type=a)},t[9]||(t[9]=[J('<option value="Meeting" data-v-5a356d09>Meeting</option><option value="Call" data-v-5a356d09>Call</option><option value="Email" data-v-5a356d09>Email</option><option value="Text" data-v-5a356d09>Text</option><option value="Follow-up" data-v-5a356d09>Follow-up</option>',5)]),512),[[N,o.taskData.type]])]),e("div",ht,[t[11]||(t[11]=e("label",null,"Due Date:",-1)),_(e("input",{type:"datetime-local","onUpdate:modelValue":t[4]||(t[4]=a=>o.taskData.due_date=a)},null,512),[[h,o.taskData.due_date]])]),e("div",Tt,[e("button",{onClick:t[5]||(t[5]=(...a)=>o.saveTask&&o.saveTask(...a))},"Add Task")])])])])}const bt=A(mt,[["render",Mt],["__scopeId","data-v-5a356d09"]]),wt={components:{TaskModal:bt,AppointmentModal:lt,TaskDetailModal:ut},setup(){const s=f(new Date().getMonth()),t=f(new Date().getFullYear()),l=f(!1),o=f(!1),p=f([]),u=f([]),a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],b=f(null),S=i=>{b.value=i},n=P(()=>["January","February","March","April","May","June","July","August","September","October","November","December"][s.value]),x=P(()=>{const i=[],m=new Date(t.value,s.value,1).getDay();for(let y=0;y<m;y++)i.push({date:null,fullDate:null,events:[],isPadding:!0});const r=new Date(t.value,s.value,1),g=r.getMonth();for(;r.getMonth()===g;){const y=new Date(r);i.push({date:y.getDate(),fullDate:new Date(y),events:p.value.filter(j=>{const E=new Date(j.due_date||j.date);return E.getFullYear()===y.getFullYear()&&E.getMonth()===y.getMonth()&&E.getDate()===y.getDate()}),isPadding:!1}),r.setDate(r.getDate()+1)}return i}),D=()=>{s.value===0?(s.value=11,t.value-=1):s.value-=1},$=()=>{s.value===11?(s.value=0,t.value+=1):s.value+=1},I=i=>{const k=new Date;return i===k.getDate()&&s.value===k.getMonth()&&t.value===k.getFullYear()},U=i=>{console.log("📅 Clicked date:",i.fullDate)},B=async()=>{try{const k=await(await fetch("/api/leads",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json();u.value=k,p.value=[],k.forEach(m=>{Array.isArray(m.tasks)&&m.tasks.forEach(r=>{p.value.push({id:r.id,title:r.title,type:r.type,due_date:r.due_date,lead_id:m.id,lead_name:`${m.first_name}`})})})}catch(i){console.error("❌ Error fetching leads:",i)}},L=async i=>{try{const k=await fetch("/api/tasks",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}),m=k.headers.get("content-type");if(!m||!m.includes("application/json"))throw new Error("❌ Server did not return JSON. Check auth or endpoint.");const r=await k.json();if(console.log("✅ Task response:",r),r!=null&&r.task){const g=r.task;p.value.push({id:g.id,title:g.title,type:g.type,due_date:g.due_date,lead_id:g.lead_id})}else console.error("❌ Task creation failed:",r)}catch(k){console.error("❌ Error adding task:",k)}},O=async()=>{try{(await(await fetch("/api/appointments",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json()).forEach(m=>{p.value.push({id:m.id,title:m.title,type:m.type,due_date:m.date,lead_id:m.lead_id,lead_name:m.lead_name})})}catch(i){console.error("❌ Error fetching appointments:",i)}},Y=i=>{p.value.push(i)};return z(()=>{B(),O()}),{selectedTask:b,openTaskDetail:S,currentMonth:s,currentYear:t,showTaskModal:l,showAppointmentModal:o,events:p,leads:u,weekdays:a,formattedMonth:n,daysInMonth:x,prevMonth:D,nextMonth:$,isCurrentDay:I,handleDateClick:U,addTask:L,addAppointment:Y}}},Ct={class:"calendar-page"},At={class:"header"},St={class:"actions"},xt={class:"calendar-container"},Et={class:"calendar"},Ft={class:"calendar-header"},Vt={class:"weekdays"},Nt={class:"calendar-days"},$t=["onClick"],jt={key:0},Pt=["onClick"],It={class:"fw-bold"},Ut={class:"text-muted small"};function Bt(s,t,l,o,p,u){const a=V("TaskDetailModal"),b=V("TaskModal"),S=V("AppointmentModal");return d(),c("div",Ct,[e("div",At,[t[7]||(t[7]=e("h1",null,"Calendar",-1)),e("div",St,[e("button",{onClick:t[0]||(t[0]=n=>o.showTaskModal=!0)},"Add Task"),e("button",{onClick:t[1]||(t[1]=n=>o.showAppointmentModal=!0)},"Create Appointment")])]),e("div",xt,[e("div",Et,[e("div",Ft,[e("button",{onClick:t[2]||(t[2]=(...n)=>o.prevMonth&&o.prevMonth(...n))},"Prev"),e("span",null,v(o.formattedMonth)+" "+v(o.currentYear),1),e("button",{onClick:t[3]||(t[3]=(...n)=>o.nextMonth&&o.nextMonth(...n))},"Next")]),e("div",Vt,[(d(!0),c(T,null,M(o.weekdays,n=>(d(),c("div",{key:n,class:"weekday"},v(n),1))),128))]),e("div",Nt,[(d(!0),c(T,null,M(o.daysInMonth,(n,x)=>(d(),c("div",{class:q(["calendar-day",{"current-day":o.isCurrentDay(n.date),"empty-day":n.isPadding}]),key:x,onClick:D=>!n.isPadding&&o.handleDateClick(n)},[n.isPadding?C("",!0):(d(),c("span",jt,v(n.date),1)),(d(!0),c(T,null,M(n.events,D=>(d(),c("div",{key:D.id,class:"event",onClick:H($=>o.openTaskDetail(D),["stop"])},[e("div",It,v(D.lead_name),1),e("div",Ut,v(D.title),1)],8,Pt))),128))],10,$t))),128))])])]),o.selectedTask?(d(),F(a,{key:0,task:o.selectedTask,onClose:t[4]||(t[4]=n=>o.selectedTask=null)},null,8,["task"])):C("",!0),o.showTaskModal?(d(),F(b,{key:1,leads:o.leads,onClose:t[5]||(t[5]=n=>o.showTaskModal=!1),onSave:o.addTask},null,8,["leads","onSave"])):C("",!0),o.showAppointmentModal?(d(),F(S,{key:2,leads:o.leads,onClose:t[6]||(t[6]=n=>o.showAppointmentModal=!1),onSave:o.addAppointment},null,8,["leads","onSave"])):C("",!0)])}const Ot=A(wt,[["render",Bt],["__scopeId","data-v-bdf2bfeb"]]);export{Ot as default};
