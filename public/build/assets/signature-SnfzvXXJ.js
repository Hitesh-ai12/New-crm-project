import{_ as oe,r as c,b as $,S as ne,m as s,k as e,Q as w,a0 as v,M as C,bp as D,F as E,$ as B,l as d,Z as W,n as N,j as Y,u as Q,o}from"./main-CyUTswze.js";import{E as R}from"./Editor-BhUPR0Jm.js";import{a as g}from"./axios-CdtiCRuU.js";import"./bootstrap.min-KxrJAQL6.js";import{S as m}from"./sweetalert2.all-BgaqdXRD.js";const ie={class:"container py-4"},de={class:"d-flex justify-content-between align-items-center mb-4"},re={key:0,class:"table-responsive"},ue={class:"table table-bordered table-hover"},ce=["onClick"],ve={key:0,class:"d-flex justify-content-between align-items-center mt-2"},me=["disabled"],pe=["disabled"],fe={key:1},be={class:"d-flex align-items-center mb-3"},ge={class:"list-group"},ye={key:0,class:"list-group-item text-muted fst-italic"},_e={key:1,class:"table-auto w-full border text-left"},he={class:"p-2"},ke={class:"p-2"},we=["innerHTML"],Ce={class:"p-2"},Te={class:"p-2"},Fe={class:"p-2 d-flex gap-2"},xe=["onClick"],Se=["onClick"],Ve={key:2,class:"modal fade show d-block",tabindex:"-1"},$e={class:"modal-dialog"},Ee={class:"modal-content"},Be={class:"modal-header"},Ne={class:"modal-body"},je=["value"],Me={class:"modal-footer"},Ue=["disabled"],Le={key:3,class:"modal fade show d-block",tabindex:"-1"},Pe={class:"modal-dialog modal-xl"},De={class:"modal-content"},Ae={class:"modal-header"},Ie={class:"modal-body"},ze={class:"row g-3"},He={class:"col-md-6"},qe={key:0,class:"invalid-feedback"},Oe={class:"col-md-6"},We={class:"input-group"},Ye=["value"],Qe={key:0,class:"invalid-feedback"},Re={class:"col-12"},Xe={key:0,class:"text-danger mt-1"},Ze={class:"modal-footer"},Ge={key:4,class:"modal fade show d-block",tabindex:"-1"},Je={class:"modal-dialog modal-xl"},Ke={class:"modal-content"},et={class:"modal-body"},tt={class:"row g-3"},lt={class:"col-md-6"},at={key:0,class:"invalid-feedback"},st={class:"col-md-6"},ot={key:0,class:"invalid-feedback"},nt={class:"col-12"},it={key:0,class:"text-danger mt-1"},j=10,dt={__name:"signature",setup(rt){const f=c("folders"),y=c(!1),h=c(!1),p=c([]),T=c([]),A=c(null),F=c(null),M=c(""),b=c(1),n=c({}),_=c({name:""}),r=c({title:"",folder_id:"",subject:"",content:"",attachment:null}),u=c({title:"",folder_id:"",subject:"",content:"",attachment:null,type:"signature"}),x=c(!1),U=c(null),X=["first_name","last_name","email","phone","job_title","department","company","website"],I=localStorage.getItem("auth_token");I&&(g.defaults.headers.common.Authorization=`Bearer ${I}`);const z={height:300,menubar:!1,plugins:"link lists image code",toolbar:"undo redo | formatselect | bold italic underline | alignleft aligncenter alignright | bullist numlist outdent indent | image link code | mergefields",branding:!1,resize:!0,automatic_uploads:!0,images_upload_handler:a=>new Promise((t,i)=>{const l=new FormData;l.append("file",a.blob(),a.filename()),g.post("/api/upload-image",l).then(k=>k.data.url?t(k.data.url):i("No URL returned")).catch(()=>i("Upload failed"))}),setup(a){a.ui.registry.addMenuButton("mergefields",{text:"Merge Fields",fetch(t){const i=X.map(l=>({type:"menuitem",text:l,onAction:()=>a.insertContent(`{{${l}}}`)}));t(i)}})}},S=async()=>{try{const a=await g.get("/api/signature-folders?type=signature");p.value=a.data}catch{m.fire("Error","Failed to load signature folders","error")}},Z=async()=>{if(p.value.some(t=>t.name.toLowerCase()===_.value.name.toLowerCase()))return m.fire("Warning","Folder already exists.","warning");try{const t=await g.post("/api/signature-folders",{name:_.value.name,type:"signature"});p.value.push(t.data),_.value.name="",y.value=!1,m.fire("Success","Folder created.","success")}catch{m.fire("Error","Failed to create folder.","error")}},V=async a=>{try{const t=await g.get(`/api/signature-folders/${a}/templates`);T.value=t.data,A.value=p.value.find(i=>i.id===a),F.value=a,f.value="folder-view"}catch{m.fire("Error","Cannot load folder templates.","error")}};function H(a){n.value={};let t=!0;return(!a.title||a.title.trim()==="")&&(n.value.title="Template name is required.",t=!1),a.folder_id||(n.value.folder_id="Please choose a folder.",t=!1),(!a.content||a.content.trim()==="")&&(n.value.content="Body content is required.",t=!1),t}const G=async()=>{if(H(r.value))try{const a=p.value.find(l=>l.id===parseInt(r.value.folder_id)),t=a?a.name.toLowerCase():null;if(!t){m.fire("Error","Invalid folder selected.","error");return}const i=new FormData;i.append("title",r.value.title),i.append("subject",r.value.subject||""),i.append("content",r.value.content),i.append("type",t),i.append("folder_id",r.value.folder_id),r.value.attachment&&i.append("attachment",r.value.attachment),await g.post("/api/signature-templates",i),r.value={title:"",folder_id:"",subject:"",content:"",attachment:null},h.value=!1,f.value==="folder-view"?await V(F.value):await S(),m.fire("Success","Template saved.","success")}catch(a){console.error(a),m.fire("Error","Failed to save template.","error")}},J=a=>{U.value=a.id,u.value={title:a.title,folder_id:a.folder_id,subject:a.subject,content:a.content,attachment:null,type:a.type},x.value=!0},q=()=>{x.value=!1,n.value={},U.value=null,u.value={title:"",folder_id:"",subject:"",content:"",attachment:null,type:"email"}},K=async()=>{if(H(u.value))try{const a=new FormData;a.append("title",u.value.title),a.append("subject",u.value.subject||""),a.append("content",u.value.content),a.append("folder_id",u.value.folder_id),a.append("type",u.value.type),u.value.attachment&&a.append("attachment",u.value.attachment),await g.post(`/api/signature-templates/${U.value}`,a,{headers:{"X-HTTP-Method-Override":"PUT"}}),m.fire("Success","Template updated.","success"),x.value=!1,f.value==="folder-view"?await V(F.value):await S()}catch(a){console.error(a),m.fire("Error","Failed to update template.","error")}},ee=async a=>{if((await m.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await g.delete(`/api/signature-templates/${a}`),m.fire("Deleted!","Template has been deleted.","success"),f.value==="folder-view"?await V(F.value):await S()}catch(i){console.error(i),m.fire("Error","Failed to delete template.","error")}},L=$(()=>p.value.filter(a=>a.name.toLowerCase().includes(M.value.toLowerCase()))),te=$(()=>{const a=(b.value-1)*j;return L.value.slice(a,a+j)}),le=["SMS","Email","WhatsApp"],O=$(()=>{const a=p.value.map(t=>t.name.toLowerCase());return le.filter(t=>!a.includes(t.toLowerCase()))}),P=$(()=>Math.ceil(L.value.length/j)),ae=()=>{b.value<P.value&&b.value++},se=()=>{b.value>1&&b.value--};return ne(S),(a,t)=>{var i;return o(),s("div",ie,[e("div",de,[t[17]||(t[17]=e("h2",null,"Signature Templates",-1)),e("div",null,[f.value==="folders"&&O.value.length>0?(o(),s("button",{key:0,onClick:t[0]||(t[0]=l=>y.value=!0),class:"btn btn-success me-2"},t[15]||(t[15]=[e("i",{class:"fas fa-plus me-1"},null,-1),w(" Create Folder ")]))):v("",!0),e("button",{onClick:t[1]||(t[1]=l=>h.value=!0),class:"btn btn-success"},t[16]||(t[16]=[e("i",{class:"fas fa-file-signature me-1"},null,-1),w(" Add Signature Template ")]))])]),C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>M.value=l),type:"text",class:"form-control mb-3",placeholder:"Search folders..."},null,512),[[D,M.value]]),f.value==="folders"?(o(),s("div",re,[e("table",ue,[t[19]||(t[19]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Templates"),e("th",null,"Created By")])],-1)),e("tbody",null,[(o(!0),s(E,null,B(te.value,l=>(o(),s("tr",{key:l.id},[e("td",{onClick:k=>V(l.id),class:"cursor-pointer"},[t[18]||(t[18]=e("i",{class:"fas fa-folder text-warning me-2"},null,-1)),w(d(l.name),1)],8,ce),e("td",null,d(l.template_count),1),e("td",null,d(l.created_by_name),1)]))),128))])]),L.value.length>j?(o(),s("div",ve,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:se,disabled:b.value===1}," Previous ",8,me),e("span",null,"Page "+d(b.value)+" of "+d(P.value),1),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:ae,disabled:b.value===P.value}," Next ",8,pe)])):v("",!0)])):f.value==="folder-view"?(o(),s("div",fe,[e("button",{onClick:t[3]||(t[3]=l=>f.value="folders"),class:"btn btn-secondary mb-3"},t[20]||(t[20]=[e("i",{class:"fas fa-arrow-left me-1"},null,-1),w(" Back to Folders ")])),e("h3",be,[t[21]||(t[21]=e("i",{class:"fas fa-folder text-warning me-2"},null,-1)),w(" "+d(A.value.name),1)]),e("ul",ge,[T.value.length===0?(o(),s("li",ye," No signature templates in this folder. ")):v("",!0),T.value.length>0?(o(),s("table",_e,[t[25]||(t[25]=e("thead",{class:"bg-light"},[e("tr",null,[e("th",{class:"p-2"},[e("input",{type:"checkbox"})]),e("th",{class:"p-2"},"Title"),e("th",{class:"p-2"},"Created By"),e("th",{class:"p-2"},"Content"),e("th",{class:"p-2"},"Type"),e("th",{class:"p-2"},"Created At"),e("th",{class:"p-2"},"Action")])],-1)),e("tbody",null,[(o(!0),s(E,null,B(T.value,l=>(o(),s("tr",{key:l.id,class:"border-b hover:bg-gray-50"},[t[24]||(t[24]=e("td",{class:"p-2"},[e("input",{type:"checkbox"})],-1)),e("td",he,d(l.title),1),e("td",ke,d(l.created_by),1),e("td",{class:"p-2",innerHTML:l.content},null,8,we),e("td",Ce,d(l.type),1),e("td",Te,d(new Date(l.created_at).toLocaleString()),1),e("td",Fe,[t[23]||(t[23]=e("button",{class:"btn btn-sm btn-outline-info"},[e("i",{class:"fas fa-eye"})],-1)),e("button",{class:"btn btn-sm btn-warning",onClick:k=>J(l)},"Edit",8,xe),e("button",{onClick:k=>ee(l.id),class:"btn btn-sm btn-danger"},t[22]||(t[22]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Se)])]))),128))])])):v("",!0)])])):v("",!0),y.value?(o(),s("div",Ve,[e("div",$e,[e("div",Ee,[e("div",Be,[t[26]||(t[26]=e("h5",{class:"modal-title"},"Create Folder",-1)),e("button",{type:"button",class:"btn-close",onClick:t[4]||(t[4]=l=>y.value=!1)})]),e("div",Ne,[t[28]||(t[28]=e("label",{class:"form-label"},"* Folder Type",-1)),C(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>_.value.name=l),class:"form-select"},[t[27]||(t[27]=e("option",{value:""},"Select Folder",-1)),(o(!0),s(E,null,B(O.value,l=>(o(),s("option",{key:l,value:l},d(l),9,je))),128))],512),[[W,_.value.name]])]),e("div",Me,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=l=>y.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",disabled:!_.value.name,onClick:Z},"Save",8,Ue)])])])])):v("",!0),h.value?(o(),s("div",Le,[e("div",Pe,[e("div",De,[e("div",Ae,[t[29]||(t[29]=e("h5",{class:"modal-title"},"Add Signature Template",-1)),e("button",{type:"button",class:"btn-close",onClick:t[7]||(t[7]=l=>h.value=!1)})]),e("div",Ie,[e("div",ze,[e("div",He,[t[30]||(t[30]=e("label",{class:"form-label"},"* Template Name",-1)),C(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>r.value.title=l),type:"text",class:N(["form-control",{"is-invalid":n.value.title}]),placeholder:"Template Name"},null,2),[[D,r.value.title]]),n.value.title?(o(),s("div",qe,d(n.value.title),1)):v("",!0)]),e("div",Oe,[t[32]||(t[32]=e("label",{class:"form-label"},"* Folder",-1)),e("div",We,[C(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>r.value.folder_id=l),class:N(["form-select",{"is-invalid":n.value.folder_id}])},[t[31]||(t[31]=e("option",{value:""},"Choose Folder",-1)),(o(!0),s(E,null,B(p.value,l=>(o(),s("option",{key:l.id,value:l.id},d(l.name),9,Ye))),128))],2),[[W,r.value.folder_id]]),n.value.folder_id?(o(),s("div",Qe,d(n.value.folder_id),1)):v("",!0),e("button",{class:"btn btn-outline-success",type:"button",onClick:t[10]||(t[10]=l=>y.value=!0)},"+")])]),e("div",Re,[t[33]||(t[33]=e("label",{class:"form-label"},"* Body",-1)),Y(Q(R),{init:z,modelValue:r.value.content,"onUpdate:modelValue":t[11]||(t[11]=l=>r.value.content=l)},null,8,["modelValue"]),n.value.content?(o(),s("div",Xe,d(n.value.content),1)):v("",!0)])])]),e("div",Ze,[e("button",{class:"btn btn-secondary",onClick:t[12]||(t[12]=l=>h.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",onClick:G},"Save Signature Template")])])])])):v("",!0),x.value?(o(),s("div",Ge,[e("div",Je,[e("div",Ke,[e("div",{class:"modal-header"},[t[34]||(t[34]=e("h5",{class:"modal-title"},"Edit Signature Template",-1)),e("button",{type:"button",class:"btn-close",onClick:q})]),e("div",et,[e("div",tt,[e("div",lt,[t[35]||(t[35]=e("label",{class:"form-label"},"* Template Name",-1)),C(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>u.value.title=l),type:"text",class:N(["form-control",{"is-invalid":n.value.title}]),placeholder:"Template Name"},null,2),[[D,u.value.title]]),n.value.title?(o(),s("div",at,d(n.value.title),1)):v("",!0)]),e("div",st,[t[36]||(t[36]=e("label",{class:"form-label"},"* Folder",-1)),e("div",{class:N(["form-control",{"is-invalid":n.value.folder_id}]),readonly:""},d(((i=p.value.find(l=>l.id===u.value.folder_id))==null?void 0:i.name)||"No Folder"),3),n.value.folder_id?(o(),s("div",ot,d(n.value.folder_id),1)):v("",!0)]),e("div",nt,[t[37]||(t[37]=e("label",{class:"form-label"},"* Body",-1)),Y(Q(R),{init:z,modelValue:u.value.content,"onUpdate:modelValue":t[14]||(t[14]=l=>u.value.content=l)},null,8,["modelValue"]),n.value.content?(o(),s("div",it,d(n.value.content),1)):v("",!0)])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:q},"Cancel"),e("button",{class:"btn btn-danger",onClick:K},"Update Signature Template")])])])])):v("",!0)])}}},bt=oe(dt,[["__scopeId","data-v-3415d816"]]);export{bt as default};
