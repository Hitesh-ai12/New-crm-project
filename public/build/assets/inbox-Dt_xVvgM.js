import"./bootstrap.min-KxrJAQL6.js";import{a as $}from"./axios-CdtiCRuU.js";import{_ as D,o,l as d,j as e,L as M,d6 as j,F as S,Y as k,n as E,k as v,X as L,dd as oe,P as W,aG as se,d3 as he,r as _,w as P,f as Q,bh as ne,Z as te,h as ie,u as re,au as Y,R as pe,p as ve,e as ae}from"./main-DYpbBk43.js";import{S as x}from"./sweetalert2.all-DyJFIm0t.js";import{E as de}from"./Editor-Bx2_HZui.js";import"./_commonjsHelpers-BosuxZz1.js";const fe={data(){return{leads:[],selectedLead:null,messages:[],searchQuery:""}},computed:{filteredLeads(){return this.leads.filter(c=>`${c.firstName||""} ${c.lastName||""}`.trim().toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{async fetchLeads(){const t={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},w=await $.get("/api/email/chats",{headers:t});this.leads=w.data},async selectLead(c){const w={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},C=await $.get(`/api/email/lead/${c.leadId}`,{headers:w});this.selectedLead=c,this.messages=C.data.reverse(),this.$nextTick(()=>this.scrollToBottom())},scrollToBottom(){const c=this.$refs.emailArea;c&&(c.scrollTop=c.scrollHeight)}},mounted(){this.fetchLeads()}},ge={class:"email-chat d-flex shadow rounded",style:{"block-size":"90vh"}},be={class:"border-end p-3 col-lg-4 col-md-5 col-sm-5 col-xs-12 col-12",style:{"inline-size":"300px"}},ye={class:"header-search-area"},we=["onClick"],_e={class:"d-flex flex-column"},Se={class:"fw-bold"},xe={class:"d-flex justify-content-between align-items-center"},ke={class:"badge bg-success"},Ce={class:"text-muted"},Me={class:"flex-grow-1 d-flex flex-column bg-light"},$e={class:"border-bottom p-3 bg-white"},Le={key:0},Ee={key:1,class:"text-muted"},Te={class:"flex-grow-1 overflow-auto p-3",ref:"emailArea"},Ie={key:0,class:"text-center text-muted small"},Ae=["innerHTML"],je={class:"d-block text-end mt-1"};function Be(c,t,w,C,l,h){return o(),d("div",ge,[e("div",be,[e("div",ye,[M(e("input",{class:"form-control mb-2","onUpdate:modelValue":t[0]||(t[0]=a=>l.searchQuery=a),placeholder:"Enter Lead Name"},null,512),[[j,l.searchQuery]])]),(o(!0),d(S,null,k(h.filteredLeads,a=>{var y;return o(),d("div",{key:a.leadId,class:E(["lead-item p-2 border-bottom",{"bg-primary text-white":((y=l.selectedLead)==null?void 0:y.leadId)===a.leadId}]),onClick:n=>h.selectLead(a)},[e("div",_e,[e("div",Se,v(a.firstName)+" "+v(a.lastName),1),e("div",xe,[e("span",ke,v(a.status||"Open"),1),e("small",Ce,v(a.date||"16jun, 2025 | 11:00 am"),1)])])],10,we)}),128))]),e("div",Me,[e("div",$e,[l.selectedLead?(o(),d("h5",Le,v(l.selectedLead.firstName)+" "+v(l.selectedLead.lastName),1)):(o(),d("p",Ee,"Select a lead to view emails"))]),e("div",Te,[(o(!0),d(S,null,k(l.messages,(a,y)=>(o(),d("div",{key:y,class:"mb-3"},[a.date?(o(),d("div",Ie,v(a.date),1)):L("",!0),e("div",{class:E(["p-3 rounded shadow-sm",a.direction==="sent"?"bg-info text-white ms-auto":"bg-white me-auto"]),style:{"max-inline-size":"75%"}},[e("strong",null,v(a.subject),1),e("div",{class:"mt-1",innerHTML:a.description},null,8,Ae),e("small",je,v(a.time),1)],2)]))),128))],512)])])}const Ne=D(fe,[["render",Be]]),ze={data(){return{searchQuery:"",newMessage:"",selectedChat:null,leads:[],messages:[]}},computed:{filteredLeads(){return this.leads.filter(c=>c.name.toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{async fetchLeads(){try{const t={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},w=await $.get("/api/sms/leads",{headers:t});this.leads=w.data}catch(c){console.error("Error loading leads:",c)}},async selectChat(c){try{const w={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},l=(await $.get(`/api/sms/lead/${c.leadId}`,{headers:w})).data,h=l.length>0?l[0].phone:c.phone||"";this.selectedChat={...c,phone:h},this.messages=l.reverse(),this.$nextTick(()=>this.scrollToBottom())}catch(t){console.error("Error loading messages:",t)}},async sendMessage(){const c=localStorage.getItem("auth_token"),t=parseInt(localStorage.getItem("user_id")),w={Authorization:`Bearer ${c}`};try{const C={lead_ids:[this.selectedChat.leadId],user_id:t,from:"+16187452168",to:this.selectedChat.phone,subject:"SMS Chat",message:this.newMessage};await $.post("/api/send-sms",C,{headers:w});const l=new Date,h=l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=l.toISOString().slice(0,10);this.messages.push({id:`sms-sent-${Date.now()}`,type:"sms",direction:"sent",phone:this.selectedChat.phone,title:"Sent SMS",description:this.newMessage,leadId:this.selectedChat.leadId,date:a,time:h}),this.newMessage="",this.$nextTick(()=>this.scrollToBottom())}catch(C){console.error("Send SMS Error:",C),x.fire("Error","Failed to send SMS.","error")}},scrollToBottom(){const c=this.$refs.messagesArea;c&&(c.scrollTop=c.scrollHeight)}},mounted(){this.fetchLeads()}},Ve={class:"chat-container d-flex shadow rounded",style:{"block-size":"90vh","margin-block":"20px","margin-inline":"auto","max-inline-size":"1200px"}},Fe={class:"sidebar border-end d-flex flex-column bg-white",style:{"inline-size":"320px","min-inline-size":"250px"}},Ue={class:"p-3 border-bottom"},De={class:"flex-grow-1 overflow-auto chat-list"},Pe=["onClick"],Qe={class:"flex-grow-1"},Oe={class:"fw-bold"},Re={class:"chat-window d-flex flex-column flex-grow-1 bg-light"},He={key:0,class:"chat-header d-flex align-items-center p-3 border-bottom bg-white"},We={class:"mb-0 flex-grow-1"},Ye={key:1,class:"chat-header d-flex align-items-center justify-content-center p-3 text-muted"},qe={class:"messages-area flex-grow-1 p-4 overflow-auto",ref:"messagesArea"},Ke={key:0,class:"text-center small text-muted mb-2"},Ge={class:"d-block text-end mt-1 text-white-50"},Xe={key:2,class:"p-3 border-top bg-white"},Ze={class:"input-group position-relative"};function Je(c,t,w,C,l,h){return o(),d("div",Ve,[e("div",Fe,[e("div",Ue,[M(e("input",{type:"text",class:"form-control rounded-pill",placeholder:"Search lead","onUpdate:modelValue":t[0]||(t[0]=a=>l.searchQuery=a)},null,512),[[j,l.searchQuery]])]),e("div",De,[(o(!0),d(S,null,k(h.filteredLeads,a=>(o(),d("div",{key:a.leadId,onClick:y=>h.selectChat(a),class:E(["d-flex align-items-center p-3 border-bottom chat-item",{"bg-primary text-white":l.selectedChat&&l.selectedChat.leadId===a.leadId}]),style:{cursor:"pointer"}},[t[4]||(t[4]=e("img",{src:"https://cdn-icons-png.flaticon.com/512/1384/1384031.png",width:"45",height:"45",class:"rounded-circle me-3",alt:"Avatar"},null,-1)),e("div",Qe,[e("div",Oe,v(a.name),1),e("small",{class:E(["text-muted",{"text-white-50":l.selectedChat&&l.selectedChat.leadId===a.leadId}])}," Lead ID: "+v(a.leadId),3)])],10,Pe))),128))])]),e("div",Re,[l.selectedChat?(o(),d("div",He,[t[5]||(t[5]=e("img",{src:"https://cdn-icons-png.flaticon.com/512/1384/1384031.png",width:"40",height:"40",class:"rounded-circle me-3",alt:"Avatar"},null,-1)),e("h5",We,v(l.selectedChat.name),1)])):(o(),d("div",Ye," Select a lead to view messages ")),e("div",qe,[l.messages.length&&l.selectedChat?(o(!0),d(S,{key:0},k(l.messages,(a,y)=>(o(),d("div",{key:y,class:"mb-3"},[a.date?(o(),d("div",Ke,[e("strong",null,v(a.date),1)])):L("",!0),e("div",{class:E(["message-bubble p-3 rounded shadow-sm",a.direction==="sent"?"bg-success text-white ms-auto":"bg-white me-auto"]),style:{"max-inline-size":"75%"}},[e("div",null,v(a.description),1),e("small",Ge,v(a.time),1)],2)]))),128)):L("",!0)],512),l.selectedChat?(o(),d("div",Xe,[e("div",Ze,[M(e("input",{type:"text",class:"form-control rounded-pill pe-5",placeholder:"Type a message","onUpdate:modelValue":t[1]||(t[1]=a=>l.newMessage=a),onKeyup:t[2]||(t[2]=oe((...a)=>h.sendMessage&&h.sendMessage(...a),["enter"]))},null,544),[[j,l.newMessage]]),e("button",{class:"btn btn-primary rounded-circle position-absolute",style:{"z-index":"1","block-size":"40px","inline-size":"40px","inset-block-start":"50%","inset-inline-end":"10px",transform:"translateY(-50%)"},onClick:t[3]||(t[3]=(...a)=>h.sendMessage&&h.sendMessage(...a))},t[6]||(t[6]=[e("i",{class:"bi bi-send"},null,-1)]))])])):L("",!0)])])}const et=D(ze,[["render",Je]]),tt={name:"WhatsAppComposer",data(){return{searchQuery:"",selectedChat:null,newMessage:"",showLeadModal:!1,leads:[],selectedLeadIds:[],chats:[]}},computed:{filteredChats(){return this.chats.filter(c=>c.name.toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{selectChat(c){this.selectedChat=c},async sendMessage(){if(!this.newMessage.trim()||!this.selectedChat)return;const c=localStorage.getItem("auth_token");this.selectedChat.id,this.selectedChat.phone,this.newMessage;try{const t=await $.post("/api/whatsapp/send",{message:this.newMessage,recipients:[this.selectedChat.phone]},{headers:{Authorization:`Bearer ${c}`}});t.data.success?(this.selectedChat.messages.push({from:"me",text:this.newMessage,time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),this.selectedChat.lastMessage=this.newMessage,this.newMessage=""):console.error("Message sending failed:",t.data.error)}catch(t){console.error("Failed to send message:",t)}},async fetchMyLeads(){try{const c=localStorage.getItem("auth_token"),t=await $.get("/api/leads",{headers:{Authorization:`Bearer ${c}`}});this.leads=t.data,this.showLeadModal=!0}catch(c){console.error("Failed to fetch leads:",c)}},useSelectedLeads(){const c=this.leads.filter(w=>this.selectedLeadIds.includes(w.id));c.forEach(w=>{this.chats.find(l=>l.id===w.id)||this.chats.push({id:w.id,name:`${w.first_name} ${w.last_name}`,phone:w.phone,time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),lastMessage:"New chat started.",messages:[]})});const t=c[0];t&&(this.selectedChat={id:t.id,name:`${t.first_name} ${t.last_name}`,phone:t.phone,messages:[]}),this.showLeadModal=!1,this.selectedLeadIds=[]}}},st={class:"whatsapp-ui d-flex",style:{"block-size":"90vh"}},lt={class:"chat-sidebar border-end",style:{"inline-size":"320px"}},at={class:"p-3 border-bottom d-flex justify-content-between align-items-center"},ot={class:"chat-list overflow-auto"},nt=["onClick"],it={class:"flex-grow-1"},rt={class:"d-flex justify-content-between"},dt={class:"text-muted text-truncate"},ct={class:"chat-area d-flex flex-column flex-grow-1"},ut={class:"p-3 border-bottom bg-white d-flex align-items-center"},mt={class:"flex-grow-1"},ht={class:"chat-messages flex-grow-1 overflow-auto p-3 bg-light"},pt={class:"text-end small mt-1"},vt={class:"chat-input p-3 bg-white border-top d-flex align-items-center"},ft={class:"modal-dialog modal-lg"},gt={class:"modal-content"},bt={class:"modal-header"},yt={class:"modal-body"},wt={key:0},_t={key:1},St=["id","value"],xt=["for"],kt={class:"modal-footer"};function Ct(c,t,w,C,l,h){var a,y;return o(),d("div",st,[e("div",lt,[e("div",at,[M(e("input",{class:"form-control me-2",placeholder:"Search or start a new chat","onUpdate:modelValue":t[0]||(t[0]=n=>l.searchQuery=n)},null,512),[[j,l.searchQuery]]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:t[1]||(t[1]=(...n)=>h.fetchMyLeads&&h.fetchMyLeads(...n))},"Leads")]),e("div",ot,[(o(!0),d(S,null,k(h.filteredChats,n=>{var b;return o(),d("div",{key:n.id,class:E(["chat-item d-flex p-3 border-bottom align-items-start",{"bg-light":((b=l.selectedChat)==null?void 0:b.id)===n.id}]),onClick:i=>h.selectChat(n)},[t[9]||(t[9]=e("img",{src:"https://via.placeholder.com/40",class:"rounded-circle me-2"},null,-1)),e("div",it,[e("div",rt,[e("strong",null,v(n.name),1),e("small",null,v(n.time),1)]),e("div",dt,v(n.lastMessage),1)])],10,nt)}),128))])]),e("div",ct,[e("div",ut,[t[11]||(t[11]=e("img",{src:"https://via.placeholder.com/40",class:"rounded-circle me-2"},null,-1)),e("div",mt,[e("strong",null,v(((a=l.selectedChat)==null?void 0:a.name)||"Select a chat"),1),t[10]||(t[10]=e("div",{class:"text-muted small"},"online",-1))]),t[12]||(t[12]=e("div",{class:"d-flex gap-2"},[e("i",{class:"bi bi-search"}),e("i",{class:"bi bi-telephone"})],-1))]),e("div",ht,[(o(!0),d(S,null,k(((y=l.selectedChat)==null?void 0:y.messages)||[],(n,b)=>(o(),d("div",{key:b,class:"mb-3"},[e("div",{class:E(["p-2 rounded",n.from==="me"?"bg-success text-white ms-auto":"bg-white me-auto"]),style:{"max-inline-size":"75%"}},[W(v(n.text)+" ",1),e("div",pt,v(n.time),1)],2)]))),128))]),e("div",vt,[t[13]||(t[13]=e("i",{class:"bi bi-emoji-smile me-2"},null,-1)),M(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>l.newMessage=n),onKeyup:t[3]||(t[3]=oe((...n)=>h.sendMessage&&h.sendMessage(...n),["enter"])),class:"form-control me-2",placeholder:"Type a message"},null,544),[[j,l.newMessage]]),e("i",{class:"bi bi-send-fill text-primary",role:"button",onClick:t[4]||(t[4]=(...n)=>h.sendMessage&&h.sendMessage(...n))})])]),l.showLeadModal?(o(),d("div",{key:0,class:"modal d-block bg-dark bg-opacity-50",onClick:t[8]||(t[8]=se(n=>l.showLeadModal=!1,["self"]))},[e("div",ft,[e("div",gt,[e("div",bt,[t[14]||(t[14]=e("h5",{class:"modal-title"},"Select Leads",-1)),e("button",{type:"button",class:"btn-close",onClick:t[5]||(t[5]=n=>l.showLeadModal=!1)})]),e("div",yt,[l.leads.length===0?(o(),d("div",wt,"No leads found.")):(o(),d("div",_t,[(o(!0),d(S,null,k(l.leads,n=>(o(),d("div",{key:n.id,class:"form-check mb-2"},[M(e("input",{class:"form-check-input",type:"checkbox",id:"lead-"+n.id,"onUpdate:modelValue":t[6]||(t[6]=b=>l.selectedLeadIds=b),value:n.id},null,8,St),[[he,l.selectedLeadIds]]),e("label",{class:"form-check-label",for:"lead-"+n.id},v(n.name)+" - "+v(n.phone),9,xt)]))),128))]))]),e("div",kt,[e("button",{class:"btn btn-primary",onClick:t[7]||(t[7]=(...n)=>h.useSelectedLeads&&h.useSelectedLeads(...n))},"Use Selected Leads")])])])])):L("",!0)])}const Mt=D(tt,[["render",Ct],["__scopeId","data-v-b15841ac"]]),$t={key:0,class:"integrte_LeadModal"},Lt={class:"modal_LeadContent"},Et={class:"modal-header"},Tt={class:"modal_LeadBody"},It=["value","checked","onChange"],At={key:0,class:"modal-wrapper"},jt={class:"modal-content"},Bt={class:"modal-body"},Nt={class:"mb-3"},zt={class:"mb-3"},Vt={class:"d-flex flex-wrap align-items-center gap-2"},Ft=["onClick"],Ut={class:"mb-3"},Dt={class:"d-flex gap-2 align-items-center"},Pt=["value"],Qt={class:"mb-3"},Ot=["value"],Rt={class:"col-12"},Ht={class:"mb-3"},Wt={class:"mt-2"},Yt=["onClick"],qt={class:"mb-3"},Kt=["value"],Gt={class:"mb-4"},Xt={__name:"EmailModal",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(c,{emit:t}){const w=c,C=t,l=_(!1),h=_(!1),a=_([]),y=_([]),n=_([]),b=_(null),i=_({from:"hiteshpandey732195@gmail.com",to:"",subject:"",message:"",template:"",attachments:[],schedule:""}),B=_(["{{first_name}}","{{last_name}}","{{email}}","{{city}}","{{phone}}"]),N=_([]),T=_(""),z=_([]),O=_(!1),V=localStorage.getItem("auth_token"),F=()=>{C("close"),i.value={from:"hiteshpandey732195@gmail.com",to:"",subject:"",message:"",template:"",attachments:[],schedule:""},y.value=[],n.value=[],T.value="",b.value&&b.value.setContent("")},q=()=>{l.value=!l.value,b.value&&b.value.execCommand("mceRepaint")},K=async()=>{try{const r=await $.get("/api/leads",{headers:{Authorization:`Bearer ${V}`}});a.value=r.data.data||r.data}catch(r){console.error("Error fetching leads",r),x.fire("Error","Could not load leads.","error")}},G=async()=>{await K(),h.value=!0},U=r=>y.value.includes(r.id),R=r=>{const s=y.value.indexOf(r.id);s===-1?y.value.push(r.id):y.value.splice(s,1)},H=()=>{h.value=!1},X=r=>{const s=n.value[r];n.value.splice(r,1);const u=a.value.find(g=>g.email===s);u&&(y.value=y.value.filter(g=>g!==u.id))};P(y,r=>{n.value=a.value.filter(s=>r.includes(s.id)).map(s=>s.email)},{deep:!0}),P(n,r=>{i.value.to=r.join(", ")},{deep:!0});const Z=(r,s)=>{b.value=s,i.value.message&&s.getContent()===""&&s.setContent(i.value.message)},J={height:300,menubar:!1,plugins:"link lists image code preview fullscreen",toolbar:"undo redo | formatselect | bold italic underline | alignleft aligncenter alignright | bullist numlist outdent indent | image link code | mergefields signatures | preview fullscreen",branding:!1,resize:!0,automatic_uploads:!0,setup(r){r.ui.registry.addMenuButton("mergefields",{text:"Merge Fields",fetch(s){const u=B.value.map(g=>({type:"menuitem",text:g,onAction:()=>{r.insertContent(g)}}));s(u)}}),r.ui.registry.addMenuButton("signatures",{text:"Signatures",fetch(s){const u=N.value.map(g=>({type:"menuitem",text:g.name||`Signature ${g.id}`,onAction:()=>{r.insertContent(g.content)}}));s(u)}})}},ee=async()=>{O.value=!0;try{const r=await $.get("/api/templates",{headers:{Authorization:`Bearer ${V}`}});z.value=r.data.data??r.data}catch(r){console.error("Error fetching email templates:",r),x.fire("Error","Could not load email templates.","error")}finally{O.value=!1}},p=async()=>{if(!Array.isArray(z.value))return;const r=z.value.find(s=>s.id===i.value.template);if(r&&(i.value.subject=r.subject||"",await Y(),b.value?b.value.setContent(r.content||""):i.value.message=r.content||"",r.attachment_path?i.value.attachments=[{name:r.attachment_path.split("/").pop(),path:r.attachment_path}]:i.value.attachments=[],T.value&&b.value)){const s=b.value.getContent();s.includes(T.value)||b.value.setContent(s+"<br><br>"+T.value)}},m=r=>{i.value.attachments=Array.from(r.target.files)},f=r=>{i.value.attachments.splice(r,1)},I=async()=>{try{const r=await $.get("/api/signatures",{headers:{Authorization:`Bearer ${V}`}});N.value=r.data.data}catch(r){console.error("Error fetching signatures:",r),x.fire("Error","Could not load signatures.","error")}},le=()=>{if(T.value&&b.value){const r=b.value.getContent();r.includes(T.value)||b.value.setContent(r+"<br><br>"+T.value)}},ce=r=>{const s=r.target.value;s&&(i.value.subject+=` ${s}`,r.target.value="")},ue=()=>{const r=b.value?b.value.getContent():i.value.message;x.fire({title:"Email Preview",html:`<strong>From:</strong> ${i.value.from}<br>
           <strong>To:</strong> ${i.value.to}<br>
           <strong>Subject:</strong> ${i.value.subject}<br>
           <strong>Message:</strong><br> ${r}`,icon:"info",customClass:{container:"swal-text-left"},width:"auto"})},me=async()=>{const r=parseInt(localStorage.getItem("user_id"));if(!r||isNaN(r)){x.fire({icon:"error",title:"Missing User ID",text:"Please log in again. User ID is missing or invalid."});return}const s=b.value?b.value.getContent():i.value.message;if(y.value.length===0||!i.value.subject.trim()||!s.trim()){x.fire({icon:"error",title:"Missing Information",text:"Recipient, Subject, and Message cannot be empty."});return}x.fire({title:"Are you sure?",text:"Do you want to send this email?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send it!",cancelButtonText:"Cancel"}).then(async u=>{if(u.isConfirmed)try{const g=new FormData;g.append("from",i.value.from),g.append("subject",i.value.subject),g.append("message",s),g.append("template_id",i.value.template||""),g.append("user_id",r),g.append("schedule",i.value.schedule||""),y.value.forEach(A=>{g.append("lead_ids[]",A)}),n.value.forEach(A=>{g.append("to[]",A)}),i.value.attachments.forEach(A=>{A instanceof File?g.append("attachments[]",A):A.path&&g.append("attachment_paths[]",A.path)}),await $.post("/api/send-email",g,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${V}`}}),x.fire({icon:"success",title:"Email Sent!",text:"Your email has been successfully sent."}),F()}catch(g){console.error("Email Send Error:",g),x.fire({icon:"error",title:"Failed to Send",text:"Something went wrong. Please try again later."})}})};return P(()=>w.show,async r=>{r&&(await ee(),await I(),await Y(),b.value&&b.value.setContent(""))},{immediate:!0}),(r,s)=>(o(),d(S,null,[(o(),Q(ne,{to:"body"},[h.value?(o(),d("div",$t,[e("div",Lt,[e("div",Et,[s[8]||(s[8]=e("h2",null,"Select Leads for Email",-1)),e("button",{onClick:s[0]||(s[0]=u=>h.value=!1)},"×")]),e("div",Tt,[e("table",null,[s[9]||(s[9]=e("thead",null,[e("tr",null,[e("th",null,"Select"),e("th",null,"Name"),e("th",null,"Email")])],-1)),e("tbody",null,[(o(!0),d(S,null,k(a.value,u=>(o(),d("tr",{key:u.id},[e("td",null,[e("input",{type:"checkbox",value:u.id,checked:U(u),onChange:g=>R(u)},null,40,It)]),e("td",null,v(u.first_name)+" "+v(u.last_name),1),e("td",null,v(u.email),1)]))),128))])])]),e("div",{class:"modal-footer"},[e("button",{onClick:H},"Add Selected")])])])):L("",!0)])),c.show?(o(),d("div",At,[e("div",{class:"modal-backdrop-blur",onClick:F}),c.show?(o(),d("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:se(F,["self"])},[e("div",{class:E(["modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",{"modal-fullscreen":l.value}])},[e("div",jt,[e("div",{class:"modal-header"},[s[10]||(s[10]=e("h5",{class:"modal-title"},"Compose Email",-1)),e("div",{class:"d-flex align-items-center gap-2"},[e("i",{class:"fas fa-expand-alt text-primary cursor-pointer",onClick:q,title:"Expand"}),e("button",{type:"button",class:"btn-close",onClick:F,"aria-label":"Close"})])]),e("div",Bt,[e("div",Nt,[s[11]||(s[11]=e("label",{class:"form-label",for:"email-from"},"From:",-1)),M(e("input",{type:"email",id:"email-from",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=u=>i.value.from=u),placeholder:"Sender email address"},null,512),[[j,i.value.from]])]),e("div",zt,[s[12]||(s[12]=e("label",{class:"form-label"},"To:",-1)),e("div",Vt,[(o(!0),d(S,null,k(n.value,(u,g)=>(o(),d("span",{key:g,class:"badge bg-success"},[W(v(u)+" ",1),e("button",{type:"button",class:"btn-close btn-close-white btn-sm ms-2",onClick:A=>X(g)},null,8,Ft)]))),128)),e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:G}," + ")])]),e("div",Ut,[s[14]||(s[14]=e("label",{class:"form-label",for:"email-subject"},"Subject:",-1)),e("div",Dt,[M(e("input",{type:"text",id:"email-subject",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=u=>i.value.subject=u),placeholder:"Email Subject"},null,512),[[j,i.value.subject]]),e("select",{class:"form-select w-auto",onChange:s[3]||(s[3]=u=>ce(u))},[s[13]||(s[13]=e("option",{value:""},"+ Merge Field",-1)),(o(!0),d(S,null,k(B.value,u=>(o(),d("option",{key:u,value:u},v(u),9,Pt))),128))],32)])]),e("div",Qt,[s[16]||(s[16]=e("label",{class:"form-label"},"Template:",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":s[4]||(s[4]=u=>i.value.template=u),onChange:p},[s[15]||(s[15]=e("option",{value:"",disabled:""},"Select a Template",-1)),(o(!0),d(S,null,k(z.value,u=>(o(),d("option",{key:u.id,value:u.id},v(u.name),9,Ot))),128))],544),[[te,i.value.template]])]),e("div",Rt,[s[17]||(s[17]=e("label",{class:"form-label"},"* Body",-1)),ie(re(de),{init:J,modelValue:i.value.message,"onUpdate:modelValue":s[5]||(s[5]=u=>i.value.message=u),onInit:Z},null,8,["modelValue"])]),e("div",Ht,[s[18]||(s[18]=e("label",{class:"form-label"},"Attachments:",-1)),e("input",{type:"file",class:"form-control",multiple:"",onChange:m},null,32),e("div",Wt,[(o(!0),d(S,null,k(i.value.attachments,(u,g)=>(o(),d("span",{key:g,class:"badge bg-secondary me-2"},[W(v(u.name||u.path||u)+" ",1),e("button",{type:"button",class:"btn-close btn-close-white btn-sm ms-2",onClick:A=>f(g)},null,8,Yt)]))),128))])]),e("div",qt,[s[20]||(s[20]=e("label",{class:"form-label"},"Signature:",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":s[6]||(s[6]=u=>T.value=u),onChange:le},[s[19]||(s[19]=e("option",{value:""},"No Signature",-1)),(o(!0),d(S,null,k(N.value,u=>(o(),d("option",{key:u.id,value:u.content},v(u.name||"Signature "+u.id),9,Kt))),128))],544),[[te,T.value]])]),e("div",Gt,[s[21]||(s[21]=e("label",{class:"form-label"},"Schedule Email:",-1)),M(e("input",{type:"datetime-local",class:"form-control","onUpdate:modelValue":s[7]||(s[7]=u=>i.value.schedule=u)},null,512),[[j,i.value.schedule]])]),e("div",{class:"d-flex justify-content-end gap-2"},[e("button",{class:"btn btn-info",onClick:ue},"Preview"),e("button",{class:"btn btn-success",onClick:me},"Send Email")])])])],2)])):L("",!0)])):L("",!0)],64))}},Zt=D(Xt,[["__scopeId","data-v-3717dfd6"]]),Jt={key:0,class:"integrte_LeadModal"},es={class:"modal_LeadContent"},ts={class:"modal-header"},ss={class:"modal_LeadBody"},ls=["value","checked","onChange"],as={key:0,class:"modal-wrapper"},os={class:"modal-content"},ns={class:"modal-header"},is={class:"d-flex align-items-center gap-2"},rs={class:"modal-body"},ds={class:"mb-3"},cs={class:"mb-3"},us={class:"d-flex flex-wrap align-items-center gap-2"},ms=["onClick"],hs={class:"mb-3"},ps=["value"],vs={class:"mb-3"},fs={class:"mb-4"},gs={__name:"SmsModal",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(c,{emit:t}){const w=c,C=t,l=_(!1),h=_(!1),a=_([]),y=_([]),n=_([]);_(null);const b=_(["{{first_name}}","{{last_name}}","{{email}}","{{city}}","{{phone}}"]),i=_({from:"",to:"",toName:"",subject:"",message:"",template:"",schedule:""});P(()=>w.show,p=>{p?Y(()=>{H()}):(i.value={from:"",to:"",toName:"",subject:"",message:"",template:"",schedule:""},a.value=[],n.value=[])});const B=()=>{C("close")},N=()=>{i.value.to=a.value.map(p=>p.phone).join(", "),i.value.toName=a.value.map(p=>p.first_name).join(", ")},T=p=>{const m=n.value.indexOf(p.id);m===-1?(n.value.push(p.id),a.value.push({id:p.id,first_name:p.first_name,phone:p.phone})):(n.value.splice(m,1),a.value=a.value.filter(f=>f.id!==p.id)),N()},z={height:300,menubar:!1,plugins:"link lists code",toolbar:"undo redo | bold italic underline | alignleft aligncenter alignright | bullist numlist | mergeFieldButton",branding:!1,setup(p){p.ui.registry.addMenuButton("mergeFieldButton",{text:"Merge Fields",fetch(m){const f=b.value.map(I=>({type:"menuitem",text:I,onAction:()=>{p.insertContent(I)}}));m(f)}})}},O=p=>n.value.includes(p.id),V=localStorage.getItem("auth_token"),F=async()=>{try{const p=await $.get("/api/leads",{headers:{Authorization:`Bearer ${V}`}});y.value=p.data}catch(p){console.error("Error fetching leads",p)}},q=async()=>{await F(),h.value=!0},K=p=>{const m=a.value[p];a.value.splice(p,1),n.value=n.value.filter(f=>f!==m.id),N()};P(n,()=>{i.value.to=a.value.map(p=>p.phone).join(", "),i.value.toName=a.value.map(p=>p.first_name).join(", ")});const G=()=>{h.value=!1},U=_([]),R=_(!1),H=async()=>{R.value=!0;try{const p=await $.get("/api/sms-templates");U.value=p.data.templates}catch{x.fire("Error","Could not load SMS templates.","error")}finally{R.value=!1}},X=()=>{if(!Array.isArray(U.value))return;const p=U.value.find(m=>m.id===i.value.template);p&&(i.value.message=p.content)},Z=()=>{x.fire({title:"SMS Preview",html:`<strong>From:</strong> ${i.value.from}<br>
              <strong>To:</strong> ${i.value.to}<br>
              <strong>Message:</strong><br> ${i.value.message}`,icon:"info"})},J=async()=>{const p=parseInt(localStorage.getItem("user_id"));if(!p||isNaN(p)){x.fire("Missing User ID","Please log in again.","error");return}if(a.value.length===0||!i.value.message.trim()){x.fire("Missing Information","Recipient and message cannot be empty.","error");return}try{const m=a.value.map(I=>I.phone),f=a.value.map(I=>I.id);await $.post("/api/send-sms",{lead_ids:f,user_id:p,from:i.value.from,to:m.join(", "),message:i.value.message,schedule:i.value.schedule||null}),x.fire("Success","SMS sent successfully.","success"),B()}catch(m){console.error("SMS Send Error:",m),x.fire("Error","Failed to send SMS.","error")}},ee=()=>{l.value=!l.value,Y(()=>{})};return pe(()=>{H()}),(p,m)=>(o(),d(S,null,[(o(),Q(ne,{to:"body"},[h.value?(o(),d("div",Jt,[e("div",es,[e("div",ts,[m[6]||(m[6]=e("h2",null,"Select Leads",-1)),e("button",{onClick:m[0]||(m[0]=f=>h.value=!1)},"×")]),e("div",ss,[e("table",null,[m[7]||(m[7]=e("thead",null,[e("tr",null,[e("th",null,"Select"),e("th",null,"Name"),e("th",null,"Phone")])],-1)),e("tbody",null,[(o(!0),d(S,null,k(y.value,f=>(o(),d("tr",{key:f.id},[e("td",null,[e("input",{type:"checkbox",value:f.phone,checked:O(f),onChange:I=>T(f)},null,40,ls)]),e("td",null,v(f.first_name)+" "+v(f.last_name),1),e("td",null,v(f.phone),1)]))),128))])])]),e("div",{class:"modal-footer"},[e("button",{onClick:G},"Add Selected")])])])):L("",!0)])),c.show?(o(),d("div",as,[e("div",{class:"modal-backdrop-blur",onClick:B}),c.show?(o(),d("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:se(B,["self"])},[e("div",{class:E(["modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",{"modal-fullscreen":l.value}])},[e("div",os,[e("div",ns,[m[8]||(m[8]=e("h5",{class:"modal-title"},"Compose SMS",-1)),e("div",is,[e("i",{class:"fas fa-expand-alt text-primary cursor-pointer",onClick:ee,title:"Expand"}),e("button",{type:"button",class:"btn-close",onClick:m[1]||(m[1]=f=>p.$emit("close")),"aria-label":"Close"})])]),e("div",rs,[e("div",ds,[m[9]||(m[9]=e("label",{class:"form-label",for:"sms-from"},"From:",-1)),M(e("input",{type:"text",id:"sms-from",class:"form-control","onUpdate:modelValue":m[2]||(m[2]=f=>i.value.from=f),placeholder:"Sender name or phone"},null,512),[[j,i.value.from]])]),e("div",cs,[m[10]||(m[10]=e("label",{class:"form-label"},"To:",-1)),e("div",us,[(o(!0),d(S,null,k(a.value,(f,I)=>(o(),d("span",{key:f.id,class:"badge bg-success"},[W(v(f.first_name)+" ",1),e("button",{type:"button",class:"btn-close btn-close-white btn-sm ms-2",onClick:le=>K(I)},null,8,ms)]))),128)),e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:q}," + ")])]),e("div",hs,[m[12]||(m[12]=e("label",{class:"form-label"},"Template:",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":m[3]||(m[3]=f=>i.value.template=f),onChange:X},[m[11]||(m[11]=e("option",{value:"",disabled:""},"Select a Template",-1)),(o(!0),d(S,null,k(U.value,f=>(o(),d("option",{key:f.id,value:f.id},v(f.name),9,ps))),128))],544),[[te,i.value.template]])]),e("div",vs,[m[13]||(m[13]=e("label",{class:"form-label"},"Message:",-1)),ie(re(de),{id:"sms-editor",init:z,modelValue:i.value.message,"onUpdate:modelValue":m[4]||(m[4]=f=>i.value.message=f)},null,8,["modelValue"])]),e("div",fs,[m[14]||(m[14]=e("label",{class:"form-label"},"Schedule SMS:",-1)),M(e("input",{type:"datetime-local",class:"form-control","onUpdate:modelValue":m[5]||(m[5]=f=>i.value.schedule=f)},null,512),[[j,i.value.schedule]])]),e("div",{class:"d-flex justify-content-end gap-2"},[e("button",{class:"btn btn-info",onClick:Z}," Preview "),e("button",{class:"btn btn-success",onClick:J}," Send SMS ")])])])],2)])):L("",!0)])):L("",!0)],64))}},bs=D(gs,[["__scopeId","data-v-99df4e1a"]]),ys={name:"Inbox",components:{SMS:et,Email:Ne,WhatsApp:Mt,SmsModal:bs,EmailModal:Zt},data(){return{activeTab:localStorage.getItem("activeTab")||"sms",showSmsModal:!1,showEmailModal:!1}},computed:{activeTabComponent(){return this.activeTab==="email"?"Email":this.activeTab==="sms"?"SMS":this.activeTab==="whatsapp"?"WhatsApp":"SMS"}},methods:{setActiveTab(c){this.activeTab=c,localStorage.setItem("activeTab",c)},openSmsModal(){console.log("[OPEN SMS MODAL] Triggered"),this.showSmsModal=!0},openEmailModal(){console.log("[OPEN EMAIL MODAL] Triggered"),this.showEmailModal=!0},closeSmsModal(){this.showSmsModal=!1},closeEmailModal(){this.showEmailModal=!1}}},ws={class:"container py-3"},_s={class:"d-flex justify-content-between align-items-center mb-3"},Ss={class:"btn-group me-3"};function xs(c,t,w,C,l,h){const a=ae("SmsModal"),y=ae("EmailModal");return o(),d("div",ws,[e("div",_s,[e("div",Ss,[e("button",{onClick:t[0]||(t[0]=n=>h.setActiveTab("email")),class:E(["btn",l.activeTab==="email"?"btn-primary text-white":"btn-outline-primary"])}," Email ",2),e("button",{onClick:t[1]||(t[1]=n=>h.setActiveTab("sms")),class:E(["btn",l.activeTab==="sms"?"btn-primary text-white":"btn-outline-primary"])}," SMS ",2),e("button",{onClick:t[2]||(t[2]=n=>h.setActiveTab("whatsapp")),class:E(["btn",l.activeTab==="whatsapp"?"btn-success text-white":"btn-outline-success"])}," WhatsApp ",2)]),t[7]||(t[7]=e("div",{class:"me-auto"},[e("select",{class:"form-select",style:{"inline-size":"150px"}},[e("option",null,"Inbox"),e("option",null,"Sent")])],-1)),e("div",null,[e("button",{class:"btn btn-primary me-2 btn big-dark-button",onClick:t[3]||(t[3]=(...n)=>h.openEmailModal&&h.openEmailModal(...n))}," + Send New Email "),e("button",{class:"btn big-dark-button",onClick:t[4]||(t[4]=(...n)=>h.openSmsModal&&h.openSmsModal(...n))}," + Send New SMS ")])]),(o(),Q(ve(h.activeTabComponent))),l.showSmsModal?(o(),Q(a,{key:0,show:l.showSmsModal,onClose:t[5]||(t[5]=n=>l.showSmsModal=!1)},null,8,["show"])):L("",!0),l.showEmailModal?(o(),Q(y,{key:1,show:l.showEmailModal,onClose:t[6]||(t[6]=n=>l.showEmailModal=!1)},null,8,["show"])):L("",!0)])}const Ts=D(ys,[["render",xs]]);export{Ts as default};
