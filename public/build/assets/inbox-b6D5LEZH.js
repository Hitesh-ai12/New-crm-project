import"./bootstrap.min-KxrJAQL6.js";import{a as M}from"./axios-CdtiCRuU.js";import{_ as O,o as n,l as c,j as e,L,d6 as A,F as k,Y as C,n as j,k as f,X as $,dd as me,r as y,w as U,f as P,bh as oe,aG as ae,P as ee,Z as te,h as ne,u as ie,au as Y,R as pe,p as ve,e as le}from"./main-CeuNZyWX.js";import{S}from"./sweetalert2.all-DyJFIm0t.js";import{E as re}from"./Editor-CogAWS2C.js";import"./_commonjsHelpers-BosuxZz1.js";const he={data(){return{leads:[],selectedLead:null,messages:[],searchQuery:""}},computed:{filteredLeads(){return this.leads.filter(m=>`${m.firstName||""} ${m.lastName||""}`.trim().toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{async fetchLeads(){const r={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},_=await M.get("/api/email/chats",{headers:r});this.leads=_.data},async selectLead(m){const _={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},x=await M.get(`/api/email/lead/${m.leadId}`,{headers:_});this.selectedLead=m,this.messages=x.data.reverse(),this.$nextTick(()=>this.scrollToBottom())},scrollToBottom(){const m=this.$refs.emailArea;m&&(m.scrollTop=m.scrollHeight)}},mounted(){this.fetchLeads()}},fe={class:"email-chat d-flex shadow rounded",style:{"block-size":"90vh"}},ge={class:"border-end p-3 col-lg-4 col-md-5 col-sm-5 col-xs-12 col-12",style:{"inline-size":"300px"}},be={class:"header-search-area"},ye=["onClick"],we={class:"d-flex flex-column"},_e={class:"fw-bold"},Se={class:"d-flex justify-content-between align-items-center"},ke={class:"badge bg-success"},xe={class:"text-muted"},Ce={class:"flex-grow-1 d-flex flex-column bg-light"},Me={class:"border-bottom p-3 bg-white"},$e={key:0},Ee={key:1,class:"text-muted"},Te={class:"flex-grow-1 overflow-auto p-3",ref:"emailArea"},Le={key:0,class:"text-center text-muted small"},Ie=["innerHTML"],je={class:"d-block text-end mt-1"};function Ae(m,r,_,x,i,h){return n(),c("div",fe,[e("div",ge,[e("div",be,[L(e("input",{class:"form-control mb-2","onUpdate:modelValue":r[0]||(r[0]=s=>i.searchQuery=s),placeholder:"Enter Lead Name"},null,512),[[A,i.searchQuery]])]),(n(!0),c(k,null,C(h.filteredLeads,s=>{var b;return n(),c("div",{key:s.leadId,class:j(["lead-item p-2 border-bottom",{"bg-primary text-white":((b=i.selectedLead)==null?void 0:b.leadId)===s.leadId}]),onClick:g=>h.selectLead(s)},[e("div",we,[e("div",_e,f(s.firstName)+" "+f(s.lastName),1),e("div",Se,[e("span",ke,f(s.status||"Open"),1),e("small",xe,f(s.date||"16jun, 2025 | 11:00 am"),1)])])],10,ye)}),128))]),e("div",Ce,[e("div",Me,[i.selectedLead?(n(),c("h5",$e,f(i.selectedLead.firstName)+" "+f(i.selectedLead.lastName),1)):(n(),c("p",Ee,"Select a lead to view emails"))]),e("div",Te,[(n(!0),c(k,null,C(i.messages,(s,b)=>(n(),c("div",{key:b,class:"mb-3"},[s.date?(n(),c("div",Le,f(s.date),1)):$("",!0),e("div",{class:j(["p-3 rounded shadow-sm",s.direction==="sent"?"bg-info text-white ms-auto":"bg-white me-auto"]),style:{"max-inline-size":"75%"}},[e("strong",null,f(s.subject),1),e("div",{class:"mt-1",innerHTML:s.description},null,8,Ie),e("small",je,f(s.time),1)],2)]))),128))],512)])])}const Be=O(he,[["render",Ae]]),Ne={data(){return{searchQuery:"",newMessage:"",selectedChat:null,leads:[],messages:[]}},computed:{filteredLeads(){return this.leads.filter(m=>m.name.toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{async fetchLeads(){try{const r={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},_=await M.get("/api/sms/leads",{headers:r});this.leads=_.data}catch(m){console.error("Error loading leads:",m)}},async selectChat(m){try{const _={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},i=(await M.get(`/api/sms/lead/${m.leadId}`,{headers:_})).data,h=i.length>0?i[0].phone:m.phone||"";this.selectedChat={...m,phone:h},this.messages=i.reverse(),this.$nextTick(()=>this.scrollToBottom())}catch(r){console.error("Error loading messages:",r)}},async sendMessage(){const m=localStorage.getItem("auth_token"),r=parseInt(localStorage.getItem("user_id")),_={Authorization:`Bearer ${m}`};try{const x={lead_ids:[this.selectedChat.leadId],user_id:r,from:"+16187452168",to:this.selectedChat.phone,subject:"SMS Chat",message:this.newMessage};await M.post("/api/send-sms",x,{headers:_});const i=new Date,h=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),s=i.toISOString().slice(0,10);this.messages.push({id:`sms-sent-${Date.now()}`,type:"sms",direction:"sent",phone:this.selectedChat.phone,title:"Sent SMS",description:this.newMessage,leadId:this.selectedChat.leadId,date:s,time:h}),this.newMessage="",this.$nextTick(()=>this.scrollToBottom())}catch(x){console.error("Send SMS Error:",x),S.fire("Error","Failed to send SMS.","error")}},scrollToBottom(){const m=this.$refs.messagesArea;m&&(m.scrollTop=m.scrollHeight)}},mounted(){this.fetchLeads()}},ze={class:"chat-container d-flex shadow rounded",style:{"block-size":"90vh","margin-block":"20px","margin-inline":"auto","max-inline-size":"1200px"}},Fe={class:"sidebar border-end d-flex flex-column bg-white",style:{"inline-size":"320px","min-inline-size":"250px"}},Ve={class:"p-3 border-bottom"},De={class:"flex-grow-1 overflow-auto chat-list"},Ue=["onClick"],Pe={class:"flex-grow-1"},Oe={class:"fw-bold"},Qe={class:"chat-window d-flex flex-column flex-grow-1 bg-light"},Re={key:0,class:"chat-header d-flex align-items-center p-3 border-bottom bg-white"},He={class:"mb-0 flex-grow-1"},Ye={key:1,class:"chat-header d-flex align-items-center justify-content-center p-3 text-muted"},qe={class:"messages-area flex-grow-1 p-4 overflow-auto",ref:"messagesArea"},Ke={key:0,class:"text-center small text-muted mb-2"},Ge={class:"d-block text-end mt-1 text-white-50"},Xe={key:2,class:"p-3 border-top bg-white"},Ze={class:"input-group position-relative"};function Je(m,r,_,x,i,h){return n(),c("div",ze,[e("div",Fe,[e("div",Ve,[L(e("input",{type:"text",class:"form-control rounded-pill",placeholder:"Search lead","onUpdate:modelValue":r[0]||(r[0]=s=>i.searchQuery=s)},null,512),[[A,i.searchQuery]])]),e("div",De,[(n(!0),c(k,null,C(h.filteredLeads,s=>(n(),c("div",{key:s.leadId,onClick:b=>h.selectChat(s),class:j(["d-flex align-items-center p-3 border-bottom chat-item",{"bg-primary text-white":i.selectedChat&&i.selectedChat.leadId===s.leadId}]),style:{cursor:"pointer"}},[r[4]||(r[4]=e("img",{src:"https://cdn-icons-png.flaticon.com/512/1384/1384031.png",width:"45",height:"45",class:"rounded-circle me-3",alt:"Avatar"},null,-1)),e("div",Pe,[e("div",Oe,f(s.name),1),e("small",{class:j(["text-muted",{"text-white-50":i.selectedChat&&i.selectedChat.leadId===s.leadId}])}," Lead ID: "+f(s.leadId),3)])],10,Ue))),128))])]),e("div",Qe,[i.selectedChat?(n(),c("div",Re,[r[5]||(r[5]=e("img",{src:"https://cdn-icons-png.flaticon.com/512/1384/1384031.png",width:"40",height:"40",class:"rounded-circle me-3",alt:"Avatar"},null,-1)),e("h5",He,f(i.selectedChat.name),1)])):(n(),c("div",Ye," Select a lead to view messages ")),e("div",qe,[i.messages.length&&i.selectedChat?(n(!0),c(k,{key:0},C(i.messages,(s,b)=>(n(),c("div",{key:b,class:"mb-3"},[s.date?(n(),c("div",Ke,[e("strong",null,f(s.date),1)])):$("",!0),e("div",{class:j(["message-bubble p-3 rounded shadow-sm",s.direction==="sent"?"bg-success text-white ms-auto":"bg-white me-auto"]),style:{"max-inline-size":"75%"}},[e("div",null,f(s.description),1),e("small",Ge,f(s.time),1)],2)]))),128)):$("",!0)],512),i.selectedChat?(n(),c("div",Xe,[e("div",Ze,[L(e("input",{type:"text",class:"form-control rounded-pill pe-5",placeholder:"Type a message","onUpdate:modelValue":r[1]||(r[1]=s=>i.newMessage=s),onKeyup:r[2]||(r[2]=me((...s)=>h.sendMessage&&h.sendMessage(...s),["enter"]))},null,544),[[A,i.newMessage]]),e("button",{class:"btn btn-primary rounded-circle position-absolute",style:{"z-index":"1","block-size":"40px","inline-size":"40px","inset-block-start":"50%","inset-inline-end":"10px",transform:"translateY(-50%)"},onClick:r[3]||(r[3]=(...s)=>h.sendMessage&&h.sendMessage(...s))},r[6]||(r[6]=[e("i",{class:"bi bi-send"},null,-1)]))])])):$("",!0)])])}const We=O(Ne,[["render",Je]]),et={key:0,class:"integrte_LeadModal"},tt={class:"modal_LeadContent"},st={class:"modal-header"},lt={class:"modal_LeadBody"},ot=["value","checked","onChange"],at={key:0,class:"modal-wrapper"},nt={class:"modal-content"},it={class:"modal-body"},rt={class:"mb-3"},dt={class:"mb-3"},ct={class:"d-flex flex-wrap align-items-center gap-2"},ut=["onClick"],mt={class:"mb-3"},pt={class:"d-flex gap-2 align-items-center"},vt=["value"],ht={class:"mb-3"},ft=["value"],gt={class:"col-12"},bt={class:"mb-3"},yt={class:"mt-2"},wt=["onClick"],_t={class:"mb-3"},St=["value"],kt={class:"mb-4"},xt={__name:"EmailModal",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(m,{emit:r}){const _=m,x=r,i=y(!1),h=y(!1),s=y([]),b=y([]),g=y([]),w=y(null),o=y({from:"hiteshpandey732195@gmail.com",to:"",subject:"",message:"",template:"",attachments:[],schedule:""}),B=y(["{{first_name}}","{{last_name}}","{{email}}","{{city}}","{{phone}}"]),N=y([]),E=y(""),z=y([]),Q=y(!1),F=localStorage.getItem("auth_token"),V=()=>{x("close"),o.value={from:"hiteshpandey732195@gmail.com",to:"",subject:"",message:"",template:"",attachments:[],schedule:""},b.value=[],g.value=[],E.value="",w.value&&w.value.setContent("")},q=()=>{i.value=!i.value,w.value&&w.value.execCommand("mceRepaint")},K=async()=>{try{const l=await M.get("/api/leads",{headers:{Authorization:`Bearer ${F}`}});s.value=l.data.data||l.data}catch(l){console.error("Error fetching leads",l),S.fire("Error","Could not load leads.","error")}},G=async()=>{await K(),h.value=!0},D=l=>b.value.includes(l.id),R=l=>{const t=b.value.indexOf(l.id);t===-1?b.value.push(l.id):b.value.splice(t,1)},H=()=>{h.value=!1},X=l=>{const t=g.value[l];g.value.splice(l,1);const a=s.value.find(v=>v.email===t);a&&(b.value=b.value.filter(v=>v!==a.id))};U(b,l=>{g.value=s.value.filter(t=>l.includes(t.id)).map(t=>t.email)},{deep:!0}),U(g,l=>{o.value.to=l.join(", ")},{deep:!0});const Z=(l,t)=>{w.value=t,o.value.message&&t.getContent()===""&&t.setContent(o.value.message)},J={height:300,menubar:!1,plugins:"link lists image code preview fullscreen",toolbar:"undo redo | formatselect | bold italic underline | alignleft aligncenter alignright | bullist numlist outdent indent | image link code | mergefields signatures | preview fullscreen",branding:!1,resize:!0,automatic_uploads:!0,setup(l){l.ui.registry.addMenuButton("mergefields",{text:"Merge Fields",fetch(t){const a=B.value.map(v=>({type:"menuitem",text:v,onAction:()=>{l.insertContent(v)}}));t(a)}}),l.ui.registry.addMenuButton("signatures",{text:"Signatures",fetch(t){const a=N.value.map(v=>({type:"menuitem",text:v.name||`Signature ${v.id}`,onAction:()=>{l.insertContent(v.content)}}));t(a)}})}},W=async()=>{Q.value=!0;try{const l=await M.get("/api/templates",{headers:{Authorization:`Bearer ${F}`}});z.value=l.data.data??l.data}catch(l){console.error("Error fetching email templates:",l),S.fire("Error","Could not load email templates.","error")}finally{Q.value=!1}},u=async()=>{if(!Array.isArray(z.value))return;const l=z.value.find(t=>t.id===o.value.template);if(l&&(o.value.subject=l.subject||"",await Y(),w.value?w.value.setContent(l.content||""):o.value.message=l.content||"",l.attachment_path?o.value.attachments=[{name:l.attachment_path.split("/").pop(),path:l.attachment_path}]:o.value.attachments=[],E.value&&w.value)){const t=w.value.getContent();t.includes(E.value)||w.value.setContent(t+"<br><br>"+E.value)}},d=l=>{o.value.attachments=Array.from(l.target.files)},p=l=>{o.value.attachments.splice(l,1)},T=async()=>{try{const l=await M.get("/api/signatures",{headers:{Authorization:`Bearer ${F}`}});N.value=l.data.data}catch(l){console.error("Error fetching signatures:",l),S.fire("Error","Could not load signatures.","error")}},se=()=>{if(E.value&&w.value){const l=w.value.getContent();l.includes(E.value)||w.value.setContent(l+"<br><br>"+E.value)}},de=l=>{const t=l.target.value;t&&(o.value.subject+=` ${t}`,l.target.value="")},ce=()=>{const l=w.value?w.value.getContent():o.value.message;S.fire({title:"Email Preview",html:`<strong>From:</strong> ${o.value.from}<br>
           <strong>To:</strong> ${o.value.to}<br>
           <strong>Subject:</strong> ${o.value.subject}<br>
           <strong>Message:</strong><br> ${l}`,icon:"info",customClass:{container:"swal-text-left"},width:"auto"})},ue=async()=>{const l=parseInt(localStorage.getItem("user_id"));if(!l||isNaN(l)){S.fire({icon:"error",title:"Missing User ID",text:"Please log in again. User ID is missing or invalid."});return}const t=w.value?w.value.getContent():o.value.message;if(b.value.length===0||!o.value.subject.trim()||!t.trim()){S.fire({icon:"error",title:"Missing Information",text:"Recipient, Subject, and Message cannot be empty."});return}S.fire({title:"Are you sure?",text:"Do you want to send this email?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send it!",cancelButtonText:"Cancel"}).then(async a=>{if(a.isConfirmed)try{const v=new FormData;v.append("from",o.value.from),v.append("subject",o.value.subject),v.append("message",t),v.append("template_id",o.value.template||""),v.append("user_id",l),v.append("schedule",o.value.schedule||""),b.value.forEach(I=>{v.append("lead_ids[]",I)}),g.value.forEach(I=>{v.append("to[]",I)}),o.value.attachments.forEach(I=>{I instanceof File?v.append("attachments[]",I):I.path&&v.append("attachment_paths[]",I.path)}),await M.post("/api/send-email",v,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${F}`}}),S.fire({icon:"success",title:"Email Sent!",text:"Your email has been successfully sent."}),V()}catch(v){console.error("Email Send Error:",v),S.fire({icon:"error",title:"Failed to Send",text:"Something went wrong. Please try again later."})}})};return U(()=>_.show,async l=>{l&&(await W(),await T(),await Y(),w.value&&w.value.setContent(""))},{immediate:!0}),(l,t)=>(n(),c(k,null,[(n(),P(oe,{to:"body"},[h.value?(n(),c("div",et,[e("div",tt,[e("div",st,[t[8]||(t[8]=e("h2",null,"Select Leads for Email",-1)),e("button",{onClick:t[0]||(t[0]=a=>h.value=!1)},"×")]),e("div",lt,[e("table",null,[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",null,"Select"),e("th",null,"Name"),e("th",null,"Email")])],-1)),e("tbody",null,[(n(!0),c(k,null,C(s.value,a=>(n(),c("tr",{key:a.id},[e("td",null,[e("input",{type:"checkbox",value:a.id,checked:D(a),onChange:v=>R(a)},null,40,ot)]),e("td",null,f(a.first_name)+" "+f(a.last_name),1),e("td",null,f(a.email),1)]))),128))])])]),e("div",{class:"modal-footer"},[e("button",{onClick:H},"Add Selected")])])])):$("",!0)])),m.show?(n(),c("div",at,[e("div",{class:"modal-backdrop-blur",onClick:V}),m.show?(n(),c("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:ae(V,["self"])},[e("div",{class:j(["modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",{"modal-fullscreen":i.value}])},[e("div",nt,[e("div",{class:"modal-header"},[t[10]||(t[10]=e("h5",{class:"modal-title"},"Compose Email",-1)),e("div",{class:"d-flex align-items-center gap-2"},[e("i",{class:"fas fa-expand-alt text-primary cursor-pointer",onClick:q,title:"Expand"}),e("button",{type:"button",class:"btn-close",onClick:V,"aria-label":"Close"})])]),e("div",it,[e("div",rt,[t[11]||(t[11]=e("label",{class:"form-label",for:"email-from"},"From:",-1)),L(e("input",{type:"email",id:"email-from",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=a=>o.value.from=a),placeholder:"Sender email address"},null,512),[[A,o.value.from]])]),e("div",dt,[t[12]||(t[12]=e("label",{class:"form-label"},"To:",-1)),e("div",ct,[(n(!0),c(k,null,C(g.value,(a,v)=>(n(),c("span",{key:v,class:"badge bg-success"},[ee(f(a)+" ",1),e("button",{type:"button",class:"btn-close btn-close-white btn-sm ms-2",onClick:I=>X(v)},null,8,ut)]))),128)),e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:G}," + ")])]),e("div",mt,[t[14]||(t[14]=e("label",{class:"form-label",for:"email-subject"},"Subject:",-1)),e("div",pt,[L(e("input",{type:"text",id:"email-subject",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.subject=a),placeholder:"Email Subject"},null,512),[[A,o.value.subject]]),e("select",{class:"form-select w-auto",onChange:t[3]||(t[3]=a=>de(a))},[t[13]||(t[13]=e("option",{value:""},"+ Merge Field",-1)),(n(!0),c(k,null,C(B.value,a=>(n(),c("option",{key:a,value:a},f(a),9,vt))),128))],32)])]),e("div",ht,[t[16]||(t[16]=e("label",{class:"form-label"},"Template:",-1)),L(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.template=a),onChange:u},[t[15]||(t[15]=e("option",{value:"",disabled:""},"Select a Template",-1)),(n(!0),c(k,null,C(z.value,a=>(n(),c("option",{key:a.id,value:a.id},f(a.name),9,ft))),128))],544),[[te,o.value.template]])]),e("div",gt,[t[17]||(t[17]=e("label",{class:"form-label"},"* Body",-1)),ne(ie(re),{init:J,modelValue:o.value.message,"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.message=a),onInit:Z},null,8,["modelValue"])]),e("div",bt,[t[18]||(t[18]=e("label",{class:"form-label"},"Attachments:",-1)),e("input",{type:"file",class:"form-control",multiple:"",onChange:d},null,32),e("div",yt,[(n(!0),c(k,null,C(o.value.attachments,(a,v)=>(n(),c("span",{key:v,class:"badge bg-secondary me-2"},[ee(f(a.name||a.path||a)+" ",1),e("button",{type:"button",class:"btn-close btn-close-white btn-sm ms-2",onClick:I=>p(v)},null,8,wt)]))),128))])]),e("div",_t,[t[20]||(t[20]=e("label",{class:"form-label"},"Signature:",-1)),L(e("select",{class:"form-select","onUpdate:modelValue":t[6]||(t[6]=a=>E.value=a),onChange:se},[t[19]||(t[19]=e("option",{value:""},"No Signature",-1)),(n(!0),c(k,null,C(N.value,a=>(n(),c("option",{key:a.id,value:a.content},f(a.name||"Signature "+a.id),9,St))),128))],544),[[te,E.value]])]),e("div",kt,[t[21]||(t[21]=e("label",{class:"form-label"},"Schedule Email:",-1)),L(e("input",{type:"datetime-local",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=a=>o.value.schedule=a)},null,512),[[A,o.value.schedule]])]),e("div",{class:"d-flex justify-content-end gap-2"},[e("button",{class:"btn btn-info",onClick:ce},"Preview"),e("button",{class:"btn btn-success",onClick:ue},"Send Email")])])])],2)])):$("",!0)])):$("",!0)],64))}},Ct=O(xt,[["__scopeId","data-v-3717dfd6"]]),Mt={key:0,class:"integrte_LeadModal"},$t={class:"modal_LeadContent"},Et={class:"modal-header"},Tt={class:"modal_LeadBody"},Lt=["value","checked","onChange"],It={key:0,class:"modal-wrapper"},jt={class:"modal-content"},At={class:"modal-header"},Bt={class:"d-flex align-items-center gap-2"},Nt={class:"modal-body"},zt={class:"mb-3"},Ft={class:"mb-3"},Vt={class:"d-flex flex-wrap align-items-center gap-2"},Dt=["onClick"],Ut={class:"mb-3"},Pt=["value"],Ot={class:"mb-3"},Qt={class:"mb-4"},Rt={__name:"SmsModal",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(m,{emit:r}){const _=m,x=r,i=y(!1),h=y(!1),s=y([]),b=y([]),g=y([]);y(null);const w=y(["{{first_name}}","{{last_name}}","{{email}}","{{city}}","{{phone}}"]),o=y({from:"",to:"",toName:"",subject:"",message:"",template:"",schedule:""});U(()=>_.show,u=>{u?Y(()=>{H()}):(o.value={from:"",to:"",toName:"",subject:"",message:"",template:"",schedule:""},s.value=[],g.value=[])});const B=()=>{x("close")},N=()=>{o.value.to=s.value.map(u=>u.phone).join(", "),o.value.toName=s.value.map(u=>u.first_name).join(", ")},E=u=>{const d=g.value.indexOf(u.id);d===-1?(g.value.push(u.id),s.value.push({id:u.id,first_name:u.first_name,phone:u.phone})):(g.value.splice(d,1),s.value=s.value.filter(p=>p.id!==u.id)),N()},z={height:300,menubar:!1,plugins:"link lists code",toolbar:"undo redo | bold italic underline | alignleft aligncenter alignright | bullist numlist | mergeFieldButton",branding:!1,setup(u){u.ui.registry.addMenuButton("mergeFieldButton",{text:"Merge Fields",fetch(d){const p=w.value.map(T=>({type:"menuitem",text:T,onAction:()=>{u.insertContent(T)}}));d(p)}})}},Q=u=>g.value.includes(u.id),F=localStorage.getItem("auth_token"),V=async()=>{try{const u=await M.get("/api/leads",{headers:{Authorization:`Bearer ${F}`}});b.value=u.data}catch(u){console.error("Error fetching leads",u)}},q=async()=>{await V(),h.value=!0},K=u=>{const d=s.value[u];s.value.splice(u,1),g.value=g.value.filter(p=>p!==d.id),N()};U(g,()=>{o.value.to=s.value.map(u=>u.phone).join(", "),o.value.toName=s.value.map(u=>u.first_name).join(", ")});const G=()=>{h.value=!1},D=y([]),R=y(!1),H=async()=>{R.value=!0;try{const u=await M.get("/api/sms-templates");D.value=u.data.templates}catch{S.fire("Error","Could not load SMS templates.","error")}finally{R.value=!1}},X=()=>{if(!Array.isArray(D.value))return;const u=D.value.find(d=>d.id===o.value.template);u&&(o.value.message=u.content)},Z=()=>{S.fire({title:"SMS Preview",html:`<strong>From:</strong> ${o.value.from}<br>
              <strong>To:</strong> ${o.value.to}<br>
              <strong>Message:</strong><br> ${o.value.message}`,icon:"info"})},J=async()=>{const u=parseInt(localStorage.getItem("user_id"));if(!u||isNaN(u)){S.fire("Missing User ID","Please log in again.","error");return}if(s.value.length===0||!o.value.message.trim()){S.fire("Missing Information","Recipient and message cannot be empty.","error");return}try{const d=s.value.map(T=>T.phone),p=s.value.map(T=>T.id);await M.post("/api/send-sms",{lead_ids:p,user_id:u,from:o.value.from,to:d.join(", "),message:o.value.message,schedule:o.value.schedule||null}),S.fire("Success","SMS sent successfully.","success"),B()}catch(d){console.error("SMS Send Error:",d),S.fire("Error","Failed to send SMS.","error")}},W=()=>{i.value=!i.value,Y(()=>{})};return pe(()=>{H()}),(u,d)=>(n(),c(k,null,[(n(),P(oe,{to:"body"},[h.value?(n(),c("div",Mt,[e("div",$t,[e("div",Et,[d[6]||(d[6]=e("h2",null,"Select Leads",-1)),e("button",{onClick:d[0]||(d[0]=p=>h.value=!1)},"×")]),e("div",Tt,[e("table",null,[d[7]||(d[7]=e("thead",null,[e("tr",null,[e("th",null,"Select"),e("th",null,"Name"),e("th",null,"Phone")])],-1)),e("tbody",null,[(n(!0),c(k,null,C(b.value,p=>(n(),c("tr",{key:p.id},[e("td",null,[e("input",{type:"checkbox",value:p.phone,checked:Q(p),onChange:T=>E(p)},null,40,Lt)]),e("td",null,f(p.first_name)+" "+f(p.last_name),1),e("td",null,f(p.phone),1)]))),128))])])]),e("div",{class:"modal-footer"},[e("button",{onClick:G},"Add Selected")])])])):$("",!0)])),m.show?(n(),c("div",It,[e("div",{class:"modal-backdrop-blur",onClick:B}),m.show?(n(),c("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:ae(B,["self"])},[e("div",{class:j(["modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",{"modal-fullscreen":i.value}])},[e("div",jt,[e("div",At,[d[8]||(d[8]=e("h5",{class:"modal-title"},"Compose SMS",-1)),e("div",Bt,[e("i",{class:"fas fa-expand-alt text-primary cursor-pointer",onClick:W,title:"Expand"}),e("button",{type:"button",class:"btn-close",onClick:d[1]||(d[1]=p=>u.$emit("close")),"aria-label":"Close"})])]),e("div",Nt,[e("div",zt,[d[9]||(d[9]=e("label",{class:"form-label",for:"sms-from"},"From:",-1)),L(e("input",{type:"text",id:"sms-from",class:"form-control","onUpdate:modelValue":d[2]||(d[2]=p=>o.value.from=p),placeholder:"Sender name or phone"},null,512),[[A,o.value.from]])]),e("div",Ft,[d[10]||(d[10]=e("label",{class:"form-label"},"To:",-1)),e("div",Vt,[(n(!0),c(k,null,C(s.value,(p,T)=>(n(),c("span",{key:p.id,class:"badge bg-success"},[ee(f(p.first_name)+" ",1),e("button",{type:"button",class:"btn-close btn-close-white btn-sm ms-2",onClick:se=>K(T)},null,8,Dt)]))),128)),e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:q}," + ")])]),e("div",Ut,[d[12]||(d[12]=e("label",{class:"form-label"},"Template:",-1)),L(e("select",{class:"form-select","onUpdate:modelValue":d[3]||(d[3]=p=>o.value.template=p),onChange:X},[d[11]||(d[11]=e("option",{value:"",disabled:""},"Select a Template",-1)),(n(!0),c(k,null,C(D.value,p=>(n(),c("option",{key:p.id,value:p.id},f(p.name),9,Pt))),128))],544),[[te,o.value.template]])]),e("div",Ot,[d[13]||(d[13]=e("label",{class:"form-label"},"Message:",-1)),ne(ie(re),{id:"sms-editor",init:z,modelValue:o.value.message,"onUpdate:modelValue":d[4]||(d[4]=p=>o.value.message=p)},null,8,["modelValue"])]),e("div",Qt,[d[14]||(d[14]=e("label",{class:"form-label"},"Schedule SMS:",-1)),L(e("input",{type:"datetime-local",class:"form-control","onUpdate:modelValue":d[5]||(d[5]=p=>o.value.schedule=p)},null,512),[[A,o.value.schedule]])]),e("div",{class:"d-flex justify-content-end gap-2"},[e("button",{class:"btn btn-info",onClick:Z}," Preview "),e("button",{class:"btn btn-success",onClick:J}," Send SMS ")])])])],2)])):$("",!0)])):$("",!0)],64))}},Ht=O(Rt,[["__scopeId","data-v-99df4e1a"]]),Yt={name:"Inbox",components:{SMS:We,Email:Be,SmsModal:Ht,EmailModal:Ct},data(){return{activeTab:"sms",showSmsModal:!1,showEmailModal:!1}},computed:{activeTabComponent(){return this.activeTab==="sms"?"SMS":"Email"}},methods:{openSmsModal(){console.log("[OPEN SMS MODAL] Triggered"),this.showSmsModal=!0},openEmailModal(){console.log("[OPEN EMAIL MODAL] Triggered"),this.showEmailModal=!0},closeSmsModal(){this.showSmsModal=!1},closeEmailModal(){this.showEmailModal=!1}}},qt={class:"container py-3"},Kt={class:"d-flex justify-content-between align-items-center mb-3"},Gt={class:"btn-group me-3"};function Xt(m,r,_,x,i,h){const s=le("SmsModal"),b=le("EmailModal");return n(),c("div",qt,[e("div",Kt,[e("div",Gt,[e("button",{onClick:r[0]||(r[0]=g=>i.activeTab="email"),class:j(["btn",(i.activeTab==="email","btn big-border-button")])}," Email ",2),e("button",{onClick:r[1]||(r[1]=g=>i.activeTab="sms"),class:j(["btn",i.activeTab==="sms"?"btn-primary text-white":"btn-outline-primary"])}," SMS ",2)]),r[6]||(r[6]=e("div",{class:"me-auto"},[e("select",{class:"form-select",style:{"inline-size":"150px"}},[e("option",null,"Inbox"),e("option",null,"Sent")])],-1)),e("div",null,[e("button",{class:"btn btn-primary me-2 btn big-dark-button",onClick:r[2]||(r[2]=(...g)=>h.openEmailModal&&h.openEmailModal(...g))}," + Send New Email "),e("button",{class:"btn big-dark-button",onClick:r[3]||(r[3]=(...g)=>h.openSmsModal&&h.openSmsModal(...g))}," + Send New SMS ")])]),(n(),P(ve(h.activeTabComponent))),i.showSmsModal?(n(),P(s,{key:0,show:i.showSmsModal,onClose:r[4]||(r[4]=g=>i.showSmsModal=!1)},null,8,["show"])):$("",!0),i.showEmailModal?(n(),P(b,{key:1,show:i.showEmailModal,onClose:r[5]||(r[5]=g=>i.showEmailModal=!1)},null,8,["show"])):$("",!0)])}const ls=O(Yt,[["render",Xt]]);export{ls as default};
