import{_ as H,r as d,R as q,o as p,l as k,j as n,k as T,L as A,bo as I,u as Y,F,Z as P,$ as S,P as B,Y as ee,X as te,br as ne,b as Q,f as V,g as oe,e as U,n as ae,aH as se}from"./main-D2SRXulC.js";import{S as C}from"./sweetalert2.all-DyJFIm0t.js";import{c as z,g as le}from"./_commonjsHelpers-BosuxZz1.js";var ie="Expected a function",X=NaN,re="[object Symbol]",de=/^\s+|\s+$/g,ue=/^[-+]0x[0-9a-f]+$/i,ce=/^0b[01]+$/i,pe=/^0o[0-7]+$/i,me=parseInt,ve=typeof z=="object"&&z&&z.Object===Object&&z,fe=typeof self=="object"&&self&&self.Object===Object&&self,ke=ve||fe||Function("return this")(),ge=Object.prototype,ye=ge.toString,he=Math.max,_e=Math.min,W=function(){return ke.Date.now()};function Te(s,a,m){var o,v,h,g,u,f,_=0,l=!1,w=!1,b=!0;if(typeof s!="function")throw new TypeError(ie);a=Z(a)||0,R(m)&&(l=!!m.leading,w="maxWait"in m,h=w?he(Z(m.maxWait)||0,a):h,b="trailing"in m?!!m.trailing:b);function M(t){var r=o,c=v;return o=v=void 0,_=t,g=s.apply(c,r),g}function L(t){return _=t,u=setTimeout($,a),l?M(t):g}function x(t){var r=t-f,c=t-_,y=a-r;return w?_e(y,h-c):y}function E(t){var r=t-f,c=t-_;return f===void 0||r>=a||r<0||w&&c>=h}function $(){var t=W();if(E(t))return D(t);u=setTimeout($,x(t))}function D(t){return u=void 0,b&&o?M(t):(o=v=void 0,g)}function O(){u!==void 0&&clearTimeout(u),_=0,o=f=v=u=void 0}function i(){return u===void 0?g:D(W())}function e(){var t=W(),r=E(t);if(o=arguments,v=this,f=t,r){if(u===void 0)return L(f);if(w)return u=setTimeout($,a),M(f)}return u===void 0&&(u=setTimeout($,a)),g}return e.cancel=O,e.flush=i,e}function R(s){var a=typeof s;return!!s&&(a=="object"||a=="function")}function we(s){return!!s&&typeof s=="object"}function be(s){return typeof s=="symbol"||we(s)&&ye.call(s)==re}function Z(s){if(typeof s=="number")return s;if(be(s))return X;if(R(s)){var a=typeof s.valueOf=="function"?s.valueOf():s;s=R(a)?a+"":a}if(typeof s!="string")return s===0?s:+s;s=s.replace(de,"");var m=ce.test(s);return m||pe.test(s)?me(s.slice(2),m?2:8):ue.test(s)?X:+s}var Me=Te;const K=le(Me),De={class:"appointment-modal-overlay"},Ce={class:"appointment-modal-content"},Se={class:"appointment-modal-header"},$e={class:"appointment-modal-body"},Le={class:"appointment-form-group"},Ae={class:"select-lead-wrapper"},xe=["onClick"],Ee={key:0,class:"loader-wrapper"},je={key:1,class:"end-text"},Ie={class:"appointment-form-group"},Oe={class:"appointment-form-group"},Ne={class:"appointment-form-group"},Be={class:"appointment-form-group"},Fe={__name:"AppointmentModal",emits:["close","save"],setup(s,{emit:a}){const m=a,o=d({lead:"",title:"",description:"",location:"",date:""}),v=d([]),h=d(1),g=d(!1),u=d(!1),f=d(""),_=d(null),l=d(!1),w=d(""),b=()=>{l.value=!l.value},M=async()=>{if(!(g.value||u.value)){g.value=!0;try{const e=await(await fetch(`/api/leads?page=${h.value}&search=${f.value}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json();e.data.length<20&&(u.value=!0),v.value.push(...e.data),h.value+=1}catch(i){console.error("Error fetching leads",i)}finally{g.value=!1}}},L=()=>{v.value=[],h.value=1,u.value=!1,M()},x=K(()=>{L()},300),E=()=>{const i=_.value;i.scrollTop+i.clientHeight>=i.scrollHeight-10&&M()},$=i=>{o.value.lead=i.id,w.value=`${i.first_name} ${i.last_name}`,l.value=!1},D=(i,e="success")=>{typeof C<"u"&&C.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:e,title:i,didOpen:t=>{t.addEventListener("mouseenter",C.stopTimer),t.addEventListener("mouseleave",C.resumeTimer)}})},O=async()=>{try{if(!o.value.lead||!o.value.title||!o.value.date){D("Please fill all required fields.","warning");return}const i=await fetch("/api/appointments",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o.value)}),e=await i.json();i.ok&&(e!=null&&e.appointment)?(m("save",{id:e.appointment.id,title:e.appointment.title,type:"Appointment",due_date:e.appointment.date,lead_id:e.appointment.lead_id,lead_name:e.appointment.lead_name}),D("Appointment created successfully!","success"),m("close")):(console.error("❌ Appointment creation failed:",e),D("Failed to create appointment.","error"))}catch(i){console.error("❌ Error creating appointment:",i),D("Error creating appointment.","error")}};return q(()=>{M()}),(i,e)=>(p(),k("div",De,[n("div",Ce,[n("div",Se,[e[7]||(e[7]=n("h2",null,"Create Appointment",-1)),n("button",{onClick:e[0]||(e[0]=t=>i.$emit("close"))},"×")]),n("div",$e,[n("div",Le,[e[9]||(e[9]=n("label",null,"Lead Name:",-1)),n("div",Ae,[n("div",{class:"selected-lead-input",onClick:b},T(w.value||"Select Lead"),1),l.value?(p(),k("div",{key:0,class:"dropdown-lead-list",ref_key:"dropdown",ref:_,onScroll:E},[A(n("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),placeholder:"Search lead...",class:"dropdown-search",onInput:e[2]||(e[2]=(...t)=>Y(x)&&Y(x)(...t))},null,544),[[I,f.value]]),(p(!0),k(F,null,P(v.value,t=>(p(),k("div",{key:t.id,class:"dropdown-item",onClick:r=>$(t)},T(t.first_name)+" "+T(t.last_name),9,xe))),128)),g.value?(p(),k("div",Ee,e[8]||(e[8]=[n("div",{class:"loader"},null,-1)]))):S("",!0),u.value?(p(),k("div",je,"No more leads")):S("",!0)],544)):S("",!0)])]),n("div",Ie,[e[10]||(e[10]=n("label",{for:"appointment-title"},"Title:",-1)),A(n("input",{type:"text",id:"appointment-title","onUpdate:modelValue":e[3]||(e[3]=t=>o.value.title=t),placeholder:"Enter title"},null,512),[[I,o.value.title]])]),n("div",Oe,[e[11]||(e[11]=n("label",{for:"appointment-description"},"Description:",-1)),A(n("textarea",{id:"appointment-description","onUpdate:modelValue":e[4]||(e[4]=t=>o.value.description=t),placeholder:"Enter description"},null,512),[[I,o.value.description]])]),n("div",Ne,[e[12]||(e[12]=n("label",{for:"appointment-location"},"Location:",-1)),A(n("input",{type:"text",id:"appointment-location","onUpdate:modelValue":e[5]||(e[5]=t=>o.value.location=t),placeholder:"Enter location"},null,512),[[I,o.value.location]])]),n("div",Be,[e[13]||(e[13]=n("label",{for:"appointment-date"},"Date:",-1)),A(n("input",{type:"datetime-local",id:"appointment-date","onUpdate:modelValue":e[6]||(e[6]=t=>o.value.date=t)},null,512),[[I,o.value.date]])]),n("div",{class:"appointment-form-actions"},[n("button",{onClick:O},"Create Appointment")])])])]))}},Pe=H(Fe,[["__scopeId","data-v-86868e42"]]),Ve={props:["task"]},Ue={class:"task-modal-overlay"},ze={class:"task-modal-content"};function Ye(s,a,m,o,v,h){return p(),k("div",Ue,[n("div",ze,[a[5]||(a[5]=n("h3",null,"Task Details",-1)),n("p",null,[a[1]||(a[1]=n("strong",null,"Lead:",-1)),B(" "+T(m.task.lead_name),1)]),n("p",null,[a[2]||(a[2]=n("strong",null,"Title:",-1)),B(" "+T(m.task.title),1)]),n("p",null,[a[3]||(a[3]=n("strong",null,"Type:",-1)),B(" "+T(m.task.type),1)]),n("p",null,[a[4]||(a[4]=n("strong",null,"Date & Time:",-1)),B(" "+T(m.task.due_date),1)]),n("button",{onClick:a[0]||(a[0]=g=>s.$emit("close"))},"Close")])])}const He=H(Ve,[["render",Ye],["__scopeId","data-v-f3e4802d"]]),Je={class:"task-modal-overlay"},We={class:"task-modal-content"},Re={class:"task-modal-header"},qe={class:"task-modal-body"},Ge={class:"task-form-group"},Qe={class:"select-lead-wrapper"},Xe=["onClick"],Ze={key:0,class:"loader-wrapper"},Ke={key:1,class:"end-text"},et={class:"task-form-group"},tt={class:"task-form-group"},nt={class:"task-form-group"},ot={__name:"TaskModal",emits:["close","save"],setup(s,{emit:a}){const m=a,o=d({lead_id:"",title:"",type:"Meeting",due_date:""}),v=d([]),h=d(""),g=d(1),u=d(!1),f=d(!1),_=d(null),l=d(!1),w=d(""),b=(i,e="success")=>{typeof C<"u"&&C.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:e,title:i,didOpen:t=>{t.addEventListener("mouseenter",C.stopTimer),t.addEventListener("mouseleave",C.resumeTimer)}})},M=()=>{l.value=!l.value},L=async()=>{if(!(u.value||f.value)){u.value=!0;try{const e=await(await fetch(`/api/leads?page=${g.value}&search=${h.value}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json();e.data.length<20&&(f.value=!0),v.value.push(...e.data),g.value+=1}catch{}finally{u.value=!1}}},x=()=>{const i=_.value;i.scrollTop+i.clientHeight>=i.scrollHeight-10&&L()},E=i=>{o.value.lead_id=i.id,w.value=`${i.first_name} ${i.last_name}`,l.value=!1},$=()=>{v.value=[],g.value=1,f.value=!1,L()},D=K(()=>{$()},300),O=()=>{if(!o.value.lead_id||!o.value.title||!o.value.due_date){b("Please fill all required fields.","warning");return}m("save",o.value),m("close")};return q(()=>{L()}),(i,e)=>(p(),k("div",Je,[n("div",We,[n("div",Re,[e[6]||(e[6]=n("h2",null,"Add Task",-1)),n("button",{onClick:e[0]||(e[0]=t=>i.$emit("close"))},"×")]),n("div",qe,[n("div",Ge,[e[8]||(e[8]=n("label",null,"Select Lead:",-1)),n("div",Qe,[n("div",{class:"selected-lead-input",onClick:M},T(w.value||"Select a lead"),1),l.value?(p(),k("div",{key:0,class:"dropdown-lead-list",ref_key:"dropdown",ref:_,onScroll:x},[A(n("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),placeholder:"Search lead...",class:"dropdown-search",onInput:e[2]||(e[2]=(...t)=>Y(D)&&Y(D)(...t))},null,544),[[I,h.value]]),(p(!0),k(F,null,P(v.value,t=>(p(),k("div",{key:t.id,class:"dropdown-item",onClick:r=>E(t)},T(t.first_name)+" "+T(t.last_name),9,Xe))),128)),u.value?(p(),k("div",Ze,e[7]||(e[7]=[n("div",{class:"loader"},null,-1)]))):S("",!0),f.value?(p(),k("div",Ke,"No more leads")):S("",!0)],544)):S("",!0)])]),n("div",et,[e[9]||(e[9]=n("label",null,"Task Title:",-1)),A(n("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>o.value.title=t),placeholder:"Enter task title"},null,512),[[I,o.value.title]])]),n("div",tt,[e[11]||(e[11]=n("label",null,"Task Type:",-1)),A(n("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.type=t)},e[10]||(e[10]=[te('<option value="Meeting" data-v-ff93817d>Meeting</option><option value="Call" data-v-ff93817d>Call</option><option value="Email" data-v-ff93817d>Email</option><option value="Text" data-v-ff93817d>Text</option><option value="Follow-up" data-v-ff93817d>Follow-up</option>',5)]),512),[[ee,o.value.type]])]),n("div",nt,[e[12]||(e[12]=n("label",null,"Due Date:",-1)),A(n("input",{type:"datetime-local","onUpdate:modelValue":e[5]||(e[5]=t=>o.value.due_date=t)},null,512),[[I,o.value.due_date]])]),n("div",{class:"task-form-actions"},[n("button",{onClick:O},"Add Task")])])])]))}},at=H(ot,[["__scopeId","data-v-ff93817d"]]),st={components:{Loader:ne,TaskModal:at,AppointmentModal:Pe,TaskDetailModal:He},setup(){const s=d(new Date().getMonth()),a=d(new Date().getFullYear()),m=d(!1),o=d(!1),v=d([]),h=d([]),g=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=d(null),f=d(!1),_=d(!1),l=(t,r="success")=>{typeof C<"u"&&C.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:r,title:t,didOpen:c=>{c.addEventListener("mouseenter",C.stopTimer),c.addEventListener("mouseleave",C.resumeTimer)}})},w=t=>{u.value=t},b=Q(()=>["January","February","March","April","May","June","July","August","September","October","November","December"][s.value]),M=Q(()=>{const t=[],c=new Date(a.value,s.value,1).getDay();for(let j=0;j<c;j++)t.push({date:null,fullDate:null,events:[],isPadding:!0});const y=new Date(a.value,s.value,1),N=y.getMonth();for(;y.getMonth()===N;){const j=new Date(y);t.push({date:j.getDate(),fullDate:new Date(j),events:v.value.filter(G=>{const J=new Date(G.due_date||G.date);return J.getFullYear()===j.getFullYear()&&J.getMonth()===j.getMonth()&&J.getDate()===j.getDate()}),isPadding:!1}),y.setDate(y.getDate()+1)}return t}),L=()=>{s.value===0?(s.value=11,a.value-=1):s.value-=1},x=()=>{s.value===11?(s.value=0,a.value+=1):s.value+=1},E=t=>{const r=new Date;return t===r.getDate()&&s.value===r.getMonth()&&a.value===r.getFullYear()},$=t=>{console.log("📅 Clicked date:",t.fullDate)},D=async()=>{f.value=!0;try{const r=await(await fetch("/api/leads",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json();h.value=r,v.value=[],r.forEach(c=>{Array.isArray(c.tasks)&&c.tasks.forEach(y=>{v.value.push({id:y.id,title:y.title,type:y.type,due_date:y.due_date,lead_id:c.id,lead_name:`${c.first_name}`})})})}catch{}finally{f.value=!1}},O=async t=>{try{const r=await fetch("/api/tasks",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)}),c=r.headers.get("content-type");if(!c||!c.includes("application/json"))throw new Error("❌ Server did not return JSON. Check auth or endpoint.");const y=await r.json();if(r.ok&&(y!=null&&y.task)){const N=y.task;v.value.push({id:N.id,title:N.title,type:N.type,due_date:N.due_date,lead_id:N.lead_id}),l("Task added successfully!","success")}else console.error("❌ Task creation failed:",y),l("Failed to add task.","error")}catch(r){console.error("❌ Error adding task:",r),l("Error adding task.","error")}},i=async()=>{_.value=!0;try{(await(await fetch("/api/appointments",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json()).forEach(c=>{v.value.push({id:c.id,title:c.title,type:c.type,due_date:c.date,lead_id:c.lead_id,lead_name:c.lead_name})})}catch(t){console.error("❌ Error fetching appointments:",t)}finally{_.value=!1}},e=t=>{v.value.push(t),l("Appointment added successfully!","success")};return q(()=>{D(),i()}),{isLoadingLeads:f,isLoadingAppointments:_,selectedTask:u,openTaskDetail:w,currentMonth:s,currentYear:a,showTaskModal:m,showAppointmentModal:o,events:v,leads:h,weekdays:g,formattedMonth:b,daysInMonth:M,prevMonth:L,nextMonth:x,isCurrentDay:E,handleDateClick:$,addTask:O,addAppointment:e}}},lt={class:"calendar-page",style:{position:"relative"}},it={class:"header"},rt={class:"actions"},dt={class:"calendar-container"},ut={class:"calendar"},ct={class:"calendar-header"},pt={class:"weekdays"},mt={class:"calendar-days"},vt=["onClick"],ft={key:0},kt=["onClick"],gt={class:"fw-bold"},yt={class:"text-muted small"};function ht(s,a,m,o,v,h){const g=U("Loader"),u=U("TaskDetailModal"),f=U("TaskModal"),_=U("AppointmentModal");return p(),k("div",lt,[o.isLoadingLeads||o.isLoadingAppointments?(p(),V(g,{key:0},{default:oe(()=>a[7]||(a[7]=[B(" Loading calendar... ")])),_:1})):S("",!0),n("div",it,[a[8]||(a[8]=n("h1",null,"Calendar",-1)),n("div",rt,[n("button",{onClick:a[0]||(a[0]=l=>o.showTaskModal=!0)},"Add Task"),n("button",{onClick:a[1]||(a[1]=l=>o.showAppointmentModal=!0)},"Create Appointment")])]),n("div",dt,[n("div",ut,[n("div",ct,[n("button",{onClick:a[2]||(a[2]=(...l)=>o.prevMonth&&o.prevMonth(...l))},"Prev"),n("span",null,T(o.formattedMonth)+" "+T(o.currentYear),1),n("button",{onClick:a[3]||(a[3]=(...l)=>o.nextMonth&&o.nextMonth(...l))},"Next")]),n("div",pt,[(p(!0),k(F,null,P(o.weekdays,l=>(p(),k("div",{key:l,class:"weekday"},T(l),1))),128))]),n("div",mt,[(p(!0),k(F,null,P(o.daysInMonth,(l,w)=>(p(),k("div",{class:ae(["calendar-day",{"current-day":o.isCurrentDay(l.date),"empty-day":l.isPadding}]),key:w,onClick:b=>!l.isPadding&&o.handleDateClick(l)},[l.isPadding?S("",!0):(p(),k("span",ft,T(l.date),1)),(p(!0),k(F,null,P(l.events,b=>(p(),k("div",{key:b.id,class:"event",onClick:se(M=>o.openTaskDetail(b),["stop"])},[n("div",gt,T(b.lead_name),1),n("div",yt,T(b.title),1)],8,kt))),128))],10,vt))),128))])])]),o.selectedTask?(p(),V(u,{key:1,task:o.selectedTask,onClose:a[4]||(a[4]=l=>o.selectedTask=null)},null,8,["task"])):S("",!0),o.showTaskModal?(p(),V(f,{key:2,leads:o.leads,onClose:a[5]||(a[5]=l=>o.showTaskModal=!1),onSave:o.addTask},null,8,["leads","onSave"])):S("",!0),o.showAppointmentModal?(p(),V(_,{key:3,leads:o.leads,onClose:a[6]||(a[6]=l=>o.showAppointmentModal=!1),onSave:o.addAppointment},null,8,["leads","onSave"])):S("",!0)])}const bt=H(st,[["render",ht],["__scopeId","data-v-01eb8864"]]);export{bt as default};
