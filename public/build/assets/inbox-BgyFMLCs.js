import{a as u}from"./axios-CdtiCRuU.js";import{_ as f,o as i,l,j as s,L as _,d6 as x,F as g,Y as b,n as m,k as r,X as p,dd as v,f as w,p as y}from"./main-CgQypG51.js";import"./bootstrap.min-KxrJAQL6.js";import{S as k}from"./sweetalert2.all-DyJFIm0t.js";import"./_commonjsHelpers-BosuxZz1.js";const C={data(){return{leads:[],selectedLead:null,messages:[],searchQuery:""}},computed:{filteredLeads(){return this.leads.filter(n=>n.name.toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{async selectLead(n){this.selectedLead=n;const o=await u.get(`/api/email/lead/${n.leadId}`);this.messages=o.data.reverse(),this.$nextTick(()=>this.scrollToBottom())},scrollToBottom(){const n=this.$refs.emailArea;n&&(n.scrollTop=n.scrollHeight)}},mounted(){this.selectLead()}},S={class:"email-chat d-flex shadow rounded",style:{"block-size":"90vh"}},I={class:"border-end p-3",style:{"inline-size":"300px"}},L=["onClick"],T={class:"flex-grow-1 d-flex flex-column bg-light"},M={class:"border-bottom p-3 bg-white"},z={key:0},B={key:1,class:"text-muted"},$={class:"flex-grow-1 overflow-auto p-3",ref:"emailArea"},A={key:0,class:"text-center text-muted small"},E={class:"mt-1"},Q={class:"d-block text-end mt-1"};function D(n,o,d,c,t,a){return i(),l("div",S,[s("div",I,[_(s("input",{class:"form-control mb-2","onUpdate:modelValue":o[0]||(o[0]=e=>t.searchQuery=e),placeholder:"Search lead"},null,512),[[x,t.searchQuery]]),(i(!0),l(g,null,b(a.filteredLeads,e=>{var h;return i(),l("div",{key:e.leadId,class:m(["lead-item p-2 border-bottom",{"bg-primary text-white":((h=t.selectedLead)==null?void 0:h.leadId)===e.leadId}]),onClick:ae=>a.selectLead(e)},r(e.name),11,L)}),128))]),s("div",T,[s("div",M,[t.selectedLead?(i(),l("h5",z,r(t.selectedLead.name),1)):(i(),l("p",B,"Select a lead to view emails"))]),s("div",$,[(i(!0),l(g,null,b(t.messages,(e,h)=>(i(),l("div",{key:h,class:"mb-3"},[e.date?(i(),l("div",A,r(e.date),1)):p("",!0),s("div",{class:m(["p-3 rounded shadow-sm",e.direction==="sent"?"bg-info text-white ms-auto":"bg-white me-auto"]),style:{"max-inline-size":"75%"}},[s("strong",null,r(e.subject),1),s("div",E,r(e.description),1),s("small",Q,r(e.time),1)],2)]))),128))],512)])])}const V=f(C,[["render",D]]),j={data(){return{searchQuery:"",newMessage:"",selectedChat:null,leads:[],messages:[]}},computed:{filteredLeads(){return this.leads.filter(n=>n.name.toLowerCase().includes(this.searchQuery.toLowerCase()))}},methods:{async fetchLeads(){try{const o={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},d=await u.get("/api/sms/leads",{headers:o});this.leads=d.data}catch(n){console.error("Error loading leads:",n)}},async selectChat(n){try{const d={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},t=(await u.get(`/api/sms/lead/${n.leadId}`,{headers:d})).data,a=t.length>0?t[0].phone:n.phone||"";this.selectedChat={...n,phone:a},this.messages=t.reverse(),this.$nextTick(()=>this.scrollToBottom())}catch(o){console.error("Error loading messages:",o)}},async sendMessage(){const n=localStorage.getItem("auth_token"),o=parseInt(localStorage.getItem("user_id")),d={Authorization:`Bearer ${n}`};try{const c={lead_ids:[this.selectedChat.leadId],user_id:o,from:"+16187452168",to:this.selectedChat.phone,subject:"SMS Chat",message:this.newMessage};await u.post("/api/send-sms",c,{headers:d});const t=new Date,a=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),e=t.toISOString().slice(0,10);this.messages.push({id:`sms-sent-${Date.now()}`,type:"sms",direction:"sent",phone:this.selectedChat.phone,title:"Sent SMS",description:this.newMessage,leadId:this.selectedChat.leadId,date:e,time:a}),this.newMessage="",this.$nextTick(()=>this.scrollToBottom())}catch(c){console.error("Send SMS Error:",c),k.fire("Error","Failed to send SMS.","error")}},scrollToBottom(){const n=this.$refs.messagesArea;n&&(n.scrollTop=n.scrollHeight)}},mounted(){this.fetchLeads()}},F={class:"chat-container d-flex shadow rounded",style:{"block-size":"90vh","margin-block":"20px","margin-inline":"auto","max-inline-size":"1200px"}},U={class:"sidebar border-end d-flex flex-column bg-white",style:{"inline-size":"320px","min-inline-size":"250px"}},H={class:"p-3 border-bottom"},K={class:"flex-grow-1 overflow-auto chat-list"},N=["onClick"],Y={class:"flex-grow-1"},O={class:"fw-bold"},X={class:"chat-window d-flex flex-column flex-grow-1 bg-light"},q={key:0,class:"chat-header d-flex align-items-center p-3 border-bottom bg-white"},G={class:"mb-0 flex-grow-1"},J={key:1,class:"chat-header d-flex align-items-center justify-content-center p-3 text-muted"},P={class:"messages-area flex-grow-1 p-4 overflow-auto",ref:"messagesArea"},R={key:0,class:"text-center small text-muted mb-2"},W={class:"d-block text-end mt-1 text-white-50"},Z={key:2,class:"p-3 border-top bg-white"},ee={class:"input-group position-relative"};function te(n,o,d,c,t,a){return i(),l("div",F,[s("div",U,[s("div",H,[_(s("input",{type:"text",class:"form-control rounded-pill",placeholder:"Search lead","onUpdate:modelValue":o[0]||(o[0]=e=>t.searchQuery=e)},null,512),[[x,t.searchQuery]])]),s("div",K,[(i(!0),l(g,null,b(a.filteredLeads,e=>(i(),l("div",{key:e.leadId,onClick:h=>a.selectChat(e),class:m(["d-flex align-items-center p-3 border-bottom chat-item",{"bg-primary text-white":t.selectedChat&&t.selectedChat.leadId===e.leadId}]),style:{cursor:"pointer"}},[o[4]||(o[4]=s("img",{src:"https://cdn-icons-png.flaticon.com/512/1384/1384031.png",width:"45",height:"45",class:"rounded-circle me-3",alt:"Avatar"},null,-1)),s("div",Y,[s("div",O,r(e.name),1),s("small",{class:m(["text-muted",{"text-white-50":t.selectedChat&&t.selectedChat.leadId===e.leadId}])}," Lead ID: "+r(e.leadId),3)])],10,N))),128))])]),s("div",X,[t.selectedChat?(i(),l("div",q,[o[5]||(o[5]=s("img",{src:"https://cdn-icons-png.flaticon.com/512/1384/1384031.png",width:"40",height:"40",class:"rounded-circle me-3",alt:"Avatar"},null,-1)),s("h5",G,r(t.selectedChat.name),1)])):(i(),l("div",J," Select a lead to view messages ")),s("div",P,[t.messages.length&&t.selectedChat?(i(!0),l(g,{key:0},b(t.messages,(e,h)=>(i(),l("div",{key:h,class:"mb-3"},[e.date?(i(),l("div",R,[s("strong",null,r(e.date),1)])):p("",!0),s("div",{class:m(["message-bubble p-3 rounded shadow-sm",e.direction==="sent"?"bg-success text-white ms-auto":"bg-white me-auto"]),style:{"max-inline-size":"75%"}},[s("div",null,r(e.description),1),s("small",W,r(e.time),1)],2)]))),128)):p("",!0)],512),t.selectedChat?(i(),l("div",Z,[s("div",ee,[_(s("input",{type:"text",class:"form-control rounded-pill pe-5",placeholder:"Type a message","onUpdate:modelValue":o[1]||(o[1]=e=>t.newMessage=e),onKeyup:o[2]||(o[2]=v((...e)=>a.sendMessage&&a.sendMessage(...e),["enter"]))},null,544),[[x,t.newMessage]]),s("button",{class:"btn btn-primary rounded-circle position-absolute",style:{"z-index":"1","block-size":"40px","inline-size":"40px","inset-block-start":"50%","inset-inline-end":"10px",transform:"translateY(-50%)"},onClick:o[3]||(o[3]=(...e)=>a.sendMessage&&a.sendMessage(...e))},o[6]||(o[6]=[s("i",{class:"bi bi-send"},null,-1)]))])])):p("",!0)])])}const se=f(j,[["render",te]]),oe={name:"Inbox",components:{SMS:se,Email:V},data(){return{activeTab:"sms"}},computed:{activeTabComponent(){return this.activeTab==="sms"?"SMS":"Email"}},methods:{tabClass(n){return`px-4 py-2 border rounded ${this.activeTab===n?"bg-red-500 text-white":"bg-white text-black"}`}}},ne={class:"container py-3"},ie={class:"btn-group mb-3"};function le(n,o,d,c,t,a){return i(),l("div",ne,[s("div",ie,[s("button",{onClick:o[0]||(o[0]=e=>t.activeTab="sms"),class:m(["btn",t.activeTab==="sms"?"btn-danger":"btn-outline-danger"])}," SMS ",2),s("button",{onClick:o[1]||(o[1]=e=>t.activeTab="email"),class:m(["btn",t.activeTab==="email"?"btn-danger":"btn-outline-danger"])}," Email ",2)]),(i(),w(y(a.activeTabComponent)))])}const ue=f(oe,[["render",le]]);export{ue as default};
