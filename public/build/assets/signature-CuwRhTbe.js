import{_ as z,r as u,b as M,R as N,S as V,l as m,j as a,F as L,Y as I,k as h,aG as w,L as x,d6 as Y,d3 as j,P as q,o as p,n as G,X as P,au as Q}from"./main-CG-JhxE2.js";import{a as d}from"./axios-CdtiCRuU.js";import{S as o}from"./sweetalert2.all-DyJFIm0t.js";import{t as y}from"./tinymce-BvCBJ2R9.js";import"./theme-DldrPX_-.js";import"./_commonjsHelpers-BosuxZz1.js";const R={class:"signature-wrapper"},X={class:"signature-list"},H={class:"signature-items"},J=["onClick"],K={class:"name"},O={key:0,class:"default-tag"},W=["onClick"],Z={class:"signature-editor"},ee={class:"checkbox"},te={class:"btn-group"},ae={type:"submit"},se={__name:"signature",setup(re){const b=u([]),B=u(""),i=u(!1),f=u(null),r=u({id:null,name:"",content:"",is_default:!1}),l=()=>localStorage.getItem("auth_token"),g=async()=>{try{const e=await d.get("/api/signatures",{headers:{Authorization:`Bearer ${l()}`}});b.value=e.data}catch(e){console.error("Fetch error:",e)}},A=M(()=>b.value.filter(e=>e.name.toLowerCase().includes(B.value.toLowerCase()))),T=e=>{f.value=e,$(e)},U=()=>{v(),i.value=!1},$=e=>{r.value={...e},i.value=!0,Q(()=>C())},v=()=>{r.value={id:null,name:"",content:"",is_default:!1},i.value=!1,f.value=null,_()},D=async()=>{var e;r.value.content=((e=y.get("signature-editor"))==null?void 0:e.getContent())||"";try{i.value?(await d.put(`/api/signatures/${r.value.id}`,r.value,{headers:{Authorization:`Bearer ${l()}`}}),o.fire("Updated!","Signature updated successfully.","success")):(await d.post("/api/signatures",r.value,{headers:{Authorization:`Bearer ${l()}`}}),o.fire("Created!","Signature added successfully.","success")),v(),g()}catch(t){console.error("Submit error:",t),o.fire("Error","Failed to save signature.","error")}},E=async e=>{if((await o.fire({title:"Are you sure?",text:"This will delete the signature.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await d.delete(`/api/signatures/${e}`,{headers:{Authorization:`Bearer ${l()}`}}),o.fire("Deleted!","Signature deleted.","success"),g()}catch(s){console.error("Delete error:",s),o.fire("Error","Could not delete signature.","error")}},C=()=>{_(),y.init({selector:"#signature-editor",menubar:!1,plugins:"link lists image media",toolbar:"undo redo | bold italic | bullist numlist | link image media",file_picker_types:"file image media",file_picker_callback:(e,t,s)=>{const n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",s.filetype==="image"?"image/*":"*/*"),n.onchange=async function(){const c=this.files[0],S=new FormData;S.append("file",c);try{const F=(await d.post("/api/upload",S,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${l()}`}})).data.url;e(F,{title:c.name})}catch(k){console.error("Upload error:",k),o.fire("Upload Failed","Could not upload the file.","error")}},n.click()}})},_=()=>{const e=y.get("signature-editor");e&&e.destroy()};return N(()=>{g(),C()}),V(()=>{_()}),(e,t)=>(p(),m("div",R,[a("div",X,[t[2]||(t[2]=a("h3",null,"Signatures",-1)),a("div",H,[(p(!0),m(L,null,I(A.value,s=>{var n;return p(),m("div",{key:s.id,class:G(["signature-item",s.id===((n=f.value)==null?void 0:n.id)?"active":""]),onClick:c=>T(s)},[a("div",K,h(s.name),1),s.is_default?(p(),m("div",O,"Default")):P("",!0),a("button",{class:"delete-btn",onClick:w(c=>E(s.id),["stop"])},"🗑️",8,W)],10,J)}),128))]),a("button",{class:"add-btn",onClick:U},"+ Add New")]),a("div",Z,[a("h3",null,h(i.value?"Update Signature":"Create Signature"),1),a("form",{onSubmit:w(D,["prevent"])},[t[4]||(t[4]=a("label",null,"Signature Name",-1)),x(a("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.name=s),type:"text",required:""},null,512),[[Y,r.value.name]]),t[5]||(t[5]=a("label",null,"Content",-1)),t[6]||(t[6]=a("textarea",{id:"signature-editor"},null,-1)),a("label",ee,[x(a("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=s=>r.value.is_default=s)},null,512),[[j,r.value.is_default]]),t[3]||(t[3]=q(" Set as default "))]),a("div",te,[a("button",{type:"button",onClick:v},"Cancel"),a("button",ae,h(i.value?"Update Signature":"Create Signature"),1)])],32)])]))}},ce=z(se,[["__scopeId","data-v-f15939f5"]]);export{ce as default};
