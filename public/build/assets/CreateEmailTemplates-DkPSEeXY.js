import{a as h}from"./axios-CdtiCRuU.js";import{S as i}from"./sweetalert2.all-B3MH3p00.js";import{_ as A,r as f,w as P,R as _,l as c,j as t,n as B,bq as M,L as g,bn as b,F,Y as U,k as u,aG as V,X as z,o as m,bp as Y}from"./main-Dr3_htUk.js";import"./_commonjsHelpers-Cpj98o6Y.js";const I={setup(){const s=f({data:[],current_page:1,last_page:1}),e=f([]),v=f(""),a=f(!1),o=f({type:"email",title:"",subject:"",content:"",attachment:null}),y=n=>{const r=n.target.files[0];o.value.attachment=r},l=async()=>{const n=localStorage.getItem("auth_token");try{const r=await h.get("/api/templates",{params:{page:s.value.current_page,search:v.value,type:"email"},headers:{Authorization:`Bearer ${n}`}});s.value=r.data}catch(r){r.response&&r.response.status===401?i.fire("Error","You are not authenticated. Please log in again.","error"):console.error("Error fetching templates:",r)}},p=async()=>{const n=localStorage.getItem("auth_token");try{let r;const d=new FormData;d.append("title",o.value.title),d.append("subject",o.value.subject),d.append("content",o.value.content),d.append("type","email"),console.log(o.value.attachment),o.value.attachment&&d.append("attachment",o.value.attachment),r=await h.post("/api/templates",d,{headers:{Authorization:`Bearer ${n}`}}),r.data.success?(l(),k(),i.fire("Success!",`Template has been ${o.value.id?"updated":"created"}.`,"success")):i.fire("Error","Failed to submit the template. Please try again.","error")}catch(r){if(r.response&&r.response.data.errors){const d=Object.values(r.response.data.errors).flat().join(`
`);i.fire("Validation Error",d,"error")}else i.fire("Error","An error occurred while submitting the template. Please try again.","error")}},T=(n=null)=>{a.value=!0,n?(o.value.id=n.id,o.value.title=n.title,o.value.subject=n.subject,o.value.content=n.content,o.value.attachment=n.attachment||null):(o.value.id=null,o.value.title="",o.value.subject="",o.value.content="",o.value.attachment=null)},k=()=>{a.value=!1,w()},w=()=>{o.value.title="",o.value.subject="",o.value.content="",o.value.attachment=null},C=async()=>{const n=localStorage.getItem("auth_token");if(!n){i.fire("Error","Please log in to continue","error");return}if((await i.fire({title:"Are you sure?",text:"You will not be able to recover these templates!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete them!"})).isConfirmed)try{await h.post("/api/templates/bulk-delete",{ids:e.value},{headers:{Authorization:`Bearer ${n}`}}),l(),i.fire("Deleted!","Your selected templates have been deleted.","success")}catch(d){console.error("Error deleting selected templates:",d),i.fire("Error","An error occurred while deleting the templates. Please try again.","error")}},x=async n=>{const r=localStorage.getItem("auth_token");if(!r){i.fire("Error","Please log in to continue","error");return}if((await i.fire({title:"Are you sure?",text:"You will not be able to recover this template!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await h.delete(`/api/templates/${n}`,{headers:{Authorization:`Bearer ${r}`}}),l(),i.fire("Deleted!","Template has been deleted.","success")}catch(D){console.error("Error deleting template:",D),i.fire("Error","An error occurred while deleting the template. Please try again.","error")}},S=()=>{s.value.current_page<s.value.last_page&&(s.value.current_page++,l())},E=()=>{s.value.current_page>1&&(s.value.current_page--,l())},j=()=>{e.value.length===s.value.data.length?e.value=[]:e.value=s.value.data.map(n=>n.id)};return P(v,l),_(l),{handleFileUpload:y,templates:s,selectedTemplates:e,searchQuery:v,isModalOpen:a,formData:o,openModal:T,closeModal:k,submitForm:p,deleteSelectedTemplates:C,confirmDeleteTemplate:x,nextPage:S,previousPage:E,toggleSelectAll:j}}},q={class:"main"},N={class:"main-2"},O={class:"heading-section"},Q={class:"email-icon"},L={class:"search"},G={class:"data-section"},R=["value"],X=["src"],H={key:1,class:"fa fa-user-circle",style:{color:"#ccc","font-size":"50px"},"aria-hidden":"true"},J=["onClick"],K=["onClick"],W={class:"pagination"},Z=["disabled"],$=["disabled"],ee={key:0,class:"modal-overlay"},te={class:"modal"},le={class:"form-group"},ae={class:"form-group"},oe={class:"form-group"},ne={class:"form-group"};function re(s,e,v,a,o,y){return m(),c("div",q,[t("div",N,[t("div",O,[e[14]||(e[14]=t("div",{class:"email-templates"},[t("h3",null,"Email Template")],-1)),t("div",Q,[t("i",{class:"fa-regular fa-plus",onClick:e[0]||(e[0]=(...l)=>a.openModal&&a.openModal(...l))}),t("i",{class:B(["fa-regular fa-minus",{disabled:a.selectedTemplates.length===0}]),onClick:e[1]||(e[1]=(...l)=>a.deleteSelectedTemplates&&a.deleteSelectedTemplates(...l)),style:M({cursor:a.selectedTemplates.length===0?"not-allowed":"pointer"})}," Delete ",6)])]),t("div",L,[g(t("input",{type:"text",placeholder:"Enter email template name","onUpdate:modelValue":e[2]||(e[2]=l=>a.searchQuery=l),onInput:e[3]||(e[3]=(...l)=>s.fetchTemplates&&s.fetchTemplates(...l))},null,544),[[b,a.searchQuery]])]),t("div",G,[t("table",null,[t("thead",null,[t("tr",null,[t("th",null,[t("input",{type:"checkbox",onChange:e[4]||(e[4]=(...l)=>a.toggleSelectAll&&a.toggleSelectAll(...l))},null,32)]),e[15]||(e[15]=t("th",null,"Attachment",-1)),e[16]||(e[16]=t("th",null,"Name",-1)),e[17]||(e[17]=t("th",null,"Created By",-1)),e[18]||(e[18]=t("th",null,"Subject",-1)),e[19]||(e[19]=t("th",null,"Body",-1)),e[20]||(e[20]=t("th",null,"Action",-1))])]),t("tbody",null,[(m(!0),c(F,null,U(a.templates.data,l=>(m(),c("tr",{key:l.id},[t("td",null,[g(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=p=>a.selectedTemplates=p),value:l.id},null,8,R),[[Y,a.selectedTemplates]])]),t("td",null,[l.attachment_path?(m(),c("img",{key:0,src:`/storage/${l.attachment_path}`,alt:"Template Image",width:"50",height:"50",class:"image-thumbnail"},null,8,X)):(m(),c("i",H))]),t("td",null,u(l.title),1),t("td",null,u(l.created_by),1),t("td",null,u(l.subject),1),t("td",null,u(l.content),1),t("td",null,[t("button",{onClick:p=>a.openModal(l)},"Edit",8,J),t("button",{onClick:p=>a.confirmDeleteTemplate(l.id)},"Delete",8,K)])]))),128))])]),t("div",W,[t("button",{onClick:e[6]||(e[6]=(...l)=>a.previousPage&&a.previousPage(...l)),disabled:a.templates.current_page===1},"Previous",8,Z),t("span",null,"Page "+u(a.templates.current_page)+" of "+u(a.templates.last_page),1),t("button",{onClick:e[7]||(e[7]=(...l)=>a.nextPage&&a.nextPage(...l)),disabled:a.templates.current_page===a.templates.last_page},"Next",8,$)])]),a.isModalOpen?(m(),c("div",ee,[t("div",te,[t("button",{class:"close-btn",onClick:e[8]||(e[8]=(...l)=>a.closeModal&&a.closeModal(...l))},"Ã—"),t("h3",null,u(a.formData.id?"Edit":"Add")+" Email Template",1),t("form",{onSubmit:e[13]||(e[13]=V((...l)=>a.submitForm&&a.submitForm(...l),["prevent"]))},[t("div",le,[e[21]||(e[21]=t("label",{for:"title"},"Title",-1)),g(t("input",{type:"text",id:"title","onUpdate:modelValue":e[9]||(e[9]=l=>a.formData.title=l),required:""},null,512),[[b,a.formData.title]])]),t("div",ae,[e[22]||(e[22]=t("label",{for:"subject"},"Subject",-1)),g(t("input",{type:"text",id:"subject","onUpdate:modelValue":e[10]||(e[10]=l=>a.formData.subject=l),required:""},null,512),[[b,a.formData.subject]])]),t("div",oe,[e[23]||(e[23]=t("label",{for:"content"},"Content",-1)),g(t("textarea",{id:"content","onUpdate:modelValue":e[11]||(e[11]=l=>a.formData.content=l),required:""},null,512),[[b,a.formData.content]])]),t("div",ne,[e[24]||(e[24]=t("label",{for:"attachment"},"Attachment",-1)),t("input",{type:"file",id:"attachment",onChange:e[12]||(e[12]=(...l)=>a.handleFileUpload&&a.handleFileUpload(...l))},null,32)]),e[25]||(e[25]=t("button",{type:"submit",class:"submit-btn"},"Submit",-1))],32)])])):z("",!0)])])}const ce=A(I,[["render",re]]);export{ce as default};
