import{_ as ae,r as i,b as B,R as oe,l as a,j as e,P as w,X as m,L as g,d6 as S,F as $,Y as M,k as u,Z as Y,h as H,u as W,o,aG as ne}from"./main-CCXEDVrT.js";import{E as G}from"./bootstrap.min-BhgYdqyr.js";import{a as f}from"./axios-CdtiCRuU.js";import{S as r}from"./sweetalert2.all-DyJFIm0t.js";import"./_commonjsHelpers-BosuxZz1.js";const de={class:"container py-4"},ie={class:"d-flex justify-content-between align-items-center mb-4"},re={key:0,class:"table-responsive"},ue={class:"table table-bordered table-hover"},ce=["onClick"],me=["onClick"],pe={key:0,class:"d-flex justify-content-between align-items-center mt-2"},ve=["disabled"],fe=["disabled"],be={key:1},ye={class:"d-flex align-items-center mb-3"},he={class:"list-group"},ge={key:0,class:"list-group-item text-muted fst-italic"},_e={key:1,class:"table-auto w-full border text-left"},ke={class:"p-2"},we={class:"p-2"},Ce=["innerHTML"],xe={class:"p-2"},Te={class:"p-2"},Fe=["href"],Se={key:1},$e={class:"p-2"},Me={class:"p-2 flex gap-2"},Ve=["onClick"],Ae=["onClick"],Ue={key:2,class:"modal fade show d-block",tabindex:"-1"},Ee={class:"modal-dialog"},Ne={class:"modal-content"},Be={class:"modal-header"},je={class:"modal-body"},De={class:"modal-footer"},Pe={key:3,class:"modal fade show d-block",tabindex:"-1"},Le={class:"modal-dialog modal-xl"},Ie={class:"modal-content"},ze={class:"modal-header"},Ye={class:"modal-body"},He={class:"row g-3"},We={class:"col-md-6"},Ge={class:"col-md-6"},Ke={class:"input-group"},Re=["value"],Xe={class:"col-12"},Ze={class:"col-12"},qe={class:"modal-footer"},Je={key:4,class:"modal fade show d-block",tabindex:"-1"},Oe={class:"modal-dialog modal-xl"},Qe={class:"modal-content"},et={class:"modal-body"},tt={class:"row g-3"},lt={class:"col-md-6"},st={class:"col-md-6"},at={class:"input-group"},ot=["value"],nt={class:"col-12"},dt={class:"col-12"},V=10,it={__name:"CreateSmsTemplates",setup(rt){const p=i("folders"),j=i(null),b=i(!1),h=i(!1),y=i([]),C=i([]),_=i(null),A=i(""),k=i({name:""}),n=i({title:"",folder_id:"",subject:"",content:"",attachment:null}),D={height:300,menubar:!1,plugins:"link lists image code",toolbar:"undo redo | formatselect | bold italic underline | alignleft aligncenter alignright | bullist numlist outdent indent | image link code | mergefields",branding:!1,resize:!0,automatic_uploads:!0,images_upload_handler:s=>new Promise((t,l)=>{const c=s.blob();if(c.size>51200){l("Image size must be less than 50KB");return}const z=new FormData;z.append("file",c,s.filename()),f.post("/api/upload-image",z).then(N=>{N.data&&N.data.url?t(N.data.url):l("Upload failed: Invalid response")}).catch(()=>{l("Image upload failed")})}),setup(s){s.ui.registry.addMenuButton("mergefields",{text:"Merge Fields",fetch(t){const l=ee.map(c=>({type:"menuitem",text:c,onAction:()=>{s.insertContent(`{{${c}}}`)}}));t(l)}})}},P=localStorage.getItem("auth_token");P&&(f.defaults.headers.common.Authorization=`Bearer ${P}`);const U=B(()=>y.value.filter(s=>s.name.toLowerCase().includes(A.value.toLowerCase()))),L=async()=>{try{const s=await f.get("/api/folders?type=sms");y.value=s.data}catch{r.fire("Error","Failed to load folders","error")}},x=async s=>{try{const t=await f.get(`/api/folders/${s}/templates`,{params:{type:"sms"}});C.value=t.data;const l=y.value.find(c=>c.id===s);j.value=l,_.value=s,p.value="folder-view"}catch{r.fire("Error","Could not load templates for this folder","error")}},K=async()=>{if(p.value!=="folders"){r.fire("Warning","You can only create folders from the main view.","warning");return}if(y.value.some(t=>t.name.trim().toLowerCase()===k.value.name.trim().toLowerCase())){r.fire("Warning","A folder with this name already exists.","warning");return}try{const t=await f.post("/api/folders",{name:k.value.name,type:"sms"});y.value.push(t.data),k.value.name="",b.value=!1,r.fire("Success","Folder created successfully.","success")}catch{r.fire("Error","Could not create folder","error")}},R=async()=>{try{const s=new FormData;s.append("title",n.value.title),s.append("folder_id",n.value.folder_id),s.append("subject",n.value.subject),s.append("content",n.value.content),s.append("type","sms"),n.value.attachment&&s.append("attachment",n.value.attachment),await f.post("/api/templates",s),n.value={title:"",folder_id:"",subject:"",content:"",attachment:null},h.value=!1,p.value==="folder-view"&&_.value?await x(_.value):await L(),r.fire("Success","SMS template saved.","success")}catch{r.fire("Error","Could not save template","error")}},v=i(1),E=B(()=>Math.ceil(U.value.length/V)),X=B(()=>{const s=(v.value-1)*V,t=s+V;return U.value.slice(s,t)}),Z=()=>{v.value<E.value&&v.value++},q=()=>{v.value>1&&v.value--},T=i(!1),F=i(null),d=i({title:"",subject:"",content:"",type:"sms",attachment:null}),J=s=>{T.value=!0,F.value=s.id,d.value={title:s.title,subject:s.subject,content:s.content,folder_id:s.folder_id,type:s.type,attachment:null}},O=async()=>{try{const s=new FormData;s.append("title",d.value.title),s.append("subject",d.value.subject),s.append("content",d.value.content),s.append("type","sms"),s.append("folder_id",d.value.folder_id),d.value.attachment&&s.append("attachment",d.value.attachment),await f.post(`/api/email-templates/${F.value}?_method=PUT`,s,{headers:{"Content-Type":"multipart/form-data"}}),T.value=!1,F.value=null,await x(_.value),r.fire("Updated!","Template updated successfully.","success")}catch(s){console.error(s),r.fire("Error!","Could not update template.","error")}},I=()=>{T.value=!1,F.value=null},Q=async s=>{if((await r.fire({title:"Are you sure?",text:"This will permanently delete the template.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await f.delete(`/api/templates/${s}`),await x(_.value),r.fire("Deleted!","Template has been deleted.","success")}catch{r.fire("Error!","Failed to delete template.","error")}},ee=["first_name","last_name","email","phone","city","zip_code","province","street","house_number","tag","stage","created_at"],te=s=>{d.value.attachment=s.target.files[0]},le=s=>{n.value.attachment=s.target.files[0]},se=s=>{n.value.folder_id=s,h.value=!0};return oe(L),(s,t)=>(o(),a("div",de,[e("div",ie,[t[19]||(t[19]=e("h2",null,"SMS Templates",-1)),e("div",null,[p.value==="folders"?(o(),a("button",{key:0,onClick:t[0]||(t[0]=l=>b.value=!0),class:"btn btn-success me-2"},t[17]||(t[17]=[e("i",{class:"fas fa-plus me-1"},null,-1),w(" Create Folder ")]))):m("",!0),e("button",{onClick:t[1]||(t[1]=l=>h.value=!0),class:"btn btn-success"},t[18]||(t[18]=[e("i",{class:"fas fa-sms me-1"},null,-1),w(" Add SMS Template ")]))])]),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>A.value=l),type:"text",class:"form-control mb-3",placeholder:"Search by folder name"},null,512),[[S,A.value]]),p.value==="folders"?(o(),a("div",re,[e("table",ue,[t[21]||(t[21]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Templates"),e("th",null,"Created By"),e("th",null,"Action")])],-1)),e("tbody",null,[(o(!0),a($,null,M(X.value,l=>(o(),a("tr",{key:l.id},[e("td",{onClick:c=>x(l.id),class:"cursor-pointer"},[t[20]||(t[20]=e("i",{class:"fas fa-folder text-warning me-2"},null,-1)),w(u(l.name),1)],8,ce),e("td",null,u(l.template_count),1),e("td",null,u(l.created_by_name),1),e("td",null,[e("button",{class:"btn btn-link text-success p-0",onClick:ne(c=>se(l.id),["stop"])}," Add SMS Template ",8,me)])]))),128))])]),U.value.length>V?(o(),a("div",pe,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:q,disabled:v.value===1},"Previous",8,ve),e("span",null,"Page "+u(v.value)+" of "+u(E.value),1),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:Z,disabled:v.value===E.value},"Next",8,fe)])):m("",!0)])):p.value==="folder-view"?(o(),a("div",be,[p.value==="folder-view"?(o(),a("button",{key:0,onClick:t[3]||(t[3]=l=>p.value="folders"),class:"btn btn-secondary mb-3"},t[22]||(t[22]=[e("i",{class:"fas fa-arrow-left me-1"},null,-1),w(" Back to Folders ")]))):m("",!0),e("h3",ye,[t[23]||(t[23]=e("i",{class:"fas fa-folder text-warning me-2"},null,-1)),w(" "+u(j.value.name),1)]),e("ul",he,[C.value.length===0?(o(),a("li",ge," No templates in this folder. ")):m("",!0),C.value.length>0?(o(),a("table",_e,[t[27]||(t[27]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"p-2"},[e("input",{type:"checkbox"})]),e("th",{class:"p-2"},"Title"),e("th",{class:"p-2"},"Created By"),e("th",{class:"p-2"},"Content"),e("th",{class:"p-2"},"Type"),e("th",{class:"p-2"},"Attachment"),e("th",{class:"p-2"},"Created At"),e("th",{class:"p-2"},"Action")])],-1)),e("tbody",null,[(o(!0),a($,null,M(C.value,l=>(o(),a("tr",{key:l.id,class:"border-b hover:bg-gray-50"},[t[26]||(t[26]=e("td",{class:"p-2"},[e("input",{type:"checkbox"})],-1)),e("td",ke,u(l.title),1),e("td",we,u(l.created_by),1),e("td",{class:"p-2",innerHTML:l.content},null,8,Ce),e("td",xe,u(l.type),1),e("td",Te,[l.attachment_path?(o(),a("a",{key:0,href:`/storage/${l.attachment_path}`,target:"_blank",class:"text-blue-600 underline"}," View Attachment ",8,Fe)):(o(),a("span",Se,"No Attachment"))]),e("td",$e,u(new Date(l.created_at).toLocaleString()),1),e("td",Me,[t[25]||(t[25]=e("button",{class:"bg-red-600 text-white px-2 py-1 rounded"},[e("i",{class:"fas fa-eye"})],-1)),e("button",{class:"btn btn-sm btn-warning",onClick:c=>J(l)},"Edit",8,Ve),e("button",{onClick:c=>Q(l.id),class:"bg-red-600 text-white px-2 py-1 rounded"},t[24]||(t[24]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ae)])]))),128))])])):m("",!0)])])):m("",!0),b.value?(o(),a("div",Ue,[e("div",Ee,[e("div",Ne,[e("div",Be,[t[28]||(t[28]=e("h5",{class:"modal-title"},"Create Folder",-1)),e("button",{type:"button",class:"btn-close",onClick:t[4]||(t[4]=l=>b.value=!1)})]),e("div",je,[t[29]||(t[29]=e("label",{class:"form-label"},"* Folder Name",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>k.value.name=l),type:"text",class:"form-control",placeholder:"Folder Name"},null,512),[[S,k.value.name]])]),e("div",De,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=l=>b.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",onClick:K},"Save")])])])])):m("",!0),h.value?(o(),a("div",Pe,[e("div",Le,[e("div",Ie,[e("div",ze,[t[30]||(t[30]=e("h5",{class:"modal-title"},"Add SMS Template",-1)),e("button",{type:"button",class:"btn-close",onClick:t[7]||(t[7]=l=>h.value=!1)})]),e("div",Ye,[e("div",He,[e("div",We,[t[31]||(t[31]=e("label",{class:"form-label"},"* Template Name",-1)),g(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>n.value.title=l),type:"text",class:"form-control",placeholder:"Template Name"},null,512),[[S,n.value.title]])]),e("div",Ge,[t[33]||(t[33]=e("label",{class:"form-label"},"* Folder",-1)),e("div",Ke,[g(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>n.value.folder_id=l),class:"form-select"},[t[32]||(t[32]=e("option",{value:""},"Choose Folder",-1)),(o(!0),a($,null,M(y.value,l=>(o(),a("option",{key:l.id,value:l.id},u(l.name),9,Re))),128))],512),[[Y,n.value.folder_id]]),e("button",{class:"btn btn-outline-success",type:"button",onClick:t[10]||(t[10]=l=>b.value=!0)},"+")])]),e("div",Xe,[t[34]||(t[34]=e("label",{class:"form-label"},"Body",-1)),H(W(G),{init:D,modelValue:n.value.content,"onUpdate:modelValue":t[11]||(t[11]=l=>n.value.content=l)},null,8,["modelValue"])]),e("div",Ze,[t[35]||(t[35]=e("label",{class:"form-label"},"Attachment",-1)),e("input",{type:"file",class:"form-control",onChange:le},null,32)])])]),e("div",qe,[e("button",{class:"btn btn-secondary",onClick:t[12]||(t[12]=l=>h.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",onClick:R},"Save SMS Template")])])])])):m("",!0),T.value?(o(),a("div",Je,[e("div",Oe,[e("div",Qe,[e("div",{class:"modal-header"},[t[36]||(t[36]=e("h5",{class:"modal-title"},"Edit SMS Template",-1)),e("button",{type:"button",class:"btn-close",onClick:I})]),e("div",et,[e("div",tt,[e("div",lt,[t[37]||(t[37]=e("label",{class:"form-label"},"* Template Name",-1)),g(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>d.value.title=l),type:"text",class:"form-control",placeholder:"Template Name"},null,512),[[S,d.value.title]])]),e("div",st,[t[39]||(t[39]=e("label",{class:"form-label"},"* Folder",-1)),e("div",at,[g(e("select",{"onUpdate:modelValue":t[14]||(t[14]=l=>d.value.folder_id=l),class:"form-select"},[t[38]||(t[38]=e("option",{value:""},"Choose Folder",-1)),(o(!0),a($,null,M(y.value,l=>(o(),a("option",{key:l.id,value:l.id},u(l.name),9,ot))),128))],512),[[Y,d.value.folder_id]]),e("button",{class:"btn btn-outline-success",type:"button",onClick:t[15]||(t[15]=l=>b.value=!0)},"+")])]),e("div",nt,[t[40]||(t[40]=e("label",{class:"form-label"},"Body",-1)),H(W(G),{init:D,modelValue:d.value.content,"onUpdate:modelValue":t[16]||(t[16]=l=>d.value.content=l)},null,8,["modelValue"])]),e("div",dt,[t[41]||(t[41]=e("label",{class:"form-label"},"Attachment",-1)),e("input",{type:"file",class:"form-control",onChange:te},null,32)])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:I},"Cancel"),e("button",{class:"btn btn-danger",onClick:O},"Update Template")])])])])):m("",!0)]))}},bt=ae(it,[["__scopeId","data-v-5a00fdc7"]]);export{bt as default};
