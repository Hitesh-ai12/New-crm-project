import{_ as be,r as u,b as I,S as he,m as s,k as e,Q as w,M as g,d7 as $,F as D,Z as N,l as d,Y as p,n as E,$ as J,j as K,u as Y,o}from"./main-BNuHxzig.js";import{E as Q}from"./Editor-CNgs-mNt.js";import{a as f}from"./axios-CdtiCRuU.js";import"./bootstrap.min-KxrJAQL6.js";import{S as i}from"./sweetalert2.all-D9tp9RIL.js";const ye={class:"container py-4"},ge={class:"d-flex justify-content-between align-items-center mb-4"},_e={key:0,class:"table-responsive"},we={class:"table table-bordered table-hover"},Ce=["onClick"],ke=["onClick"],xe=["onClick"],Fe={key:0,class:"d-flex justify-content-between align-items-center mt-2"},Te=["disabled"],$e=["disabled"],Ee={key:1},Se={class:"d-flex align-items-center mb-3"},Ae={class:"list-group"},Be={key:0,class:"list-group-item text-muted fst-italic"},Me={key:1,class:"table-auto w-full border text-left"},Ve={class:"p-2"},De={class:"p-2"},Ne=["innerHTML"],Pe={class:"p-2"},Ue={class:"p-2"},je=["href"],Le={key:1},ze={class:"p-2"},Ie={class:"p-2 flex gap-2"},We=["onClick"],qe=["onClick"],Xe={key:2,class:"modal fade show d-block",tabindex:"-1"},Ge={class:"modal-dialog"},He={class:"modal-content"},Oe={class:"modal-header"},Je={class:"modal-body"},Ke={class:"modal-footer"},Ye={key:3,class:"modal fade show d-block",tabindex:"-1"},Qe={class:"modal-dialog"},Ze={class:"modal-content"},Re={class:"modal-header"},et={class:"modal-body"},tt={class:"modal-footer"},lt={key:4,class:"modal fade show d-block",tabindex:"-1"},at={class:"modal-dialog modal-xl"},st={class:"modal-content"},ot={class:"modal-header"},nt={class:"modal-body"},it={class:"row g-3"},dt={class:"col-md-6"},rt={key:0,class:"invalid-feedback"},ut={class:"col-md-6"},ct={class:"input-group"},pt=["value"],mt={key:0,class:"invalid-feedback"},vt={class:"col-12"},ft={key:0,class:"text-danger mt-1"},bt={class:"col-12"},ht={key:0,class:"text-danger small mt-1"},yt={class:"modal-footer"},gt={key:5,class:"modal fade show d-block",tabindex:"-1"},_t={class:"modal-dialog modal-xl"},wt={class:"modal-content"},Ct={class:"modal-body"},kt={class:"row g-3"},xt={class:"col-md-6"},Ft={key:0,class:"invalid-feedback"},Tt={class:"col-md-6"},$t={class:"input-group"},Et=["value"],St={key:0,class:"invalid-feedback"},At={class:"col-12"},Bt={key:0,class:"text-danger mt-1"},Mt={class:"col-12"},P=10,Vt={__name:"CreateWhatsappTemplates",setup(Dt){const _=u("folders"),b=u(null),W=u(!1),C=u(!1),v=u([]),S=u([]),k=u(null),U=u(""),q=u([]),x=u(!1),F=u(!1),y=u({name:""}),c=u({title:"",folder_id:"",subject:"",content:"",attachment:null}),X={height:300,menubar:!1,plugins:"link lists image code",toolbar:"undo redo | formatselect | bold italic underline | alignleft aligncenter alignright | bullist numlist outdent indent | image link code | mergefields signatures",branding:!1,resize:!0,automatic_uploads:!0,images_upload_handler:l=>new Promise((t,a)=>{const r=l.blob();if(r.size>51200){a("Image size must be less than 50KB");return}const V=new FormData;V.append("file",r,l.filename()),f.post("/api/upload-image",V).then(T=>{T.data&&T.data.url?t(T.data.url):a("Upload failed: Invalid response")}).catch(()=>{a("Image upload failed")})}),setup(l){l.ui.registry.addMenuButton("mergefields",{text:"Merge Fields",fetch(t){const a=re.map(r=>({type:"menuitem",text:r,onAction:()=>{l.insertContent(`{{${r}}}`)}}));t(a)}}),l.ui.registry.addMenuButton("signatures",{text:"Signatures",fetch(t){const a=q.value.map(r=>({type:"menuitem",text:r.title,onAction:()=>{const V=`<h4>${r.title}</h4>`,T=r.content||"",ve=r.attachment?`<p><a href="${r.attachment}" target="_blank">ðŸ“Ž Attachment</a></p>`:"",fe=`${V}
${T}
${ve}`;l.insertContent(fe)}}));t(a)}})}},G=localStorage.getItem("auth_token");G&&(f.defaults.headers.common.Authorization=`Bearer ${G}`);const j=I(()=>v.value.filter(l=>l.name.toLowerCase().includes(U.value.toLowerCase()))),Z=l=>{const t=l.target.files[0];if(!t)return;if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","text/plain","image/jpeg","image/png","image/jpg"].includes(t.type)){i.fire("Invalid File","Allowed file types: PDF, DOC, DOCX, TXT, JPG, PNG, XLS","warning"),l.target.value="";return}if(t.size>300*1024){i.fire("File Too Large","Max allowed size is 300KB.","warning"),l.target.value="";return}c.value.attachment=t},L=async()=>{try{const l=await f.get("/api/folders?type=whatsapp");v.value=l.data}catch{i.fire("Error","Failed to load folders","error")}},n=u({});function H(l){n.value={};let t=!0;return(!l.title||l.title.trim()==="")&&(n.value.title="Template name is required.",t=!1),l.folder_id||(n.value.folder_id="Please choose a folder.",t=!1),(!l.content||l.content.trim()==="")&&(n.value.content="Content is required.",t=!1),t}const A=async l=>{try{const t=await f.get(`/api/folders/${l}/templates`,{params:{type:"whatsapp"}});S.value=t.data;const a=v.value.find(r=>r.id===l);b.value=a,k.value=l,_.value="folder-view"}catch{i.fire("Error","Could not load templates for this folder","error")}},R=async()=>{if(!y.value.name.trim()){i.fire("Error","Folder name is required","error");return}if(v.value.some(t=>t.name.trim().toLowerCase()===y.value.name.trim().toLowerCase())){i.fire("Warning","A folder with this name already exists.","warning");return}try{const t=await f.post("/api/folders",{name:y.value.name,type:"whatsapp"});v.value.push(t.data.folder),x.value=!1,y.value.name="",i.fire("Success","Folder created successfully.","success")}catch{i.fire("Error","Could not create folder","error")}},ee=async()=>{if(H(c.value))try{const l=new FormData;l.append("title",c.value.title),l.append("folder_id",c.value.folder_id),l.append("subject",c.value.subject),l.append("content",c.value.content),l.append("type","whatsapp"),c.value.attachment&&l.append("attachment",c.value.attachment),await f.post("/api/templates",l),c.value={title:"",folder_id:"",subject:"",content:"",attachment:null},C.value=!1,_.value==="folder-view"&&k.value?await A(k.value):await L(),i.fire("Success","WhatsApp template saved.","success")}catch{i.fire("Error","Could not save template","error")}},h=u(1),z=I(()=>Math.ceil(j.value.length/P)),te=I(()=>{const l=(h.value-1)*P;return j.value.slice(l,l+P)}),le=()=>{h.value<z.value&&h.value++},ae=()=>{h.value>1&&h.value--},B=u(!1),M=u(null),m=u({title:"",subject:"",content:"",type:"whatsapp",attachment:null}),se=l=>{B.value=!0,M.value=l.id,m.value={title:l.title,subject:l.subject,content:l.content,folder_id:l.folder_id,type:l.type,attachment:null}},oe=async()=>{if(H(c.value))try{const l=new FormData;l.append("title",m.value.title),l.append("subject",m.value.subject),l.append("content",m.value.content),l.append("type","whatsapp"),l.append("folder_id",m.value.folder_id),m.value.attachment&&l.append("attachment",m.value.attachment),await f.post(`/api/email-templates/${M.value}?_method=PUT`,l,{headers:{"Content-Type":"multipart/form-data"}}),B.value=!1,M.value=null,await A(k.value),i.fire("Updated!","Template updated successfully.","success")}catch(l){console.error(l),i.fire("Error!","Could not update template.","error")}},O=()=>{B.value=!1,M.value=null},ne=async l=>{if((await i.fire({title:"Are you sure?",text:"This will permanently delete the template.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await f.delete(`/api/templates/${l}`),await A(k.value),i.fire("Deleted!","Template has been deleted.","success")}catch{i.fire("Error!","Failed to delete template.","error")}},ie=async()=>{try{const l=await f.get("/api/signature-templates-sms/whatsapp");q.value=l.data}catch{}},de=async()=>{if(!b.value.name.trim()){i.fire("Error","Folder name is required","error");return}try{const l=await f.put(`/api/folders/${b.value.id}`,{name:b.value.name}),t=v.value.findIndex(a=>a.id===b.value.id);t!==-1&&(v.value[t]=l.data.folder),F.value=!1,b.value=null,i.fire("Success","Folder updated successfully.","success"),L()}catch{i.fire("Error","Could not update folder","error")}},re=["first_name","last_name","email","phone","city","zip_code","province","street","house_number","tag","stage","created_at"],ue=l=>{i.fire({title:"Are you sure?",text:"This folder and all its templates will be deleted!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"}).then(async t=>{if(t.isConfirmed)try{await f.delete(`/api/folders/${l}`),v.value=v.value.filter(a=>a.id!==l),i.fire("Deleted!","The folder and its templates have been deleted.","success")}catch{i.fire("Error","Could not delete the folder.","error")}else i.fire("Cancelled","The folder is safe :)","info")})},ce=()=>{y.value.name="",x.value=!0},pe=l=>{b.value={...l},F.value=!0},me=l=>{m.value.attachment=l.target.files[0]};return he(()=>{L(),ie()}),(l,t)=>(o(),s("div",ye,[e("div",ge,[t[21]||(t[21]=e("h2",null,"WhatsApp Templates",-1)),e("div",null,[e("button",{onClick:ce,class:"btn btn-success"},t[19]||(t[19]=[e("i",{class:"fas fa-plus me-1"},null,-1),w(" Create Folder")])),e("button",{onClick:t[0]||(t[0]=a=>C.value=!0),class:"btn btn-success"},t[20]||(t[20]=[e("i",{class:"fab fa-whatsapp me-1"},null,-1),w(" Add WhatsApp Template ")]))])]),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>U.value=a),type:"text",class:"form-control mb-3",placeholder:"Search by folder name"},null,512),[[$,U.value]]),_.value==="folders"?(o(),s("div",_e,[e("table",we,[t[24]||(t[24]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Templates"),e("th",null,"Created By"),e("th",null,"Action")])],-1)),e("tbody",null,[(o(!0),s(D,null,N(te.value,a=>(o(),s("tr",{key:a.id},[e("td",{onClick:r=>A(a.id),class:"cursor-pointer"},[t[22]||(t[22]=e("i",{class:"fas fa-folder text-warning me-2"},null,-1)),w(d(a.name),1)],8,Ce),e("td",null,d(a.template_count),1),e("td",null,d(a.created_by_name),1),e("td",null,[e("button",{onClick:r=>pe(a),class:"btn btn-warning"},"Edit",8,ke),e("button",{onClick:r=>ue(a.id),class:"bg-red-600 text-white px-2 py-1 rounded"},t[23]||(t[23]=[e("i",{class:"fas fa-trash"},null,-1),w(" Delete ")]),8,xe)])]))),128))])]),j.value.length>P?(o(),s("div",Fe,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:ae,disabled:h.value===1},"Previous",8,Te),e("span",null,"Page "+d(h.value)+" of "+d(z.value),1),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:le,disabled:h.value===z.value},"Next",8,$e)])):p("",!0)])):_.value==="folder-view"?(o(),s("div",Ee,[_.value==="folder-view"?(o(),s("button",{key:0,onClick:t[2]||(t[2]=a=>_.value="folders"),class:"btn btn-secondary mb-3"},t[25]||(t[25]=[e("i",{class:"fas fa-arrow-left me-1"},null,-1),w(" Back to Folders ")]))):p("",!0),e("h3",Se,[t[26]||(t[26]=e("i",{class:"fas fa-folder text-warning me-2"},null,-1)),w(" "+d(b.value.name),1)]),e("ul",Ae,[S.value.length===0?(o(),s("li",Be," No templates in this folder. ")):p("",!0),S.value.length>0?(o(),s("table",Me,[t[30]||(t[30]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"p-2"},[e("input",{type:"checkbox"})]),e("th",{class:"p-2"},"Title"),e("th",{class:"p-2"},"Created By"),e("th",{class:"p-2"},"Content"),e("th",{class:"p-2"},"Type"),e("th",{class:"p-2"},"Attachment"),e("th",{class:"p-2"},"Created At"),e("th",{class:"p-2"},"Action")])],-1)),e("tbody",null,[(o(!0),s(D,null,N(S.value,a=>(o(),s("tr",{key:a.id,class:"border-b hover:bg-gray-50"},[t[29]||(t[29]=e("td",{class:"p-2"},[e("input",{type:"checkbox"})],-1)),e("td",Ve,d(a.title),1),e("td",De,d(a.created_by),1),e("td",{class:"p-2",innerHTML:a.content},null,8,Ne),e("td",Pe,d(a.type),1),e("td",Ue,[a.attachment_path?(o(),s("a",{key:0,href:`/storage/${a.attachment_path}`,target:"_blank",class:"text-blue-600 underline"}," View Attachment ",8,je)):(o(),s("span",Le,"No Attachment"))]),e("td",ze,d(new Date(a.created_at).toLocaleString()),1),e("td",Ie,[t[28]||(t[28]=e("button",{class:"bg-red-600 text-white px-2 py-1 rounded"},[e("i",{class:"fas fa-eye"})],-1)),e("button",{class:"btn btn-sm btn-warning",onClick:r=>se(a)},"Edit",8,We),e("button",{onClick:r=>ne(a.id),class:"bg-red-600 text-white px-2 py-1 rounded"},t[27]||(t[27]=[e("i",{class:"fas fa-trash"},null,-1)]),8,qe)])]))),128))])])):p("",!0)])])):p("",!0),x.value?(o(),s("div",Xe,[e("div",Ge,[e("div",He,[e("div",Oe,[t[31]||(t[31]=e("h5",{class:"modal-title"},"Create Folder",-1)),e("button",{type:"button",class:"btn-close",onClick:t[3]||(t[3]=a=>x.value=!1)})]),e("div",Je,[t[32]||(t[32]=e("label",{class:"form-label"},"* Folder Name",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>y.value.name=a),type:"text",class:"form-control",placeholder:"Enter folder name",required:""},null,512),[[$,y.value.name]])]),e("div",Ke,[e("button",{class:"btn btn-secondary",onClick:t[5]||(t[5]=a=>x.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:R}," Create Folder ")])])])])):p("",!0),F.value?(o(),s("div",Ye,[e("div",Qe,[e("div",Ze,[e("div",Re,[t[33]||(t[33]=e("h5",{class:"modal-title"},"Edit Folder",-1)),e("button",{type:"button",class:"btn-close",onClick:t[6]||(t[6]=a=>F.value=!1)})]),e("div",et,[t[34]||(t[34]=e("label",{class:"form-label"},"* Folder Name",-1)),g(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>b.value.name=a),type:"text",class:"form-control",placeholder:"Enter new folder name",required:""},null,512),[[$,b.value.name]])]),e("div",tt,[e("button",{class:"btn btn-secondary",onClick:t[8]||(t[8]=a=>F.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:de}," Save Changes ")])])])])):p("",!0),C.value?(o(),s("div",lt,[e("div",at,[e("div",st,[e("div",ot,[t[35]||(t[35]=e("h5",{class:"modal-title"},"Add SMS Template",-1)),e("button",{type:"button",class:"btn-close",onClick:t[9]||(t[9]=a=>C.value=!1)})]),e("div",nt,[e("div",it,[e("div",dt,[t[36]||(t[36]=e("label",{class:"form-label"},"* Template Name",-1)),g(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>c.value.title=a),type:"text",class:E(["form-control",{"is-invalid":n.value.title}]),placeholder:"Template Name"},null,2),[[$,c.value.title]]),n.value.title?(o(),s("div",rt,d(n.value.title),1)):p("",!0)]),e("div",ut,[t[38]||(t[38]=e("label",{class:"form-label"},"* Folder",-1)),e("div",ct,[g(e("select",{"onUpdate:modelValue":t[11]||(t[11]=a=>c.value.folder_id=a),class:E(["form-select",{"is-invalid":n.value.folder_id}])},[t[37]||(t[37]=e("option",{value:""},"Choose Folder",-1)),(o(!0),s(D,null,N(v.value,a=>(o(),s("option",{key:a.id,value:a.id},d(a.name),9,pt))),128))],2),[[J,c.value.folder_id]]),e("button",{class:"btn btn-outline-success",type:"button",onClick:t[12]||(t[12]=a=>W.value=!0)},"+")]),n.value.folder_id?(o(),s("div",mt,d(n.value.folder_id),1)):p("",!0)]),e("div",vt,[t[39]||(t[39]=e("label",{class:"form-label"},"* Body",-1)),K(Y(Q),{init:X,modelValue:c.value.content,"onUpdate:modelValue":t[13]||(t[13]=a=>c.value.content=a)},null,8,["modelValue"]),n.value.content?(o(),s("div",ft,d(n.value.content),1)):p("",!0)]),e("div",bt,[t[40]||(t[40]=e("label",{for:"attachment",class:"form-label"},"Attachment",-1)),e("input",{id:"attachment",type:"file",class:E(["form-control",{"is-invalid":n.value.attachment}]),onChange:Z,accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.xls"},null,34),t[41]||(t[41]=e("small",{class:"text-muted d-block"}," Allowed types: PDF, DOC, DOCX, TXT, JPG, JPEG, PNG, XLS (Max: 300KB) ",-1)),n.value.attachment?(o(),s("div",ht,d(n.value.attachment),1)):p("",!0)])])]),e("div",yt,[e("button",{class:"btn btn-secondary",onClick:t[14]||(t[14]=a=>C.value=!1)},"Cancel"),e("button",{class:"btn btn-danger",onClick:ee},"Save SMS Template")])])])])):p("",!0),B.value?(o(),s("div",gt,[e("div",_t,[e("div",wt,[e("div",{class:"modal-header"},[t[42]||(t[42]=e("h5",{class:"modal-title"},"Edit SMS Template",-1)),e("button",{type:"button",class:"btn-close",onClick:O})]),e("div",Ct,[e("div",kt,[e("div",xt,[t[43]||(t[43]=e("label",{class:"form-label"},"* Template Name",-1)),g(e("input",{"onUpdate:modelValue":t[15]||(t[15]=a=>m.value.title=a),type:"text",class:E(["form-control",{"is-invalid":n.value.title}]),placeholder:"Template Name"},null,2),[[$,m.value.title]]),n.value.title?(o(),s("div",Ft,d(n.value.title),1)):p("",!0)]),e("div",Tt,[t[45]||(t[45]=e("label",{class:"form-label"},"* Folder",-1)),e("div",$t,[g(e("select",{"onUpdate:modelValue":t[16]||(t[16]=a=>m.value.folder_id=a),class:E(["form-select",{"is-invalid":n.value.folder_id}])},[t[44]||(t[44]=e("option",{value:""},"Choose Folder",-1)),(o(!0),s(D,null,N(v.value,a=>(o(),s("option",{key:a.id,value:a.id},d(a.name),9,Et))),128))],2),[[J,m.value.folder_id]]),e("button",{class:"btn btn-outline-success",type:"button",onClick:t[17]||(t[17]=a=>W.value=!0)},"+")]),n.value.folder_id?(o(),s("div",St,d(n.value.folder_id),1)):p("",!0)]),e("div",At,[t[46]||(t[46]=e("label",{class:"form-label"},"* Body",-1)),K(Y(Q),{init:X,modelValue:m.value.content,"onUpdate:modelValue":t[18]||(t[18]=a=>m.value.content=a)},null,8,["modelValue"]),n.value.content?(o(),s("div",Bt,d(n.value.content),1)):p("",!0)]),e("div",Mt,[t[47]||(t[47]=e("label",{class:"form-label"},"Attachment",-1)),e("input",{type:"file",class:"form-control",onChange:me},null,32)])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:O},"Cancel"),e("button",{class:"btn btn-danger",onClick:oe},"Update Template")])])])])):p("",!0)]))}},It=be(Vt,[["__scopeId","data-v-fe005406"]]);export{It as default};
